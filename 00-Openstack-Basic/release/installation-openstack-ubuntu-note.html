<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>installation-openstack-ubuntu-note.md</title><link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}.CodeMirror { height: auto; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; }
.CodeMirror-lines { padding: 4px 0px; }
.CodeMirror pre { }
.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { background-color: white; }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background-color: rgb(247, 247, 247); white-space: nowrap; }
.CodeMirror-linenumbers { }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.CodeMirror div.CodeMirror-cursor { border-left: 1px solid black; z-index: 3; }
.CodeMirror div.CodeMirror-secondarycursor { border-left: 1px solid silver; }
.CodeMirror.cm-keymap-fat-cursor div.CodeMirror-cursor { width: auto; border: 0px; background: rgb(119, 238, 119); z-index: 1; }
.CodeMirror div.CodeMirror-cursor.CodeMirror-overwrite { }
.cm-tab { display: inline-block; }
.cm-s-typora-default .cm-header, .cm-s-typora-default .cm-property { color: rgb(217, 79, 138); }
.cm-s-typora-default pre.cm-header1:not(.cm-atom) :not(.cm-overlay) { font-size: 2rem; line-height: 2rem; }
.cm-s-typora-default pre.cm-header2:not(.cm-atom) :not(.cm-overlay) { font-size: 1.4rem; line-height: 1.4rem; }
.cm-s-typora-default .cm-atom, .cm-s-typora-default .cm-number { color: rgb(149, 132, 134); }
.cm-s-typora-default .cm-table-row, .cm-s-typora-default .cm-block-start { font-family: monospace; }
.cm-s-typora-default .cm-comment, .cm-s-typora-default .cm-code { color: rgb(74, 90, 159); font-family: monospace; }
.cm-s-typora-default .cm-tag { color: rgb(169, 68, 66); }
.cm-s-typora-default .cm-string { color: rgb(126, 134, 169); }
.cm-s-typora-default .cm-link { color: rgb(196, 122, 15); text-decoration: underline; }
.cm-s-typora-default .cm-variable-2, .cm-s-typora-default .cm-variable-1 { color: inherit; }
.cm-s-typora-default .cm-overlay { font-family: monospace; }
.CodeMirror.cm-s-typora-default div.CodeMirror-cursor { border-left: 3px solid rgb(228, 98, 154); }
.cm-s-typora-default .CodeMirror-activeline-background { left: -60px; right: -30px; background: rgba(204, 204, 204, 0.2); }
.cm-s-typora-default .CodeMirror-gutters { border-right: none; background-color: inherit; }
.cm-s-typora-default .cm-trailing-space-new-line::after, .cm-startspace::after, .cm-starttab .cm-tab::after { content: "•"; position: absolute; left: 0px; opacity: 0; font-family: LetterGothicStd, monospace; }
.os-windows .cm-startspace::after, .os-windows .cm-starttab .cm-tab::after { left: -0.1em; }
.cm-starttab .cm-tab::after { content: " "; }
.cm-startspace, .cm-tab, .cm-starttab, .cm-trailing-space-a, .cm-trailing-space-b, .cm-trailing-space-new-line { font-family: monospace; position: relative; }
.cm-s-typora-default .cm-trailing-space-new-line::after { content: "↓"; opacity: 0.3; }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: black; }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-property { color: black; }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: blue; }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: bold; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: rgb(255, 0, 0); }
.cm-invalidchar { color: rgb(255, 0, 0); }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { margin-bottom: -30px; margin-right: -30px; padding-bottom: 30px; padding-right: 30px; height: 100%; outline: none; position: relative; box-sizing: content-box; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow-x: hidden; overflow-y: scroll; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow-y: hidden; overflow-x: scroll; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: none !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-widget { }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.CodeMirror-selected { background: rgb(217, 217, 217); }
.CodeMirror-focused .CodeMirror-selected { background: rgb(215, 212, 240); }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
.CodeMirror span { }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}
.CodeMirror-lint-markers { width: 16px; }
.CodeMirror-lint-tooltip { background-color: infobackground; border: 1px solid black; border-radius: 4px; color: infotext; font-family: monospace; overflow: hidden; padding: 2px 5px; position: fixed; white-space: pre-wrap; z-index: 10000; max-width: 600px; opacity: 0; transition: opacity 0.4s; font-size: 0.8em; }
.CodeMirror-lint-mark-error, .CodeMirror-lint-mark-warning { background-position: left bottom; background-repeat: repeat-x; }
.CodeMirror-lint-mark-error { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAYAAAC09K7GAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sJDw4cOCW1/KIAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAHElEQVQI12NggIL/DAz/GdA5/xkY/qPKMDAwAADLZwf5rvm+LQAAAABJRU5ErkJggg=="); }
.CodeMirror-lint-marker-error, .CodeMirror-lint-marker-warning { background-position: center center; background-repeat: no-repeat; cursor: pointer; display: inline-block; height: 16px; width: 16px; vertical-align: middle; position: relative; }
.CodeMirror-lint-message-error, .CodeMirror-lint-message-warning { padding-left: 18px; background-position: left top; background-repeat: no-repeat; }
.CodeMirror-lint-marker-error, .CodeMirror-lint-message-error { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAHlBMVEW7AAC7AACxAAC7AAC7AAAAAAC4AAC5AAD///+7AAAUdclpAAAABnRSTlMXnORSiwCK0ZKSAAAATUlEQVR42mWPOQ7AQAgDuQLx/z8csYRmPRIFIwRGnosRrpamvkKi0FTIiMASR3hhKW+hAN6/tIWhu9PDWiTGNEkTtIOucA5Oyr9ckPgAWm0GPBog6v4AAAAASUVORK5CYII="); }
.CodeMirror-lint-marker-warning, .CodeMirror-lint-message-warning { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAANlBMVEX/uwDvrwD/uwD/uwD/uwD/uwD/uwD/uwD/uwD6twD/uwAAAADurwD2tQD7uAD+ugAAAAD/uwDhmeTRAAAADHRSTlMJ8mN1EYcbmiixgACm7WbuAAAAVklEQVR42n3PUQqAIBBFUU1LLc3u/jdbOJoW1P08DA9Gba8+YWJ6gNJoNYIBzAA2chBth5kLmG9YUoG0NHAUwFXwO9LuBQL1giCQb8gC9Oro2vp5rncCIY8L8uEx5ZkAAAAASUVORK5CYII="); }
.CodeMirror-lint-marker-multiple { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAMAAADzjKfhAAAACVBMVEUAAAAAAAC/v7914kyHAAAAAXRSTlMAQObYZgAAACNJREFUeNo1ioEJAAAIwmz/H90iFFSGJgFMe3gaLZ0od+9/AQZ0ADosbYraAAAAAElFTkSuQmCC"); background-repeat: no-repeat; background-position: right bottom; width: 100%; height: 100%; }


:root { --bg-color: #ffffff; --text-color: #333333; --code-block-bg-color: inherit; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { background: rgb(181, 214, 252); text-shadow: none; }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; padding-bottom: 70px; white-space: pre-wrap; overflow-x: visible; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
.typora-export #write { margin: 0px auto; }
#write > p:first-child, #write > ul:first-child, #write > ol:first-child, #write > pre:first-child, #write > blockquote:first-child, #write > div:first-child, #write > table:first-child { margin-top: 30px; }
#write li > table:first-child { margin-top: -20px; }
img { max-width: 100%; vertical-align: middle; }
input, button, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
::before, ::after, * { box-sizing: border-box; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write div, #write pre { width: inherit; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6 { position: relative; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
p { -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; }
.typora-export p { white-space: normal; }
.mathjax-block { margin-top: 0px; margin-bottom: 0px; -webkit-margin-before: 0rem; -webkit-margin-after: 0rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: bold; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; margin: 4px 0px 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 80px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
pre { white-space: pre-wrap; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: var(--code-block-bg-color); position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
.md-fences .CodeMirror.CodeMirror-wrap { top: -1.6em; margin-bottom: -1.6em; }
.md-fences.mock-cm { white-space: pre-wrap; }
.show-fences-line-number .md-fences { padding-left: 0px; }
.show-fences-line-number .md-fences.mock-cm { padding-left: 40px; }
.footnotes { opacity: 0.8; font-size: 0.9rem; padding-top: 1em; padding-bottom: 1em; }
.footnotes + .footnotes { margin-top: -1em; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: transparent; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: normal; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li p, li .mathjax-block { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; }
@media print {
  html, body { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  h1, h2, h3, h4, h5, h6 { break-after: avoid-page; orphans: 2; }
  p { orphans: 4; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 1cm; padding-right: 1cm; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0mm; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 2.86rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p .md-image:only-child { display: inline-block; width: 100%; text-align: center; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.mathjax-block { white-space: pre; overflow: hidden; width: 100%; }
p + .mathjax-block { margin-top: -1.143rem; }
.mathjax-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: none; box-shadow: none; }
.task-list { list-style-type: none; }
.task-list-item { position: relative; padding-left: 1em; }
.task-list-item input { position: absolute; top: 0px; left: 0px; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc::after, .md-toc-content::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); text-decoration: none; }
.md-toc-inner:hover { }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: bold; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
.md-tag { opacity: 0.5; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: monospace; }
code { text-align: left; }
h1 .md-tag, h2 .md-tag, h3 .md-tag, h4 .md-tag, h5 .md-tag, h6 .md-tag { font-weight: initial; opacity: 0.35; }
a.md-print-anchor { border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: none !important; background: transparent !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.mathjax-block .MathJax_SVG_Display { text-align: center; margin: 1em 0em; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: monospace; }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: normal; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; }


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
@font-face { font-family: "Open Sans"; font-style: normal; font-weight: normal; src: local("Open Sans Regular"), url("./github/400.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: italic; font-weight: normal; src: local("Open Sans Italic"), url("./github/400i.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: normal; font-weight: bold; src: local("Open Sans Bold"), url("./github/700.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: italic; font-weight: bold; src: local("Open Sans Bold Italic"), url("./github/700i.woff") format("woff"); }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 20px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
body > :first-child { margin-top: 0px !important; }
body > :last-child { margin-bottom: 0px !important; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 4px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border-width: 0px 0px 1px; border-style: none none solid; border-top-color: initial; border-right-color: initial; border-left-color: initial; border-image: initial; overflow: hidden; box-sizing: content-box; border-bottom-color: rgb(221, 221, 221); }
body > h2:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child + h2 { margin-top: 0px; padding-top: 0px; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child { margin-top: 0px; padding-top: 0px; }
a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 { margin-top: 0px; padding-top: 0px; }
h1 p, h2 p, h3 p, h4 p, h5 p, h6 p { margin-top: 0px; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border-top: 1px solid rgb(204, 204, 204); margin: 0px; padding: 0px; }
table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); }
.md-fences, code, tt { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, "Liberation Mono", Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding: 8px 1em 6px; }
.task-list { padding-left: 0px; }
.task-list-item { padding-left: 32px; }
.task-list-item input { top: 3px; left: 8px; }
@media screen and (min-width: 914px) {
}
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, "Liberation Mono", Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; color: inherit; }
.md-tag { color: inherit; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
#md-notification::before { top: 10px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }






</style>
</head>
<body class='typora-export' >
<div  id='write'  class = 'is-node'><h1><a name='header-n0' class='md-header-anchor '></a>Installation Guide</h1><p>Latest version: <a href='https://github.com/littlewey/workshops/blob/master/00-Openstack-Basic/installation-openstack-ubuntu-note.md'>installation-openstack-ubuntu-note.md</a> hosted on <em>Github.com/littlewey</em></p><blockquote><p>ref: <a href='https://docs.openstack.org/install-guide' target='_blank' >https://docs.openstack.org/install-guide</a></p></blockquote><p>Ubuntu was chosen as host OS.</p><blockquote><p>&quot;It&#39;s a good way to learn by installing it manually for as many services as you could :-) .&quot;</p><p>​                                                                                                                     Wey Gu </p></blockquote><p></p><blockquote><p>Sorry I could not use openstack-config but need configure conf file manually :-p, yes, I am not sorry, just look into conf files~~~.</p></blockquote><h2><a name='header-n19' class='md-header-anchor '></a>Contents</h2><p></p><div class='md-toc' mdtype='toc'><p class="md-toc-content"><span class="md-toc-item md-toc-h1" data-ref="n0"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n0">Installation Guide</a></span><span class="md-toc-item md-toc-h2" data-ref="n19"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n19">Contents</a></span><span class="md-toc-item md-toc-h2" data-ref="n23"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n23">Host networking</a></span><span class="md-toc-item md-toc-h3" data-ref="n43"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n43">My network solution</a></span><span class="md-toc-item md-toc-h2" data-ref="n56"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n56">Base Machine</a></span><span class="md-toc-item md-toc-h2" data-ref="n117"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n117">Controller node actions</a></span><span class="md-toc-item md-toc-h3" data-ref="n118"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n118">management network eth0 (enp0s3)</a></span><span class="md-toc-item md-toc-h3" data-ref="n121"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n121">hostname and hosts</a></span><span class="md-toc-item md-toc-h3" data-ref="n125"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n125">SQL database</a></span><span class="md-toc-item md-toc-h3" data-ref="n141"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n141">Message queue</a></span><span class="md-toc-item md-toc-h3" data-ref="n153"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n153">Memcached</a></span><span class="md-toc-item md-toc-h2" data-ref="n166"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n166">Compute node actions</a></span><span class="md-toc-item md-toc-h3" data-ref="n167"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n167">management network eth0 (enp0s3)</a></span><span class="md-toc-item md-toc-h3" data-ref="n169"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n169">configure NTP by editing <code>/etc/chrony/chrony.conf</code></a></span><span class="md-toc-item md-toc-h2" data-ref="n176"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n176">Keystone installation</a></span><span class="md-toc-item md-toc-h3" data-ref="n244"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n244">Configure the Apache HTTP server</a></span><span class="md-toc-item md-toc-h3" data-ref="n250"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n250">Finalize the installation</a></span><span class="md-toc-item md-toc-h3" data-ref="n263"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n263">Create a domain, projects, users, and roles</a></span><span class="md-toc-item md-toc-h3" data-ref="n293"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n293">Verify operation</a></span><span class="md-toc-item md-toc-h3" data-ref="n318"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n318">Create OpenStack client environment scripts</a></span><span class="md-toc-item md-toc-h4" data-ref="n321"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n321">Creating the scripts</a></span><span class="md-toc-item md-toc-h4" data-ref="n337"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n337">Using the scripts</a></span><span class="md-toc-item md-toc-h2" data-ref="n349"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n349">Glance installation</a></span><span class="md-toc-item md-toc-h3" data-ref="n358"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n358">Install and configure</a></span><span class="md-toc-item md-toc-h3" data-ref="n361"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n361">Prerequisites</a></span><span class="md-toc-item md-toc-h3" data-ref="n412"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n412">Install and configure components</a></span><span class="md-toc-item md-toc-h3" data-ref="n464"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n464">Finalize installation</a></span><span class="md-toc-item md-toc-h3" data-ref="n468"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n468">Verify operation</a></span><span class="md-toc-item md-toc-h2" data-ref="n506"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n506">Nova installation</a></span><span class="md-toc-item md-toc-h2" data-ref="n510"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n510">Nova install and configure controller node</a></span><span class="md-toc-item md-toc-h3" data-ref="n511"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n511">Prerequisites</a></span><span class="md-toc-item md-toc-h3" data-ref="n581"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n581">Install and configure components</a></span><span class="md-toc-item md-toc-h3" data-ref="n676"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n676">Finalize installation</a></span><span class="md-toc-item md-toc-h2" data-ref="n682"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n682">Nova Install and configure a compute node</a></span><span class="md-toc-item md-toc-h3" data-ref="n685"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n685">Install and configure components</a></span><span class="md-toc-item md-toc-h3" data-ref="n755"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n755">Finalize installation</a></span><span class="md-toc-item md-toc-h3" data-ref="n771"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n771">Add the compute node to the cell database</a></span><span class="md-toc-item md-toc-h2" data-ref="n788"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n788">Neutron installation</a></span><span class="md-toc-item md-toc-h2" data-ref="n798"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n798">Tenant/Project network configuration</a></span><span class="md-toc-item md-toc-h2" data-ref="n806"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n806">Neutron Install and configure controller node</a></span><span class="md-toc-item md-toc-h3" data-ref="n807"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n807">Prerequisites</a></span><span class="md-toc-item md-toc-h3" data-ref="n856"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n856">Configure networking options</a></span><span class="md-toc-item md-toc-h3" data-ref="n867"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n867">Networking Option 1: Provider networks</a></span><span class="md-toc-item md-toc-h3" data-ref="n870"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n870">Install the components</a></span><span class="md-toc-item md-toc-h3" data-ref="n872"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n872">Configure the server component</a></span><span class="md-toc-item md-toc-h3" data-ref="n912"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n912">Configure the Modular Layer 2 (ML2) plug-in</a></span><span class="md-toc-item md-toc-h3" data-ref="n946"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n946">Configure the Linux bridge agent</a></span><span class="md-toc-item md-toc-h3" data-ref="n972"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n972">Configure the DHCP agent</a></span><span class="md-toc-item md-toc-h3" data-ref="n986"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n986">Configure the metadata agent</a></span><span class="md-toc-item md-toc-h3" data-ref="n1000"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1000">Configure the Compute service to use the Networking service</a></span><span class="md-toc-item md-toc-h3" data-ref="n1014"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1014">Finalize installation</a></span><span class="md-toc-item md-toc-h3" data-ref="n1030"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1030">Verify operation</a></span><span class="md-toc-item md-toc-h2" data-ref="n1034"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1034">Neutron Install and configure compute node</a></span><span class="md-toc-item md-toc-h3" data-ref="n1037"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1037">Install the components</a></span><span class="md-toc-item md-toc-h3" data-ref="n1039"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1039">Configure the common component</a></span><span class="md-toc-item md-toc-h3" data-ref="n1064"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1064">Configure networking options</a></span><span class="md-toc-item md-toc-h3" data-ref="n1071"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1071">Configure the Linux bridge agent</a></span><span class="md-toc-item md-toc-h3" data-ref="n1097"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1097">Configure the Compute service to use the Networking service</a></span><span class="md-toc-item md-toc-h3" data-ref="n1109"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1109">Finalize installation</a></span><span class="md-toc-item md-toc-h3" data-ref="n1119"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1119">Verify operation</a></span><span class="md-toc-item md-toc-h2" data-ref="n1137"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1137">Congratulations! Let's try booting an instance</a></span><span class="md-toc-item md-toc-h3" data-ref="n1140"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1140">Create provider network/subnetwork</a></span><span class="md-toc-item md-toc-h3" data-ref="n1160"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1160">Create flavor</a></span><span class="md-toc-item md-toc-h3" data-ref="n1164"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1164">Add security group rules</a></span><span class="md-toc-item md-toc-h3" data-ref="n1180"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1180">Launch an instance</a></span><span class="md-toc-item md-toc-h3" data-ref="n1183"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1183">Determine instance options</a></span><span class="md-toc-item md-toc-h3" data-ref="n1219"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1219">Launch the instance</a></span><span class="md-toc-item md-toc-h3" data-ref="n1235"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1235">Access the instance using the virtual console</a></span><span class="md-toc-item md-toc-h3" data-ref="n1253"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1253">Access the instance remotely</a></span><span class="md-toc-item md-toc-h2" data-ref="n1267"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1267">[ISSUE] DHCP failure in VM troubleshooting</a></span><span class="md-toc-item md-toc-h3" data-ref="n1271"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1271">what it is like</a></span><span class="md-toc-item md-toc-h3" data-ref="n1284"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1284">Conclusion:</a></span><span class="md-toc-item md-toc-h2" data-ref="n1291"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1291">Cinder</a></span><span class="md-toc-item md-toc-h2" data-ref="n1292"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1292">Cinder on controller</a></span><span class="md-toc-item md-toc-h3" data-ref="n1328"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1328">Install and configure controller node</a></span><span class="md-toc-item md-toc-h3" data-ref="n1331"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1331">Prerequisites</a></span><span class="md-toc-item md-toc-h3" data-ref="n1389"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1389">Install and configure components</a></span><span class="md-toc-item md-toc-h3" data-ref="n1430"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1430">Configure Compute to use Block Storage</a></span><span class="md-toc-item md-toc-h3" data-ref="n1436"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1436">Finalize installation</a></span><span class="md-toc-item md-toc-h2" data-ref="n1446"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1446">Cinder on block storage node</a></span><span class="md-toc-item md-toc-h3" data-ref="n1447"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1447">configure storage network for compute</a></span><span class="md-toc-item md-toc-h3" data-ref="n1457"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1457">Create cinder machine: storage</a></span><span class="md-toc-item md-toc-h2" data-ref="n1458"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1458">Storage node actions</a></span><span class="md-toc-item md-toc-h3" data-ref="n1462"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1462">Management net eth0 (enp0s3) and storage net eth2 (enp0s9)</a></span><span class="md-toc-item md-toc-h3" data-ref="n1468"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1468">configure NTP by editing <code>/etc/chrony/chrony.conf</code></a></span><span class="md-toc-item md-toc-h3" data-ref="n1473"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1473">Check new disk was there already</a></span><span class="md-toc-item md-toc-h2" data-ref="n1479"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1479">Cinder on storage node</a></span><span class="md-toc-item md-toc-h3" data-ref="n1480"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1480">Install and configure a storage node</a></span><span class="md-toc-item md-toc-h3" data-ref="n1485"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1485">Prerequisites</a></span><span class="md-toc-item md-toc-h3" data-ref="n1525"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1525">Install and configure components</a></span><span class="md-toc-item md-toc-h3" data-ref="n1581"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1581">Finalize installation</a></span><span class="md-toc-item md-toc-h3" data-ref="n1588"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1588">Verify operation</a></span><span class="md-toc-item md-toc-h2" data-ref="n1603"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1603">Let's try something on block storage!</a></span><span class="md-toc-item md-toc-h3" data-ref="n1604"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1604">Create a volume</a></span><span class="md-toc-item md-toc-h3" data-ref="n1624"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1624">Attach the volume to an instance</a></span><span class="md-toc-item md-toc-h3" data-ref="n1758"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1758">Install and configure components</a></span><span class="md-toc-item md-toc-h3" data-ref="n1801"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1801">Finalize installation</a></span><span class="md-toc-item md-toc-h3" data-ref="n1807"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1807">Verify operation</a></span><span class="md-toc-item md-toc-h2" data-ref="n1823"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1823">[ISSUE] list heat service failure</a></span><span class="md-toc-item md-toc-h3" data-ref="n1824"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1824">error occurred during <code>openstack orchestration service list</code></a></span><span class="md-toc-item md-toc-h3" data-ref="n1843"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1843">Solution</a></span><span class="md-toc-item md-toc-h2" data-ref="n1855"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1855">Start Orchestration! let's start from a single instance HOT</a></span><span class="md-toc-item md-toc-h3" data-ref="n1863"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1863">Create a template</a></span><span class="md-toc-item md-toc-h3" data-ref="n1871"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1871">Create a stack</a></span><span class="md-toc-item md-toc-h2" data-ref="n1906"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1906">How about Design a fake vAPG VNF and instantiate it?</a></span><span class="md-toc-item md-toc-h3" data-ref="n1910"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1910">HOT</a></span><span class="md-toc-item md-toc-h3" data-ref="n1914"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1914">Instantiation vAPG</a></span><span class="md-toc-item md-toc-h2" data-ref="n1926"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1926">Horizon dashboard</a></span><span class="md-toc-item md-toc-h3" data-ref="n1934"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1934">Install and configure</a></span><span class="md-toc-item md-toc-h3" data-ref="n1998"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n1998">Finalize installation</a></span><span class="md-toc-item md-toc-h3" data-ref="n2004"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n2004">Verify operation</a></span><span class="md-toc-item md-toc-h2" data-ref="n2016"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n2016">[ISSUE] Horizon <code>500</code> internal error</a></span><span class="md-toc-item md-toc-h3" data-ref="n2017"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n2017">Fault reproduce in cli</a></span><span class="md-toc-item md-toc-h3" data-ref="n2044"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n2044">Solution</a></span><span class="md-toc-item md-toc-h2" data-ref="n2050"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n2050">Enable RabbitMQ web admin for studying</a></span><span class="md-toc-item md-toc-h2" data-ref="n2079"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n2079">Neutron reconfigure as Linux bridge with vlan</a></span><span class="md-toc-item md-toc-h3" data-ref="n2083"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n2083">Controller configuration</a></span><span class="md-toc-item md-toc-h3" data-ref="n2105"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n2105">Compute node configuration</a></span><span class="md-toc-item md-toc-h3" data-ref="n2121"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n2121">Verify operation</a></span><span class="md-toc-item md-toc-h3" data-ref="n2134"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n2134">Create initial networks</a></span><span class="md-toc-item md-toc-h3" data-ref="n2155"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n2155">Verify network operation</a></span><span class="md-toc-item md-toc-h2" data-ref="n2196"><a class="md-toc-inner" style="cursor: pointer;" href="#header-n2196">[ISSUE] Troubleshooting vlan dhcp</a></span></p></div><h2><a name='header-n23' class='md-header-anchor '></a>Host networking</h2><blockquote><p>ref: <a href='https://docs.openstack.org/install-guide/environment-networking.html' target='_blank' >https://docs.openstack.org/install-guide/environment-networking.html</a></p></blockquote><blockquote><p>ref: <a href='https://help.ubuntu.com/lts/serverguide/network-configuration.html' target='_blank' >https://help.ubuntu.com/lts/serverguide/network-configuration.html</a></p></blockquote><p>The example architectures assume use of the following networks:</p><ul><li><p>Management on 10.0.0.0/24 with gateway 10.0.0.1</p><p>This network requires a gateway to provide Internet access to all nodes for administrative purposes such as package installation, security updates, DNS, and NTP.</p></li><li><p>Provider on 203.0.113.0/24 with gateway 203.0.113.1</p><p>This network requires a gateway to provide Internet access to instances in your OpenStack environment.</p></li></ul><h3><a name='header-n43' class='md-header-anchor '></a>My network solution</h3><pre class='md-fences mock-cm' style='display:block;position:relative'>Net0:
	Network name: VirtualBox  host-only Ethernet Adapter
	Purpose: administrator / management network
	IP block: 10.20.0.0/24
	DHCP: disable
	Linux device: eth0

Net1:
	Network name: VirtualBox  host-only Ethernet Adapter#2
	Purpose: Provider network
	DHCP: disable
	IP block: 172.16.0.0/24
	Linux device: eth1

Net2：
	Network name: VirtualBox  host-only Ethernet Adapter#3
	Purpose: Storage network
	DHCP: disable
	IP block: 192.168.99.0/24
	Linux device: eth2

Net3：
	Network name: VirtualBox  Bridged or NAT // for accessing network or remote access purpose
	Purpose: Internet
	DHCP: enable
	IP block: &lt;depend on your network&gt;
	Linux device: eth3</pre><p></p><p></p><p>Edit the <code>/etc/network/interfaces</code> file to contain the following:</p><p>Replace <code>INTERFACE_NAME</code> with the actual interface name. For example, <em>eth1</em> or <em>ens224</em>.</p><pre class="md-fences md-end-block" lang="bash"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 115px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># The provider network interface</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">auto INTERFACE_NAME</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">iface INTERFACE_NAME inet manual</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">up ip link <span class="cm-keyword">set</span> dev <span class="cm-def">$IFACE</span> up</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">down ip link <span class="cm-keyword">set</span> dev <span class="cm-def">$IFACE</span> down</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 145px;"></div></div></div></pre><p></p><h2><a name='header-n56' class='md-header-anchor '></a>Base Machine</h2><ul><li>download image from <a href='https://launchpad.net/ubuntu/+mirror/mirrors.neusoft.edu.cn-release' target='_blank' >https://launchpad.net/ubuntu/+mirror/mirrors.neusoft.edu.cn-release</a></li></ul><ul><li><p>Change root password</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ sudo su
# passwd</pre><p>​</p></li><li><p>Allow root ssh with password</p><pre class='md-fences mock-cm' style='display:block;position:relative'># vi /etc/ssh/sshd_config 

PermitRootLogin yes</pre></li><li><p>Check nic names</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@ubuntu:~# dmesg | grep rename
[    2.799294] e1000 0000:00:09.0 enp0s9: renamed from eth2
[    2.800192] e1000 0000:00:0a.0 enp0s10: renamed from eth3
[    2.801072] e1000 0000:00:08.0 enp0s8: renamed from eth1
[    2.804067] e1000 0000:00:03.0 enp0s3: renamed from eth0</pre></li><li><p>configure management network as a dummy one</p><pre class='md-fences mock-cm' style='display:block;position:relative'># vi /etc/network/interfaces
auto enp0s3
iface enp0s3 inet static
address 10.20.0.11
netmask 255.255.255.0</pre></li><li><p>NTP</p><ul><li><p>install chrony</p><pre class='md-fences mock-cm' style='display:block;position:relative'>install chrony</pre></li><li><p>Edit the <code>/etc/chrony/chrony.conf</code> file and add, change, or remove these keys as necessary for your environment:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>allow 10.20.0.0/24</pre></li><li><p>restart service</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service chrony restart</pre></li></ul></li><li><p>Install OpenStack packages</p><blockquote><p>ref : <a href='https://docs.openstack.org/install-guide/environment-packages.html' target='_blank' >https://docs.openstack.org/install-guide/environment-packages.html</a></p></blockquote><p>Enable the OpenStack repository</p><pre class='md-fences mock-cm' style='display:block;position:relative'># apt install software-properties-common
# add-apt-repository cloud-archive:ocata</pre><p>Upgrade the packages on all nodes:</p><blockquote><p>Set apt proxy before doing that will help save your life</p><pre class='md-fences mock-cm' style='display:block;position:relative'># vi /etc/apt/apt.conf.d/90proxy
Acquire::http::Proxy &quot;http://www-proxy.exu.ericsson.se:8080&quot;;
Acquire::https::Proxy &quot;http://www-proxy.exu.ericsson.se:8080&quot;;

# sed -i -e &#39;s/cn/us/g&#39; /etc/apt/sources.list</pre></blockquote><pre class='md-fences mock-cm' style='display:block;position:relative'># apt update &amp;&amp; apt dist-upgrade -y</pre><p>Install the OpenStack client:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># apt install python-openstackclient -y</pre><p>​</p></li></ul><h2><a name='header-n117' class='md-header-anchor '></a>Controller node actions</h2><h3><a name='header-n118' class='md-header-anchor '></a>management network eth0 (enp0s3)</h3><pre class='md-fences mock-cm' style='display:block;position:relative'># vi /etc/network/interfaces

...
auto enp0s3
iface enp0s3 inet static
address 10.20.0.10
netmask 255.255.255.0
# gateway 10.20.0.1  &lt;--- comment out this line

...</pre><pre class='md-fences mock-cm' style='display:block;position:relative'># ifup enp0s3</pre><h3><a name='header-n121' class='md-header-anchor '></a>hostname and hosts</h3><pre class='md-fences mock-cm' style='display:block;position:relative'># echo controller &gt; /etc/hostname
# echo 10.20.0.10    controller &gt;&gt; /etc/hosts
# echo 10.20.0.20    compute &gt;&gt; /etc/hosts
# hostname controller</pre><p></p><h3><a name='header-n125' class='md-header-anchor '></a>SQL database</h3><p>Install package</p><pre class='md-fences mock-cm' style='display:block;position:relative'># apt install mariadb-server python-pymysql -y</pre><p>Create and edit the <code>/etc/mysql/mariadb.conf.d/99-openstack.cnf</code> file and complete the following actions:</p><blockquote><p>Create a <code>[mysqld]</code> section, and set the <code>bind-address</code> key to the management IP address of the controller node to enable access by other nodes via the management network. Set additional keys to enable useful options and the UTF-8 character set:</p></blockquote><pre class='md-fences mock-cm' style='display:block;position:relative'>[mysqld]
bind-address = 10.20.0.10

default-storage-engine = innodb
innodb_file_per_table = on
max_connections = 4096
collation-server = utf8_general_ci
character-set-server = utf8</pre><p>restart database service</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service mysql restart</pre><p>Secure the database service by running the <code>mysql_secure_installation</code> script. In particular, choose a suitable password for the database <code>root</code> account:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># mysql_secure_installation</pre><h3><a name='header-n141' class='md-header-anchor '></a>Message queue</h3><p>Install the package:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># apt install rabbitmq-server</pre><p>Add the <code>openstack</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># rabbitmqctl add_user openstack RABBIT_PASS

Creating user &quot;openstack&quot; ...</pre><p>Replace <code>RABBIT_PASS</code> with a suitable password.</p><p>Permit configuration, write, and read access for the <code>openstack</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># rabbitmqctl set_permissions openstack &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;

Setting permissions for user &quot;openstack&quot; in vhost &quot;/&quot; ...</pre><h3><a name='header-n153' class='md-header-anchor '></a>Memcached</h3><p>Install the packages:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># apt install memcached python-memcache</pre><p>Edit the <code>/etc/memcached.conf</code> file and configure the service to use the management IP address of the controller node. This is to enable access by other nodes via the management network:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>-l 10.20.0.10</pre><blockquote><p>Change the existing line that had <code>-l 127.0.0.1</code>.</p></blockquote><p>Restart the Memcached service:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service memcached restart</pre><h2><a name='header-n166' class='md-header-anchor '></a>Compute node actions</h2><h3><a name='header-n167' class='md-header-anchor '></a>management network eth0 (enp0s3)</h3><pre class='md-fences mock-cm' style='display:block;position:relative'># vi /etc/network/interfaces

auto enp0s3
iface enp0s3 inet static
address 10.20.0.20
netmask 255.255.255.0
# comment out gateway

# ifup enp0s3</pre><h3><a name='header-n169' class='md-header-anchor '></a>configure NTP by editing <code>/etc/chrony/chrony.conf</code></h3><pre class='md-fences mock-cm' style='display:block;position:relative'>server 10.20.0.10 iburst</pre><p>change hostname and hosts</p><pre class='md-fences mock-cm' style='display:block;position:relative'># echo compute &gt; /etc/hostname
# echo 10.20.0.10    controller &gt;&gt; /etc/hosts
# echo 10.20.0.20    compute &gt;&gt; /etc/hosts
# hostname compute</pre><p></p><h2><a name='header-n176' class='md-header-anchor '></a>Keystone installation</h2><blockquote><p>ref: <a href='https://docs.openstack.org/newton/install-guide-ubuntu/keystone.html' target='_blank' >https://docs.openstack.org/newton/install-guide-ubuntu/keystone.html</a></p></blockquote><blockquote><p>Keystone will be installed in <code>controller node</code></p></blockquote><p>Before you configure the OpenStack Identity service, you must create a database and an administration token.</p><p>To create the database, complete the following actions:</p><ul><li><p>Use the database access client to connect to the database server as the <code>root</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ mysql -u root -p</pre><p>In 16.04 LTS local access need no user/psw</p><pre class='md-fences mock-cm' style='display:block;position:relative'># mysql</pre><p>​</p></li><li><p>Create the <code>keystone</code> database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>mysql&gt; CREATE DATABASE keystone;</pre></li><li><p>Grant proper access to the <code>keystone</code> database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>mysql&gt; GRANT ALL PRIVILEGES ON keystone.* TO &#39;keystone&#39;@&#39;localhost&#39; \
  IDENTIFIED BY &#39;KEYSTONE_DBPASS&#39;;
mysql&gt; GRANT ALL PRIVILEGES ON keystone.* TO &#39;keystone&#39;@&#39;%&#39; \
  IDENTIFIED BY &#39;KEYSTONE_DBPASS&#39;;</pre><p>Replace <code>KEYSTONE_DBPASS</code> with a suitable password.</p></li><li><p>Exit the database access client.</p></li></ul><p>Run the following command to install the packages:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># apt install keystone -y</pre><ol start='' ><li><p>Edit the <code>/etc/keystone/keystone.conf</code> file and complete the following actions:</p><ul><li><p>In the <code>[database]</code> section, configure database access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[database]
...
connection = mysql+pymysql://keystone:KEYSTONE_DBPASS@controller/keystone</pre><p>Replace <code>KEYSTONE_DBPASS</code> with the password you chose for the database.</p><p>Comment out or remove any other <code>connection</code> options in the <code>[database]</code> section.</p></li><li><p>In the <code>[token]</code> section, configure the Fernet token provider:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[token]
...
provider = fernet</pre></li></ul></li><li><p>Populate the Identity service database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># su -s /bin/sh -c &quot;keystone-manage db_sync&quot; keystone</pre></li><li><p>Initialize Fernet key repositories:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone
# keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</pre></li><li><p>Bootstrap the Identity service:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># keystone-manage bootstrap --bootstrap-password ADMIN_PASS \
  --bootstrap-admin-url http://controller:35357/v3/ \
  --bootstrap-internal-url http://controller:35357/v3/ \
  --bootstrap-public-url http://controller:5000/v3/ \
  --bootstrap-region-id RegionOne</pre><p>Replace <code>ADMIN_PASS</code> with a suitable password for an administrative user.</p></li></ol><h3><a name='header-n244' class='md-header-anchor '></a>Configure the Apache HTTP server</h3><ol start='' ><li><p>Edit the <code>/etc/apache2/apache2.conf</code> file and configure the <code>ServerName</code> option to reference the controller node:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>ServerName controller</pre></li></ol><h3><a name='header-n250' class='md-header-anchor '></a>Finalize the installation</h3><ol start='' ><li><p>Restart the Apache service and remove the default SQLite database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service apache2 restart
# rm -f /var/lib/keystone/keystone.db</pre></li></ol><ol start='' ><li><p>Configure the administrative account</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ export OS_USERNAME=admin
$ export OS_PASSWORD=ADMIN_PASS
$ export OS_PROJECT_NAME=admin
$ export OS_USER_DOMAIN_NAME=Default
$ export OS_PROJECT_DOMAIN_NAME=Default
$ export OS_AUTH_URL=http://controller:35357/v3
$ export OS_IDENTITY_API_VERSION=3</pre><p>Replace <code>ADMIN_PASS</code> with the password used in the <code>keystone-manage bootstrap</code> command from the section called <a href='https://docs.openstack.org/newton/install-guide-ubuntu/keystone-install.html#keystone-install'>Install and configure</a>.</p></li></ol><h3><a name='header-n263' class='md-header-anchor '></a>Create a domain, projects, users, and roles</h3><p>The Identity service provides authentication services for each OpenStack service. The authentication service uses a combination of <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-domain'>domains</a>, <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-project'>projects</a>, <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-user'>users</a>, and <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-role'>roles</a>.</p><ol start='' ><li><p>This guide uses a service project that contains a unique user for each service that you add to your environment. Create the <code>service</code> project:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack project create --domain default \
  --description &quot;Service Project&quot; service

+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Service Project                  |
| domain_id   | default                          |
| enabled     | True                             |
| id          | 24ac7f19cd944f4cba1d77469b2a73ed |
| is_domain   | False                            |
| name        | service                          |
| parent_id   | default                          |
+-------------+----------------------------------+</pre></li><li><p>Regular (non-admin) tasks should use an unprivileged project and user. As an example, this guide creates the <code>demo</code> project and user.</p><ul><li><p>Create the <code>demo</code> project:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack project create --domain default \
  --description &quot;Demo Project&quot; demo

+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Demo Project                     |
| domain_id   | default                          |
| enabled     | True                             |
| id          | 231ad6e7ebba47d6a1e57e1cc07ae446 |
| is_domain   | False                            |
| name        | demo                             |
| parent_id   | default                          |
+-------------+----------------------------------+</pre><p>Do not repeat this step when creating additional users for this project.</p></li><li><p>Create the <code>demo</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack user create --domain default \
  --password-prompt demo

User Password:
Repeat User Password:
+---------------------+----------------------------------+
| Field               | Value                            |
+---------------------+----------------------------------+
| domain_id           | default                          |
| enabled             | True                             |
| id                  | aeda23aa78f44e859900e22c24817832 |
| name                | demo                             |
| password_expires_at | None                             |
+---------------------+----------------------------------+</pre></li><li><p>Create the <code>user</code> role:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack role create user

+-----------+----------------------------------+
| Field     | Value                            |
+-----------+----------------------------------+
| domain_id | None                             |
| id        | 997ce8d05fc143ac97d83fdfb5998552 |
| name      | user                             |
+-----------+----------------------------------+</pre></li><li><p>Add the <code>user</code> role to the <code>demo</code> project and user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack role add --project demo --user demo user</pre></li></ul></li></ol><h3><a name='header-n293' class='md-header-anchor '></a>Verify operation</h3><p>For security reasons, disable the temporary authentication token mechanism:</p><p>Edit the <code>/etc/keystone/keystone-paste.ini</code> file and remove <code>admin_token_auth</code> from the <code>[pipeline:public_api]</code>, <code>[pipeline:admin_api]</code>, and <code>[pipeline:api_v3]</code> sections.</p><p>Unset the temporary <code>OS_AUTH_URL</code> and <code>OS_PASSWORD</code> environment variable:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ unset OS_AUTH_URL OS_PASSWORD</pre><p>As the <code>admin</code> user, request an authentication token:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack --os-auth-url http://controller:35357/v3 \
  --os-project-domain-name Default --os-user-domain-name Default \
  --os-project-name admin --os-username admin token issue

Password:
+------------+-----------------------------------------------------------------+
| Field      | Value                                                           |
+------------+-----------------------------------------------------------------+
| expires    | 2017-08-12T20:14:07.056119Z                                     |
| id         | gAAAAABWvi7_B8kKQD9wdXac8MoZiQldmjEO643d-e_j-XXq9AmIegIbA7UHGPv |
|            | atnN21qtOMjCFWX7BReJEQnVOAj3nclRQgAYRsfSU_MrsuWb4EDtnjU7HEpoBb4 |
|            | o6ozsA_NmFWEpLeKy0uNn_WeKbAhYygrsmQGA49dclHVnz-OMVLiyM9ws       |
| project_id | 343d245e850143a096806dfaefa9afdc                                |
| user_id    | ac3377633149401296f6c0d92d79dc16                                |
+------------+-----------------------------------------------------------------+</pre><p></p><p>This command uses the password for the <code>admin</code> user. As we gave above it&#39;s <code>ADMIN_PASS</code>.</p><p>As the <code>demo</code> user, request an authentication token:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack --os-auth-url http://controller:5000/v3 \
  --os-project-domain-name Default --os-user-domain-name Default \
  --os-project-name demo --os-username demo token issue

Password:
+------------+-----------------------------------------------------------------+
| Field      | Value                                                           |
+------------+-----------------------------------------------------------------+
| expires    | 2017-08-12T20:15:39.014479Z                                     |
| id         | gAAAAABWvi9bsh7vkiby5BpCCnc-JkbGhm9wH3fabS_cY7uabOubesi-Me6IGWW |
|            | yQqNegDDZ5jw7grI26vvgy1J5nCVwZ_zFRqPiz_qhbq29mgbQLglbkq6FQvzBRQ |
|            | JcOzq3uwhzNxszJWmzGC7rJE_H0A_a3UFhqv8M4zMRYSbS2YF0MyFmp_U       |
| project_id | ed0b60bf607743088218b0a533d5943f                                |
| user_id    | 58126687cbcc4888bfa9ab73a2256f27                                |
+------------+-----------------------------------------------------------------+</pre><p></p><blockquote><p>This command uses the password for the <code>demo</code> user and API port 5000 which only allows regular (non-admin) access to the Identity service API.</p></blockquote><p></p><h3><a name='header-n318' class='md-header-anchor '></a>Create OpenStack client environment scripts</h3><p>The previous section used a combination of environment variables and command options to interact with the Identity service via the<code>openstack</code> client. To increase efficiency of client operations, OpenStack supports simple client environment scripts also known as OpenRC files. These scripts typically contain common options for all clients, but also support unique options. For more information, see the <a href='http://docs.openstack.org/user-guide/common/cli_set_environment_variables_using_openstack_rc.html'>OpenStack End User Guide</a>.</p><h4><a name='header-n321' class='md-header-anchor '></a>Creating the scripts</h4><p>Create client environment scripts for the <code>admin</code> and <code>demo</code> projects and users. Future portions of this guide reference these scripts to load appropriate credentials for client operations.</p><ol start='' ><li><p>Edit the <code>admin-openrc</code> file and add the following content:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>export OS_PROJECT_DOMAIN_NAME=Default
export OS_USER_DOMAIN_NAME=Default
export OS_PROJECT_NAME=admin
export OS_USERNAME=admin
export OS_PASSWORD=ADMIN_PASS
export OS_AUTH_URL=http://controller:35357/v3
export OS_IDENTITY_API_VERSION=3
export OS_IMAGE_API_VERSION=2</pre><p>Replace <code>ADMIN_PASS</code> with the password you chose for the <code>admin</code> user in the Identity service.</p></li><li><p>Edit the <code>demo-openrc</code> file and add the following content:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>export OS_PROJECT_DOMAIN_NAME=Default
export OS_USER_DOMAIN_NAME=Default
export OS_PROJECT_NAME=demo
export OS_USERNAME=demo
export OS_PASSWORD=demo
export OS_AUTH_URL=http://controller:5000/v3
export OS_IDENTITY_API_VERSION=3
export OS_IMAGE_API_VERSION=2</pre><p>Replace <code>OS_PASSWORD=demo</code> with the password you chose for the <code>demo</code> user in the Identity service.</p></li></ol><h4><a name='header-n337' class='md-header-anchor '></a>Using the scripts</h4><p>To run clients as a specific project and user, you can simply load the associated client environment script prior to running them. For example:</p><ol start='' ><li><p>Load the <code>admin-openrc</code> file to populate environment variables with the location of the Identity service and the <code>admin</code> project and user credentials:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ . admin-openrc</pre></li><li><p>Request an authentication token:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@ubuntu:~# openstack token issue --max-width 70
+------------+-------------------------------------------------------+
| Field      | Value                                                 |
+------------+-------------------------------------------------------+
| expires    | 2017-08-23T14:00:10+0000                              |
| id         | gAAAAABZnXxaKuuwh9Kw-dbY1mSn8LeNNQMKmIj2EW8jyjO0NSy5H |
|            | QPno4Tj6NqqSkumKhRZW8lPS1nZC2pm5fCuH5XMtVfJTu89RX6Sba |
|            | -vSv-OZl5uHvRY4KOK03WH15Dnp1XbWN97xY8tR_kAhc-69       |
|            | -WvDe1DLS6vKr-bKbYDVXLqlLshE8E                        |
| project_id | 78c9c849237649a3a8c4526167427589                      |
| user_id    | d8efd16c30904a7992010abe4bdb9a2b                      |
+------------+-------------------------------------------------------+</pre></li></ol><h2><a name='header-n349' class='md-header-anchor '></a>Glance installation</h2><p>ref: <a href='https://docs.openstack.org/newton/install-guide-ubuntu/glance.html' target='_blank' >https://docs.openstack.org/newton/install-guide-ubuntu/glance.html</a></p><p>For simplicity, this guide describes configuring the Image service to use the <code>file</code> back end, which uploads and stores in a directory on the controller node hosting the Image service. By default, this directory is <code>/var/lib/glance/images/</code>.</p><p>Before you proceed, ensure that the controller node has at least several gigabytes of space available in this directory. Keep in mind that since the <code>file</code> back end is often local to a controller node, it is not typically suitable for a multi-node glance deployment.</p><p>For information on requirements for other back ends, see <a href='http://docs.openstack.org/newton/config-reference/image.html'>Configuration Reference</a>.</p><h3><a name='header-n358' class='md-header-anchor '></a>Install and configure</h3><p>This section describes how to install and configure the Image service, code-named glance, on the controller node. For simplicity, this configuration stores images on the local file system.</p><h3><a name='header-n361' class='md-header-anchor '></a>Prerequisites</h3><p>Before you install and configure the Image service, you must create a database, service credentials, and API endpoints.</p><ol start='' ><li><p>To create the database, complete these steps:</p><ul><li><p>Use the database access client to connect to the database server as the <code>root</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ mysql</pre></li><li><p>Create the <code>glance</code> database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>mysql&gt; CREATE DATABASE glance;</pre></li><li><p>Grant proper access to the <code>glance</code> database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>mysql&gt; GRANT ALL PRIVILEGES ON glance.* TO &#39;glance&#39;@&#39;localhost&#39; \
  IDENTIFIED BY &#39;GLANCE_DBPASS&#39;;
mysql&gt; GRANT ALL PRIVILEGES ON glance.* TO &#39;glance&#39;@&#39;%&#39; \
  IDENTIFIED BY &#39;GLANCE_DBPASS&#39;;</pre><p>Replace <code>GLANCE_DBPASS</code> with a suitable password.</p></li><li><p>Exit the database access client.</p></li></ul></li><li><p>Source the <code>admin</code> credentials to gain access to admin-only CLI commands:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ . admin-openrc</pre></li><li><p>To create the service credentials, complete these steps:</p><ul><li><p>Create the <code>glance</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack user create --domain default --password-prompt glance

User Password:
Repeat User Password:
+---------------------+----------------------------------+
| Field               | Value                            |
+---------------------+----------------------------------+
| domain_id           | default                          |
| enabled             | True                             |
| id                  | 3f4e777c4062483ab8d9edd7dff829df |
| name                | glance                           |
| password_expires_at | None                             |
+---------------------+----------------------------------+</pre></li><li><p>Add the <code>admin</code> role to the <code>glance</code> user and <code>service</code> project:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack role add --project service --user glance admin</pre><p>This command provides no output.</p></li><li><p>Create the <code>glance</code> service entity:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack service create --name glance \
  --description &quot;OpenStack Image&quot; image

+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | OpenStack Image                  |
| enabled     | True                             |
| id          | 8c2c7f1b9b5049ea9e63757b5533e6d2 |
| name        | glance                           |
| type        | image                            |
+-------------+----------------------------------+</pre></li></ul></li><li><p>Create the Image service API endpoints:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack endpoint create --region RegionOne \
  image public http://controller:9292

+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 340be3625e9b4239a6415d034e98aace |
| interface    | public                           |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 8c2c7f1b9b5049ea9e63757b5533e6d2 |
| service_name | glance                           |
| service_type | image                            |
| url          | http://controller:9292           |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne \
  image internal http://controller:9292

+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | a6e4b153c2ae4c919eccfdbb7dceb5d2 |
| interface    | internal                         |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 8c2c7f1b9b5049ea9e63757b5533e6d2 |
| service_name | glance                           |
| service_type | image                            |
| url          | http://controller:9292           |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne \
  image admin http://controller:9292

+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 0c37ed58103f4300a84ff125a539032d |
| interface    | admin                            |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 8c2c7f1b9b5049ea9e63757b5533e6d2 |
| service_name | glance                           |
| service_type | image                            |
| url          | http://controller:9292           |
+--------------+----------------------------------+</pre></li></ol><h3><a name='header-n412' class='md-header-anchor '></a>Install and configure components</h3><p>Install the packages:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># apt install glance -y</pre><ol start='' ><li><p>Edit the <code>/etc/glance/glance-api.conf</code> file and complete the following actions:</p><ul><li><p>In the <code>[database]</code> section, configure database access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[database]
...
connection = mysql+pymysql://glance:GLANCE_DBPASS@controller/glance</pre><p>Replace <code>GLANCE_DBPASS</code> with the password you chose for the Image service database.</p></li><li><p>In the <code>[keystone_authtoken]</code> and <code>[paste_deploy]</code> sections, configure Identity service access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[keystone_authtoken]
...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = Default
user_domain_name = Default
project_name = service
username = glance
password = glance

[paste_deploy]
...
flavor = keystone</pre><p>Replace <code>password = glance</code> with the password you chose for the <code>glance</code> user in the Identity service.</p><p>​</p><p>Comment out or remove any other options in the <code>[keystone_authtoken]</code> section.</p></li><li><p>In the <code>[glance_store]</code> section, configure the local file system store and location of image files:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[glance_store]
...
stores = file,http
default_store = file
filesystem_store_datadir = /var/lib/glance/images/</pre></li></ul></li><li><p>Edit the <code>/etc/glance/glance-registry.conf</code> file and complete the following actions:</p><ul><li><p>In the <code>[database]</code> section, configure database access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[database]
...
connection = mysql+pymysql://glance:GLANCE_DBPASS@controller/glance</pre><p>Replace <code>GLANCE_DBPASS</code> with the password you chose for the Image service database.</p></li><li><p>In the <code>[keystone_authtoken]</code> and <code>[paste_deploy]</code> sections, configure Identity service access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[keystone_authtoken]
...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = Default
user_domain_name = Default
project_name = service
username = glance
password = glance

[paste_deploy]
...
flavor = keystone</pre><p>Replace <code>password = glance</code> with the password you chose for the <code>glance</code> user in the Identity service.</p><p>Comment out or remove any other options in the <code>[keystone_authtoken]</code> section.</p></li></ul></li></ol><p>Populate the Image service database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># su -s /bin/sh -c &quot;glance-manage db_sync&quot; glance</pre><p>Ignore any deprecation messages in this output.</p><h3><a name='header-n464' class='md-header-anchor '></a>Finalize installation</h3><p>Restart the Image services:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service glance-registry restart
# service glance-api restart</pre><h3><a name='header-n468' class='md-header-anchor '></a>Verify operation</h3><p>Verify operation of the Image service using <a href='http://launchpad.net/cirros'>CirrOS</a>, a small Linux image that helps you test your OpenStack deployment.</p><p>For more information about how to download and build images, see <a href='http://docs.openstack.org/image-guide/'>OpenStack Virtual Machine Image Guide</a>. For information about how to manage images, see the <a href='http://docs.openstack.org/user-guide/common/cli-manage-images.html'>OpenStack End User Guide</a>.</p><p></p><ol start='' ><li><p>Source the <code>admin</code> credentials to gain access to admin-only CLI commands:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ . admin-openrc</pre></li><li><p>Download the source image:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ wget http://download.cirros-cloud.net/0.3.4/cirros-0.3.4-x86_64-disk.img</pre><blockquote><p>tip: add proxy to improve speed in office network</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ export http_proxy=http://www-proxy.exu.ericsson.se:8080

// after wget

$ unset http_proxy</pre></blockquote><p>Install <code>wget</code> if your distribution does not include it.</p></li><li><p>Upload the image to the Image service using the <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-qemu-copy-on-write-2-qcow2'>QCOW2</a> disk format, <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-bare'>bare</a> container format, and public visibility so all projects can access it:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack image create &quot;cirros&quot; \
  --file cirros-0.3.4-x86_64-disk.img \
  --disk-format qcow2 --container-format bare \
  --public

+------------------+------------------------------------------------------+
| Field            | Value                                                |
+------------------+------------------------------------------------------+
| checksum         | 133eae9fb1c98f45894a4e60d8736619                     |
| container_format | bare                                                 |
| created_at       | 2015-03-26T16:52:10Z                                 |
| disk_format      | qcow2                                                |
| file             | /v2/images/cc5c6982-4910-471e-b864-1098015901b5/file |
| id               | cc5c6982-4910-471e-b864-1098015901b5                 |
| min_disk         | 0                                                    |
| min_ram          | 0                                                    |
| name             | cirros                                               |
| owner            | ae7a98326b9c455588edd2656d723b9d                     |
| protected        | False                                                |
| schema           | /v2/schemas/image                                    |
| size             | 13200896                                             |
| status           | active                                               |
| tags             |                                                      |
| updated_at       | 2015-03-26T16:52:10Z                                 |
| virtual_size     | None                                                 |
| visibility       | public                                               |
+------------------+------------------------------------------------------+</pre><p>For information about the <strong>openstack image create</strong> parameters, see <a href='http://docs.openstack.org/user-guide/common/cli-manage-images.html#create-or-update-an-image-glance'>Create or update an image (glance)</a> in the <code>OpenStack UserGuide</code>.</p><p>For information about disk and container formats for images, see <a href='http://docs.openstack.org/image-guide/image-formats.html'>Disk and container formats for images</a> in the <code>OpenStack VirtualMachine Image Guide</code>.</p><p>​</p><p>OpenStack generates IDs dynamically, so you will see different values in the example command output.</p></li><li><p>Confirm upload of the image and validate attributes:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack image list

+--------------------------------------+--------+--------+
| ID                                   | Name   | Status |
+--------------------------------------+--------+--------+
| 38047887-61a7-41ea-9b49-27987d5e8bb9 | cirros | active |
+--------------------------------------+--------+--------+</pre></li></ol><h2><a name='header-n506' class='md-header-anchor '></a>Nova installation</h2><blockquote><p>ref: <a href='https://docs.openstack.org/newton/install-guide-ubuntu/nova.html' target='_blank' >https://docs.openstack.org/newton/install-guide-ubuntu/nova.html</a></p></blockquote><h2><a name='header-n510' class='md-header-anchor '></a>Nova install and configure controller node</h2><h3><a name='header-n511' class='md-header-anchor '></a>Prerequisites</h3><p>Before you install and configure the Compute service, you must create databases, service credentials, and API endpoints.</p><ol start='' ><li><p>To create the databases, complete these steps:</p><ul><li><p>Use the database access client to connect to the database server as the <code>root</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># mysql
</pre></li></ul></li></ol><ul><li><p>Create the <code>nova_api</code>, <code>nova</code>, and <code>nova_cell0</code> databases:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>MariaDB [(none)]&gt; CREATE DATABASE nova_api;
MariaDB [(none)]&gt; CREATE DATABASE nova;
MariaDB [(none)]&gt; CREATE DATABASE nova_cell0;
</pre></li><li><p>Grant proper access to the databases:</p><pre class='md-fences mock-cm' style='display:block;position:relative'> ​```
 MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_api.* TO &#39;nova&#39;@&#39;localhost&#39; \
   IDENTIFIED BY &#39;NOVA_DBPASS&#39;;
 MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_api.* TO &#39;nova&#39;@&#39;%&#39; \
   IDENTIFIED BY &#39;NOVA_DBPASS&#39;;
 
 MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova.* TO &#39;nova&#39;@&#39;localhost&#39; \
   IDENTIFIED BY &#39;NOVA_DBPASS&#39;;
 MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova.* TO &#39;nova&#39;@&#39;%&#39; \
   IDENTIFIED BY &#39;NOVA_DBPASS&#39;;
 
 MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_cell0.* TO &#39;nova&#39;@&#39;localhost&#39; \
   IDENTIFIED BY &#39;NOVA_DBPASS&#39;;
 MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_cell0.* TO &#39;nova&#39;@&#39;%&#39; \
   IDENTIFIED BY &#39;NOVA_DBPASS&#39;;
 
 ​```
 
 Replace `NOVA_DBPASS` with a suitable password.</pre><ul><li>Exit the database access client.</li></ul></li></ul><ol start='' ><li><p>Source the <code>admin</code> credentials to gain access to admin-only CLI commands:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ . admin-openrc
</pre></li><li><p>Create the Compute service credentials:</p><ul><li><p>Create the <code>nova</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack user create --domain default --password-prompt nova

User Password:
Repeat User Password:
+---------------------+----------------------------------+
| Field               | Value                            |
+---------------------+----------------------------------+
| domain_id           | default                          |
| enabled             | True                             |
| id                  | 8a7dbf5279404537b1c7b86c033620fe |
| name                | nova                             |
| options             | {}                               |
| password_expires_at | None                             |
+---------------------+----------------------------------+</pre></li><li><p>Add the <code>admin</code> role to the <code>nova</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack role add --project service --user nova admin</pre><p>This command provides no output.</p></li><li><p>Create the <code>nova</code> service entity:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack service create --name nova \
  --description &quot;OpenStack Compute&quot; compute

+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | OpenStack Compute                |
| enabled     | True                             |
| id          | 060d59eac51b4594815603d75a00aba2 |
| name        | nova                             |
| type        | compute                          |
+-------------+----------------------------------+
</pre></li></ul></li><li><p>Create the Compute API service endpoints:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack endpoint create --region RegionOne \
  compute public http://controller:8774/v2.1

+--------------+-------------------------------------------+
| Field        | Value                                     |
+--------------+-------------------------------------------+
| enabled      | True                                      |
| id           | 3c1caa473bfe4390a11e7177894bcc7b          |
| interface    | public                                    |
| region       | RegionOne                                 |
| region_id    | RegionOne                                 |
| service_id   | 060d59eac51b4594815603d75a00aba2          |
| service_name | nova                                      |
| service_type | compute                                   |
| url          | http://controller:8774/v2.1               |
+--------------+-------------------------------------------+

$ openstack endpoint create --region RegionOne \
  compute internal http://controller:8774/v2.1

+--------------+-------------------------------------------+
| Field        | Value                                     |
+--------------+-------------------------------------------+
| enabled      | True                                      |
| id           | e3c918de680746a586eac1f2d9bc10ab          |
| interface    | internal                                  |
| region       | RegionOne                                 |
| region_id    | RegionOne                                 |
| service_id   | 060d59eac51b4594815603d75a00aba2          |
| service_name | nova                                      |
| service_type | compute                                   |
| url          | http://controller:8774/v2.1               |
+--------------+-------------------------------------------+

$ openstack endpoint create --region RegionOne \
  compute admin http://controller:8774/v2.1

+--------------+-------------------------------------------+
| Field        | Value                                     |
+--------------+-------------------------------------------+
| enabled      | True                                      |
| id           | 38f7af91666a47cfb97b4dc790b94424          |
| interface    | admin                                     |
| region       | RegionOne                                 |
| region_id    | RegionOne                                 |
| service_id   | 060d59eac51b4594815603d75a00aba2          |
| service_name | nova                                      |
| service_type | compute                                   |
| url          | http://controller:8774/v2.1               |
+--------------+-------------------------------------------+
</pre></li><li><p>Create a Placement service user using your chosen <code>PLACEMENT_PASS</code>:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack user create --domain default --password-prompt placement

User Password:
Repeat User Password:
+---------------------+----------------------------------+
| Field               | Value                            |
+---------------------+----------------------------------+
| domain_id           | default                          |
| enabled             | True                             |
| id                  | fa742015a6494a949f67629884fc7ec8 |
| name                | placement                        |
| options             | {}                               |
| password_expires_at | None                             |
+---------------------+----------------------------------+
</pre></li><li><p>Add the Placement user to the service project with the admin role:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack role add --project service --user placement admin
</pre><p>This command provides no output.</p></li><li><p>Create the Placement API entry in the service catalog:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack service create --name placement --description &quot;Placement API&quot; placement
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Placement API                    |
| enabled     | True                             |
| id          | 2d1a27022e6e4185b86adac4444c495f |
| name        | placement                        |
| type        | placement                        |
+-------------+----------------------------------+</pre></li><li><p>Create the Placement API service endpoints:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack endpoint create --region RegionOne placement public http://controller:8778
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 2b1b2637908b4137a9c2e0470487cbc0 |
| interface    | public                           |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 2d1a27022e6e4185b86adac4444c495f |
| service_name | placement                        |
| service_type | placement                        |
| url          | http://controller:8778           |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne placement internal http://controller:8778
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 02bcda9a150a4bd7993ff4879df971ab |
| interface    | internal                         |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 2d1a27022e6e4185b86adac4444c495f |
| service_name | placement                        |
| service_type | placement                        |
| url          | http://controller:8778           |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne placement admin http://controller:8778
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 3d71177b9e0f406f98cbff198d74b182 |
| interface    | admin                            |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 2d1a27022e6e4185b86adac4444c495f |
| service_name | placement                        |
| service_type | placement                        |
| url          | http://controller:8778           |
+--------------+----------------------------------+
</pre></li></ol><h3><a name='header-n581' class='md-header-anchor '></a>Install and configure components</h3><p> </p><p>Default configuration files vary by distribution. You might need to add these sections and options rather than modifying existing sections and options. Also, an ellipsis (<code>...</code>) in the configuration snippets indicates potential default configuration options that you should retain.</p><ol start='' ><li><p>Install the packages:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># apt install nova-api nova-conductor nova-consoleauth \
  nova-novncproxy nova-scheduler nova-placement-api
</pre></li></ol><ol start='' ><li><p>Edit the <code>/etc/nova/nova.conf</code> file and complete the following actions:</p><ul><li><p>In the <code>[api_database]</code> and <code>[database]</code> sections, configure database access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[api_database]
# ...
connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova_api

[database]
# ...
connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova
</pre><p>Replace <code>NOVA_DBPASS</code> with the password you chose for the Compute databases.</p></li><li><p>In the <code>[DEFAULT]</code> section, configure <code>RabbitMQ</code> message queue access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
# ...
transport_url = rabbit://openstack:RABBIT_PASS@controller
</pre><p>Replace <code>RABBIT_PASS</code> with the password you chose for the <code>openstack</code> account in <code>RabbitMQ</code>.</p></li><li><p>In the <code>[api]</code> and <code>[keystone_authtoken]</code> sections, configure Identity service access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[api]
# ...
auth_strategy = keystone

[keystone_authtoken]
# ...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = nova
password = nova</pre><p>Replace <code>nova</code> with the password you chose for the <code>nova</code> user in the Identity service.</p><p>Comment out or remove any other options in the <code>[keystone_authtoken]</code> section.</p></li><li><p>In the <code>[DEFAULT]</code> section, configure the <code>my_ip</code> option to use the management interface IP address of the controller node:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
# ...
my_ip = 10.20.0.20</pre></li></ul></li></ol><ul><li><p>In the <code>[DEFAULT]</code> section, enable support for the Networking service:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
# ...
use_neutron = True
firewall_driver = nova.virt.firewall.NoopFirewallDriver
</pre><p>By default, Compute uses an internal firewall driver. Since the Networking service includes a firewall driver, you must disable the Compute firewall driver by using the <code>nova.virt.firewall.NoopFirewallDriver</code> firewall driver.</p></li></ul><ul><li><p>In the <code>[vnc]</code> section, configure the VNC proxy to use the management interface IP address of the controller node:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[vnc]
enabled = true
# ...
vncserver_listen = $my_ip
vncserver_proxyclient_address = $my_ip
</pre></li></ul><ul><li><p>In the <code>[glance]</code> section, configure the location of the Image service API:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[glance]
# ...
api_servers = http://controller:9292
</pre></li></ul><ul><li><p>In the <code>[oslo_concurrency]</code> section, configure the lock path:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[oslo_concurrency]
# ...
lock_path = /var/lib/nova/tmp
</pre></li></ul><ul><li>Due to a packaging bug, remove the <code>log_dir</code> option from the <code>[DEFAULT]</code> section.</li></ul><ul><li><p>In the <code>[placement]</code> section, configure the Placement API:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[placement]
# ...
os_region_name = RegionOne
project_domain_name = Default
project_name = service
auth_type = password
user_domain_name = Default
auth_url = http://controller:35357/v3
username = placement
password = PLACEMENT_PASS
</pre><p>Replace <code>PLACEMENT_PASS</code> with the password you choose for the <code>placement</code> user in the Identity service. Comment out any other options in the <code>[placement]</code> section.</p></li></ul><ol start='' ><li><p>Populate the nova-api database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># su -s /bin/sh -c &quot;nova-manage api_db sync&quot; nova
</pre><p>Ignore any deprecation messages in this output.</p></li><li><p>Register the <code>cell0</code> database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># su -s /bin/sh -c &quot;nova-manage cell_v2 map_cell0&quot; nova
</pre></li><li><p>Create the <code>cell1</code> cell:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># su -s /bin/sh -c &quot;nova-manage cell_v2 create_cell --name=cell1 --verbose&quot; nova
109e1d4b-536a-40d0-83c6-5f121b82b650
</pre></li><li><p>Populate the nova database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># su -s /bin/sh -c &quot;nova-manage db sync&quot; nova
</pre></li><li><p>Verify nova cell0 and cell1 are registered correctly:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># nova-manage cell_v2 list_cells
+-------+--------------------------------------+
| Name  | UUID                                 |
+-------+--------------------------------------+
| cell1 | 109e1d4b-536a-40d0-83c6-5f121b82b650 |
| cell0 | 00000000-0000-0000-0000-000000000000 |
+-------+--------------------------------------+
</pre></li></ol><h3><a name='header-n676' class='md-header-anchor '></a>Finalize installation</h3><ul><li><p>Restart the Compute services:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service nova-api restart
# service nova-consoleauth restart
# service nova-scheduler restart
# service nova-conductor restart
# service nova-novncproxy restart</pre></li></ul><h2><a name='header-n682' class='md-header-anchor '></a>Nova Install and configure a compute node</h2><p>This section describes how to install and configure the Compute service on a compute node. The service supports several <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-hypervisor'>hypervisors</a> to deploy <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-instance'>instances</a> or <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-virtual-machine-vm'>VMs</a>. For simplicity, this configuration uses the <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-quick-emulator-qemu'>QEMU</a> hyper visor with the <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-kernel-based-vm-kvm'>KVM</a> extension on compute nodes that support hardware acceleration for virtual machines. </p><h3><a name='header-n685' class='md-header-anchor '></a>Install and configure components</h3><p></p><ol start='' ><li><p>Install the packages:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># apt install nova-compute</pre></li></ol><ol start='' ><li><p>Edit the <code>/etc/nova/nova.conf</code> file and complete the following actions:</p><ul><li><p>In the <code>[DEFAULT]</code> section, configure <code>RabbitMQ</code> message queue access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
...
transport_url = rabbit://openstack:RABBIT_PASS@controller</pre><p>Replace <code>RABBIT_PASS</code> with the password you chose for the <code>openstack</code> account in <code>RabbitMQ</code>.</p></li><li><p>In the <code>[DEFAULT]</code> and <code>[keystone_authtoken]</code> sections, configure Identity service access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
...
auth_strategy = keystone

[keystone_authtoken]
...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = Default
user_domain_name = Default
project_name = service
username = nova
password = nova</pre><p>Replace <code>password = nova</code> with the password you chose for the <code>nova</code> user in the Identity service.</p><p>Comment out or remove any other options in the <code>[keystone_authtoken]</code> section.</p></li></ul></li></ol><ul><li><p>In the <code>[DEFAULT]</code> section, configure the <code>my_ip</code> option:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
...
my_ip = MANAGEMENT_INTERFACE_IP_ADDRESS</pre><p>Replace <code>MANAGEMENT_INTERFACE_IP_ADDRESS</code> with the IP address of the management network interface on your compute node, typically 10.0.0.31 for the first node in the <a href='https://docs.openstack.org/newton/install-guide-ubuntu/overview.html#overview-example-architectures'>example architecture</a>.</p></li></ul><pre class='md-fences mock-cm' style='display:block;position:relative'> &gt;  here our compute is 10.20.0.20</pre><ul><li><p>In the <code>[DEFAULT]</code> section, enable support for the Networking service:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>   ```
   [DEFAULT]
   ...
   use_neutron = True
   firewall_driver = nova.virt.firewall.NoopFirewallDriver
   ```
 
   By default, Compute uses an internal firewall service. Since Networking includes a firewall service, you must disable the Compute firewall service by using the `nova.virt.firewall.NoopFirewallDriver` firewall driver.</pre></li></ul><ul><li><p>In the <code>[vnc]</code> section, enable and configure remote console access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[vnc]
...
enabled = True
vncserver_listen = 0.0.0.0
vncserver_proxyclient_address = $my_ip
novncproxy_base_url = http://controller:6080/vnc_auto.html
</pre><p>The server component listens on all IP addresses and the proxy component only listens on the management interface IP address of the compute node. </p><p>The base URL indicates the location where you can use a web browser to access remote consoles of instances on this compute node.</p><p>If the web browser to access remote consoles resides on a host that cannot resolve the <code>controller</code> hostname, you must replace <code>controller</code> with the management interface IP address of the controller node.</p></li><li><p>In the <code>[glance]</code> section, configure the location of the Image service API:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>```
[glance]
...
api_servers = http://controller:9292
  
```</pre></li></ul><ul><li><p>In the <code>[oslo_concurrency]</code> section, configure the lock path:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[oslo_concurrency]
...
lock_path = /var/lib/nova/tmp</pre></li></ul><ul><li><p>Due to a packaging bug, remove the <code>log-dir</code> option from the <code>[DEFAULT]</code> section.</p></li><li><p>In the <code>[placement]</code> section, configure the Placement API:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>```
[placement]
# ...
os_region_name = RegionOne
project_domain_name = Default
project_name = service
auth_type = password
user_domain_name = Default
auth_url = http://controller:35357/v3
username = placement
password = placement
```
  
Replace `placement` with the password you choose for the `placement` user in the Identity service. Comment out any other options in the `[placement]` section.</pre></li></ul><h3><a name='header-n755' class='md-header-anchor '></a>Finalize installation</h3><p>Determine whether your compute node supports hardware acceleration for virtual machines:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ egrep -c &#39;(vmx|svm)&#39; /proc/cpuinfo</pre><p>If this command returns a value of <code>one or greater</code>, your compute node supports hardware acceleration which typically requires no additional configuration.</p><p>If this command returns a value of <code>zero</code>, your compute node does not support hardware acceleration and you must configure <code>libvirt</code> to use QEMU instead of KVM.</p><ul><li><p>Edit the <code>[libvirt]</code> section in the <code>/etc/nova/nova-compute.conf</code> file as follows:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[libvirt]
...
virt_type = qemu</pre></li></ul><p>Restart the Compute service:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service nova-compute restart</pre><h3><a name='header-n771' class='md-header-anchor '></a>Add the compute node to the cell database</h3><p>Run the following commands on the <strong>controller</strong> node.</p><ol start='' ><li><p>Source the admin credentials to enable admin-only CLI commands, then confirm there are compute hosts in the database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ . admin-openrc

$ openstack hypervisor list
+----+---------------------+-----------------+-----------+-------+
| ID | Hypervisor Hostname | Hypervisor Type | Host IP   | State |
+----+---------------------+-----------------+-----------+-------+
|  1 | compute1            | QEMU            | 10.0.0.31 | up    |
+----+---------------------+-----------------+-----------+-------+
</pre></li><li><p>Discover compute hosts:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># su -s /bin/sh -c &quot;nova-manage cell_v2 discover_hosts --verbose&quot; nova

Found 2 cell mappings.
Skipping cell0 since it does not contain hosts.
Getting compute nodes from cell &#39;cell1&#39;: ad5a5985-a719-4567-98d8-8d148aaae4bc
Found 1 computes in cell: ad5a5985-a719-4567-98d8-8d148aaae4bc
Checking host mapping for compute host &#39;compute&#39;: fe58ddc1-1d65-4f87-9456-bc040dc106b3
Creating host mapping for compute host &#39;compute&#39;: fe58ddc1-1d65-4f87-9456-bc040dc106b3</pre><p>​</p><p>When you add new compute nodes, you must run <code>nova-manage cell_v2 discover_hosts</code> on the controller node to register those new compute nodes. Alternatively, you can set an appropriate interval in <code>/etc/nova/nova.conf</code>:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[scheduler]
discover_hosts_in_cells_interval = 300</pre></li></ol><h2><a name='header-n788' class='md-header-anchor '></a>Neutron installation</h2><blockquote><p>ref: <a href='https://docs.openstack.org/newton/install-guide-ubuntu/neutron.html' target='_blank' >https://docs.openstack.org/newton/install-guide-ubuntu/neutron.html</a></p></blockquote><p></p><p>This chapter explains how to install and configure the Networking service (neutron) using the <a href='https://docs.openstack.org/newton/install-guide-ubuntu/overview.html#network1'>provider networks</a>. </p><p>For more information about the Networking service including virtual networking components, layout, and traffic flows, see the <a href='http://docs.openstack.org/newton/networking-guide/'>OpenStack Networking Guide</a>.</p><h2><a name='header-n798' class='md-header-anchor '></a>Tenant/Project network configuration</h2><p>On both Controller and Compute node, Tenant/Project network (eth1 in our design) need to be configured:</p><p><code># vi /etc/network/interfaces</code></p><p>Add below lines accordingly:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>## provider network
auto enp0s8
iface enp0s8 inet static
address 172.16.0.x (10 for controller 20 for compute)
netmask 255.255.255.0</pre><h2><a name='header-n806' class='md-header-anchor '></a>Neutron Install and configure controller node</h2><h3><a name='header-n807' class='md-header-anchor '></a>Prerequisites</h3><p>Before you configure the OpenStack Networking (neutron) service, you must create a database, service credentials, and API endpoints.</p><ol start='' ><li><p>To create the database, complete these steps:</p><ul><li><p>Use the database access client to connect to the database server as the <code>root</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ mysql -u root -p</pre></li><li><p>Create the <code>neutron</code> database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>mysql&gt; CREATE DATABASE neutron;</pre></li><li><p>Grant proper access to the <code>neutron</code> database, replacing <code>NEUTRON_DBPASS</code> with a suitable password:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>mysql&gt; GRANT ALL PRIVILEGES ON neutron.* TO &#39;neutron&#39;@&#39;localhost&#39; \
  IDENTIFIED BY &#39;NEUTRON_DBPASS&#39;;
mysql&gt; GRANT ALL PRIVILEGES ON neutron.* TO &#39;neutron&#39;@&#39;%&#39; \
  IDENTIFIED BY &#39;NEUTRON_DBPASS&#39;;</pre></li><li><p>Exit the database access client.</p></li></ul></li><li><p>Source the <code>admin</code> credentials to gain access to admin-only CLI commands:</p><pre class="md-fences md-end-block" lang="bash"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 23px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ </span>. admin-openrc</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 53px;"></div></div></div></pre></li><li><p>To create the service credentials, complete these steps:</p><ul><li><p>Create the <code>neutron</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack user create --domain default --password-prompt neutron

User Password:
Repeat User Password:
+---------------------+----------------------------------+
| Field               | Value                            |
+---------------------+----------------------------------+
| domain_id           | default                          |
| enabled             | True                             |
| id                  | 319f34694728440eb8ffcb27b6dd8b8a |
| name                | neutron                          |
| password_expires_at | None                             |
+---------------------+----------------------------------+</pre></li><li><p>Add the <code>admin</code> role to the <code>neutron</code> user:</p><pre class="md-fences md-end-block" lang="bash"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 23px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ openstack</span> role add <span class="cm-attribute">--project</span> <span class="cm-builtin">service</span> <span class="cm-attribute">--user</span> neutron admin</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 53px;"></div></div></div></pre><p>This command provides no output.</p></li><li><p>Create the <code>neutron</code> service entity:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack service create --name neutron \
  --description &quot;OpenStack Networking&quot; network

+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | OpenStack Networking             |
| enabled     | True                             |
| id          | f71529314dab4a4d8eca427e701d209e |
| name        | neutron                          |
| type        | network                          |
+-------------+----------------------------------+</pre></li></ul></li><li><p>Create the Networking service API endpoints:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack endpoint create --region RegionOne \
  network public http://controller:9696

+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 85d80a6d02fc4b7683f611d7fc1493a3 |
| interface    | public                           |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | f71529314dab4a4d8eca427e701d209e |
| service_name | neutron                          |
| service_type | network                          |
| url          | http://controller:9696           |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne \
  network internal http://controller:9696

+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 09753b537ac74422a68d2d791cf3714f |
| interface    | internal                         |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | f71529314dab4a4d8eca427e701d209e |
| service_name | neutron                          |
| service_type | network                          |
| url          | http://controller:9696           |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne \
  network admin http://controller:9696

+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 1ee14289c9374dffb5db92a5c112fc4e |
| interface    | admin                            |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | f71529314dab4a4d8eca427e701d209e |
| service_name | neutron                          |
| service_type | network                          |
| url          | http://controller:9696           |
+--------------+----------------------------------+</pre></li></ol><h3><a name='header-n856' class='md-header-anchor '></a>Configure networking options</h3><p>You can deploy the Networking service using one of two architectures represented by options 1 and 2.</p><p>Option 1 deploys the simplest possible architecture that only supports attaching instances to provider (external) networks. No self-service (private) networks, routers, or floating IP addresses. Only the <code>admin</code> or other privileged user can manage provider networks.</p><ul><li><a href='https://docs.openstack.org/newton/install-guide-ubuntu/neutron-controller-install-option1.html'>Networking Option 1: Provider networks</a></li></ul><p>Here we choose Option 1.</p><h3><a name='header-n867' class='md-header-anchor '></a>Networking Option 1: Provider networks</h3><p>Install and configure the Networking components on the <em>controller</em> node.</p><h3><a name='header-n870' class='md-header-anchor '></a>Install the components</h3><pre class='md-fences mock-cm' style='display:block;position:relative'># apt install neutron-server neutron-plugin-ml2 \
  neutron-linuxbridge-agent neutron-dhcp-agent \
  neutron-metadata-agent -y</pre><h3><a name='header-n872' class='md-header-anchor '></a>Configure the server component</h3><p>The Networking server component configuration includes the database, authentication mechanism, message queue, topology change notifications, and plug-in.</p><ul><li><p>Edit the <code>/etc/neutron/neutron.conf</code> file and complete the following actions:</p><ul><li><p>In the <code>[database]</code> section, configure database access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[database]
...
connection = mysql+pymysql://neutron:NEUTRON_DBPASS@controller/neutron</pre><p>Replace <code>NEUTRON_DBPASS</code> with the password you chose for the database.</p><p>Comment out or remove any other <code>connection</code> options in the <code>[database]</code> section.</p></li><li><p>In the <code>[DEFAULT]</code> section, enable the Modular Layer 2 (ML2) plug-in and disable additional plug-ins:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
...
core_plugin = ml2
service_plugins =</pre></li><li><p>In the <code>[DEFAULT]</code> section, configure <code>RabbitMQ</code> message queue access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
...
transport_url = rabbit://openstack:RABBIT_PASS@controller</pre><p>Replace <code>RABBIT_PASS</code> with the password you chose for the <code>openstack</code> account in RabbitMQ.</p></li><li><p>In the <code>[DEFAULT]</code> and <code>[keystone_authtoken]</code> sections, configure Identity service access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
...
auth_strategy = keystone

[keystone_authtoken]
...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = Default
user_domain_name = Default
project_name = service
username = neutron
password = neutron</pre><p>Replace <code>password = neutron</code> with the password you chose for the <code>neutron</code> user in the Identity service.</p><p>Comment out or remove any other options in the <code>[keystone_authtoken]</code> section.</p></li><li><p>In the <code>[DEFAULT]</code> and <code>[nova]</code> sections, configure Networking to notify Compute of network topology changes:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
...
notify_nova_on_port_status_changes = True
notify_nova_on_port_data_changes = True

[nova]
...
auth_url = http://controller:35357
auth_type = password
project_domain_name = Default
user_domain_name = Default
region_name = RegionOne
project_name = service
username = nova
password = nova</pre><p>Replace <code>password = nova</code> with the password you chose for the <code>nova</code> user in the Identity service.</p></li></ul></li></ul><h3><a name='header-n912' class='md-header-anchor '></a>Configure the Modular Layer 2 (ML2) plug-in</h3><p>The ML2 plug-in uses the Linux bridge mechanism to build layer-2 (bridging and switching) virtual networking infrastructure for instances.</p><ul><li><p>Edit the <code>/etc/neutron/plugins/ml2/ml2_conf.ini</code> file and complete the following actions:</p><ul><li><p>In the <code>[ml2]</code> section, enable flat and VLAN networks:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[ml2]
...
type_drivers = flat,vlan</pre></li><li><p>In the <code>[ml2]</code> section, disable self-service networks:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[ml2]
...
tenant_network_types =
</pre></li><li><p>In the <code>[ml2]</code> section, enable the Linux bridge mechanism:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[ml2]
...
mechanism_drivers = linuxbridge</pre><p>After you configure the ML2 plug-in, removing values in the <code>type_drivers</code> option can lead to database inconsistency.</p></li><li><p>In the <code>[ml2]</code> section, enable the port security extension driver:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[ml2]
...
extension_drivers = port_security</pre></li><li><p>In the <code>[ml2_type_flat]</code> section, configure the provider virtual network as a flat network:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[ml2_type_flat]
...
flat_networks = provider
</pre></li><li><p>In the <code>[securitygroup]</code> section, enable <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-ipset'>ipset</a> to increase efficiency of security group rules:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[securitygroup]
...
enable_ipset = True</pre></li></ul></li></ul><h3><a name='header-n946' class='md-header-anchor '></a>Configure the Linux bridge agent</h3><p>The Linux bridge agent builds layer-2 (bridging and switching) virtual networking infrastructure for instances and handles security groups.</p><ul><li><p>Edit the <code>/etc/neutron/plugins/ml2/linuxbridge_agent.ini</code> file and complete the following actions:</p><ul><li><p>In the <code>[linux_bridge]</code> section, map the provider virtual network to the provider physical network interface:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[linux_bridge]
physical_interface_mappings = provider:PROVIDER_INTERFACE_NAME</pre><p>Replace <code>PROVIDER_INTERFACE_NAME</code> with the name of the underlying provider physical network interface. See <a href='https://docs.openstack.org/newton/install-guide-ubuntu/environment-networking.html#environment-networking'>Host networking</a> for more information.</p><p>in our case it is: enp0s10, the bridged nic of controller network.</p><p>​</p></li><li><p>In the <code>[vxlan]</code> section, disable VXLAN overlay networks:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[vxlan]
enable_vxlan = False
</pre></li><li><p>In the <code>[securitygroup]</code> section, enable security groups and configure the Linux bridge <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-iptables'>iptables</a> firewall driver:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[securitygroup]
...
enable_security_group = True
firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</pre></li></ul></li></ul><h3><a name='header-n972' class='md-header-anchor '></a>Configure the DHCP agent</h3><p>The <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-dhcp-agent'>DHCP agent</a> provides DHCP services for virtual networks.</p><ul><li><p>Edit the <code>/etc/neutron/dhcp_agent.ini</code> file and complete the following actions:</p><ul><li><p>In the <code>[DEFAULT]</code> section, configure the Linux bridge interface driver, Dnsmasq DHCP driver, and enable isolated metadata so instances on provider networks can access metadata over the network:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
...
interface_driver = neutron.agent.linux.interface.BridgeInterfaceDriver
dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq
enable_isolated_metadata = True</pre></li></ul></li></ul><p>Return to <a href='https://docs.openstack.org/newton/install-guide-ubuntu/neutron-controller-install.html#neutron-controller-metadata-agent'>Networking controller node configuration</a>.</p><h3><a name='header-n986' class='md-header-anchor '></a>Configure the metadata agent</h3><p>The <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-metadata-agent'>metadata agent</a> provides configuration information such as credentials to instances.</p><ul><li><p>Edit the <code>/etc/neutron/metadata_agent.ini</code> file and complete the following actions:</p><ul><li><p>In the <code>[DEFAULT]</code> section, configure the metadata host and shared secret:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
...
nova_metadata_ip = controller
metadata_proxy_shared_secret = METADATA_SECRET
</pre><p>Replace <code>METADATA_SECRET</code> with a suitable secret for the metadata proxy.</p></li></ul></li></ul><h3><a name='header-n1000' class='md-header-anchor '></a>Configure the Compute service to use the Networking service</h3><ul><li><p>Edit the <code>/etc/nova/nova.conf</code> file and perform the following actions:</p><ul><li><p>In the <code>[neutron]</code> section, configure access parameters, enable the metadata proxy, and configure the secret:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[neutron]
...
url = http://controller:9696
auth_url = http://controller:35357
auth_type = password
project_domain_name = Default
user_domain_name = Default
region_name = RegionOne
project_name = service
username = neutron
password = neutron
service_metadata_proxy = True
metadata_proxy_shared_secret = METADATA_SECRET</pre><p>Replace <code>password = neutron</code> with the password you chose for the <code>neutron</code> user in the Identity service.</p><p>Replace <code>METADATA_SECRET</code> with the secret you chose for the metadata proxy.</p></li></ul></li></ul><h3><a name='header-n1014' class='md-header-anchor '></a>Finalize installation</h3><ol start='' ><li><p>Populate the database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># su -s /bin/sh -c &quot;neutron-db-manage --config-file /etc/neutron/neutron.conf \
  --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot; neutron</pre><p>Database population occurs later for Networking because the script requires complete server and plug-in configuration files.</p></li><li><p>Restart the Compute API service:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service nova-api restart</pre></li><li><p>Restart the Networking services.</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service neutron-server restart
# service neutron-linuxbridge-agent restart
# service neutron-dhcp-agent restart
# service neutron-metadata-agent restart</pre></li></ol><h3><a name='header-n1030' class='md-header-anchor '></a>Verify operation</h3><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# openstack network agent list --max-width 50
+----------+------------+----------+-------------------+-------+-------+----------+
| ID       | Agent Type | Host     | Availability Zone | Alive | State | Binary   |
+----------+------------+----------+-------------------+-------+-------+----------+
| 1d661145 | Linux      | controll | None              | True  | UP    | neutron- |
| -0941    | bridge     | er       |                   |       |       | linuxbri |
| -411d-9b | agent      |          |                   |       |       | dge-     |
| 18-b3371 |            |          |                   |       |       | agent    |
| fe57c4b  |            |          |                   |       |       |          |
| 7502e1a3 | DHCP agent | controll | nova              | True  | UP    | neutron- |
| -998d-   |            | er       |                   |       |       | dhcp-    |
| 4aca-91e |            |          |                   |       |       | agent    |
| 4-ca17e1 |            |          |                   |       |       |          |
| b10c82   |            |          |                   |       |       |          |
| 7c47ac70 | Metadata   | controll | None              | True  | UP    | neutron- |
| -5de2-44 | agent      | er       |                   |       |       | metadata |
| 42-8fc1- |            |          |                   |       |       | -agent   |
| 91fe97ae |            |          |                   |       |       |          |
| 120f     |            |          |                   |       |       |          |
+----------+------------+----------+-------------------+-------+-------+----------+
</pre><p></p><h2><a name='header-n1034' class='md-header-anchor '></a>Neutron Install and configure compute node</h2><p>The compute node handles connectivity and <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-security-group'>security groups</a> for instances.</p><h3><a name='header-n1037' class='md-header-anchor '></a>Install the components</h3><pre class='md-fences mock-cm' style='display:block;position:relative'># apt install neutron-linuxbridge-agent -y</pre><h3><a name='header-n1039' class='md-header-anchor '></a>Configure the common component</h3><p>The Networking common component configuration includes the authentication mechanism, message queue, and plug-in.</p><ul><li><p>Edit the <code>/etc/neutron/neutron.conf</code> file and complete the following actions:</p><ul><li><p>In the <code>[database]</code> section, comment out any <code>connection</code> options because compute nodes do not directly access the database.</p></li><li><p>In the <code>[DEFAULT]</code> section, configure <code>RabbitMQ</code> message queue access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
...
transport_url = rabbit://openstack:RABBIT_PASS@controller</pre><p>Replace <code>RABBIT_PASS</code> with the password you chose for the <code>openstack</code> account in RabbitMQ.</p></li><li><p>In the <code>[DEFAULT]</code> and <code>[keystone_authtoken]</code> sections, configure Identity service access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
...
auth_strategy = keystone

[keystone_authtoken]
...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = Default
user_domain_name = Default
project_name = service
username = neutron
password = neutron</pre><p>Replace <code>password = neutron</code> with the password you chose for the <code>neutron</code> user in the Identity service.</p><p>Comment out or remove any other options in the <code>[keystone_authtoken]</code> section.</p></li></ul></li></ul><h3><a name='header-n1064' class='md-header-anchor '></a>Configure networking options</h3><p>Choose the same networking option that you chose for the controller node to configure services specific to it. Afterwards, return here and proceed to <a href='https://docs.openstack.org/newton/install-guide-ubuntu/neutron-compute-install.html#neutron-compute-compute'>Configure the Compute service to use the Networking service</a>.</p><ul><li><a href='https://docs.openstack.org/newton/install-guide-ubuntu/neutron-compute-install-option1.html'>Networking Option 1: Provider networks</a></li></ul><h3><a name='header-n1071' class='md-header-anchor '></a>Configure the Linux bridge agent</h3><p>The Linux bridge agent builds layer-2 (bridging and switching) virtual networking infrastructure for instances and handles security groups.</p><ul><li><p>Edit the <code>/etc/neutron/plugins/ml2/linuxbridge_agent.ini</code> file and complete the following actions:</p><ul><li><p>In the <code>[linux_bridge]</code> section, map the provider virtual network to the provider physical network interface:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[linux_bridge]
physical_interface_mappings = provider:PROVIDER_INTERFACE_NAME
</pre><p>Replace <code>PROVIDER_INTERFACE_NAME</code> with the name of the underlying provider physical network interface. See <a href='https://docs.openstack.org/newton/install-guide-ubuntu/environment-networking.html#environment-networking'>Host networking</a> for more information.</p></li><li><p>In the <code>[vxlan]</code> section, disable VXLAN overlay networks:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[vxlan]
enable_vxlan = False
</pre></li><li><p>In the <code>[securitygroup]</code> section, enable security groups and configure the Linux bridge <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-iptables'>iptables</a> firewall driver:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[securitygroup]
...
enable_security_group = True
firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
</pre></li></ul></li></ul><p>Return to <a href='https://docs.openstack.org/newton/install-guide-ubuntu/neutron-compute-install.html#neutron-compute-compute'>Networking compute node configuration</a>.</p><p></p><h3><a name='header-n1097' class='md-header-anchor '></a>Configure the Compute service to use the Networking service</h3><ul><li><p>Edit the <code>/etc/nova/nova.conf</code> file and complete the following actions:</p><ul><li><p>In the <code>[neutron]</code> section, configure access parameters:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[neutron]
...
url = http://controller:9696
auth_url = http://controller:35357
auth_type = password
project_domain_name = Default
user_domain_name = Default
region_name = RegionOne
project_name = service
username = neutron
password = neutron</pre><p>Replace <code>password = neutron</code> with the password you chose for the <code>neutron</code> user in the Identity service.</p></li></ul></li></ul><h3><a name='header-n1109' class='md-header-anchor '></a>Finalize installation</h3><ol start='' ><li><p>Restart the Compute service:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service nova-compute restart</pre></li><li><p>Restart the Linux bridge agent:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service neutron-linuxbridge-agent restart</pre></li></ol><h3><a name='header-n1119' class='md-header-anchor '></a>Verify operation</h3><p>Perform these commands on the controller node.</p><ol start='' ><li><p>Source the <code>admin</code> credentials to gain access to admin-only CLI commands:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ . admin-openrc</pre></li><li><p>List loaded extensions to verify successful launch of the <code>neutron-server</code> process:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ neutron ext-list

+---------------------------+-----------------------------------------------+
| alias                     | name                                          |
+---------------------------+-----------------------------------------------+
| default-subnetpools       | Default Subnetpools                           |
| network-ip-availability   | Network IP Availability                       |
| network_availability_zone | Network Availability Zone                     |
| auto-allocated-topology   | Auto Allocated Topology Services              |
| ext-gw-mode               | Neutron L3 Configurable external gateway mode |
| binding                   | Port Binding                                  |
| agent                     | agent                                         |
| subnet_allocation         | Subnet Allocation                             |
| l3_agent_scheduler        | L3 Agent Scheduler                            |
| tag                       | Tag support                                   |
| external-net              | Neutron external network                      |
| net-mtu                   | Network MTU                                   |
| availability_zone         | Availability Zone                             |
| quotas                    | Quota management support                      |
| l3-ha                     | HA Router extension                           |
| flavors                   | Neutron Service Flavors                       |
| provider                  | Provider Network                              |
| multi-provider            | Multi Provider Network                        |
| address-scope             | Address scope                                 |
| extraroute                | Neutron Extra Route                           |
| timestamp_core            | Time Stamp Fields addition for core resources |
| router                    | Neutron L3 Router                             |
| extra_dhcp_opt            | Neutron Extra DHCP opts                       |
| dns-integration           | DNS Integration                               |
| security-group            | security-group                                |
| dhcp_agent_scheduler      | DHCP Agent Scheduler                          |
| router_availability_zone  | Router Availability Zone                      |
| rbac-policies             | RBAC Policies                                 |
| standard-attr-description | standard-attr-description                     |
| port-security             | Port Security                                 |
| allowed-address-pairs     | Allowed Address Pairs                         |
| dvr                       | Distributed Virtual Router                    |
+---------------------------+-----------------------------------------------+</pre></li><li><p>List agents to verify successful launch of the neutron agents:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack network agent list

root@controller:~# openstack network agent list --max-width 70
+----------+------------+----------+-------------------+-------+-------+------------+
| ID       | Agent Type | Host     | Availability Zone | Alive | State | Binary     |
+----------+------------+----------+-------------------+-------+-------+------------+
| 143d7731 | Linux      | compute  | None              | True  | UP    | neutron-li |
| -9227-4b | bridge     |          |                   |       |       | nuxbridge- |
| af-9052- | agent      |          |                   |       |       | agent      |
| 292d7aea |            |          |                   |       |       |            |
| 6992     |            |          |                   |       |       |            |
| 1d661145 | Linux      | controll | None              | True  | UP    | neutron-li |
| -0941    | bridge     | er       |                   |       |       | nuxbridge- |
| -411d-9b | agent      |          |                   |       |       | agent      |
| 18-b3371 |            |          |                   |       |       |            |
| fe57c4b  |            |          |                   |       |       |            |
| 7502e1a3 | DHCP agent | controll | nova              | True  | UP    | neutron-   |
| -998d-   |            | er       |                   |       |       | dhcp-agent |
| 4aca-91e |            |          |                   |       |       |            |
| 4-ca17e1 |            |          |                   |       |       |            |
| b10c82   |            |          |                   |       |       |            |
| 7c47ac70 | Metadata   | controll | None              | True  | UP    | neutron-   |
| -5de2-44 | agent      | er       |                   |       |       | metadata-  |
| 42-8fc1- |            |          |                   |       |       | agent      |
| 91fe97ae |            |          |                   |       |       |            |
| 120f     |            |          |                   |       |       |            |
+----------+------------+----------+-------------------+-------+-------+------------+</pre><p>​The output should indicate three agents on the controller node and one agent on each compute node.</p></li></ol><h2><a name='header-n1137' class='md-header-anchor '></a>Congratulations! Let&#39;s try booting an instance</h2><p></p><h3><a name='header-n1140' class='md-header-anchor '></a>Create provider network/subnetwork</h3><blockquote><p>ref: <a href='https://docs.openstack.org/newton/install-guide-ubuntu/launch-instance-networks-provider.html' target='_blank' >https://docs.openstack.org/newton/install-guide-ubuntu/launch-instance-networks-provider.html</a></p></blockquote><p></p><blockquote><p>The --provider:physical_network provider and --provider:network_type flat options connect the flat virtual network to the flat (native/untagged) physical network on the eth1 interface on the host</p></blockquote><p>标注: 下边的创建网络里 ，参数:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>--provider-network-type flat \
--provider-physical-network provider</pre><p>对应的是:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>
/etc/neutron/plugins/ml2/ml2_conf.ini
[ml2_type_flat]
flat_networks = provider


/etc/neutron/plugins/ml2/linuxbridge_agent.ini
[linux_bridge]
physical_interface_mappings = provider:enp0s8</pre><p></p><pre class="md-fences md-end-block" lang="bash"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 1702px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">root@controller:~<span class="cm-comment"># . admin-openrc</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">root@controller:~<span class="cm-comment"># openstack network create  --share --external \</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; &nbsp; <span class="cm-attribute">--provider-physical-network</span> provider \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; &nbsp; <span class="cm-attribute">--provider-network-type</span> flat provider</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">+</span><span class="cm-attribute">---------------------------</span><span class="cm-operator">+</span><span class="cm-attribute">--------------------------------------</span><span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Field &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Value &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">+</span><span class="cm-attribute">---------------------------</span><span class="cm-operator">+</span><span class="cm-attribute">--------------------------------------</span><span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| admin_state_up &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | UP &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| availability_zone_hints &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| availability_zones &nbsp; &nbsp; &nbsp;  | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| created_at &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | <span class="cm-number">2017</span><span class="cm-attribute">-08-23T17</span>:14:21Z &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| description &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| dns_domain &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | None &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | 2a33434f-ba29-4645-9b5d-24f1509066f1 |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| ipv4_address_scope &nbsp; &nbsp; &nbsp;  | None &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| ipv6_address_scope &nbsp; &nbsp; &nbsp;  | None &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| is_default &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | None &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| mtu &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | <span class="cm-number">1500</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | provider &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| port_security_enabled &nbsp; &nbsp; | True &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| project_id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | 78c9c849237649a3a8c4526167427589 &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| provider:network_type &nbsp; &nbsp; | flat &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| provider:physical_network | provider &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| provider:segmentation_id  | None &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| qos_policy_id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | None &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| revision_number &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | <span class="cm-number">4</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| router:external &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | External &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| segments &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | None &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| shared &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | True &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| status &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | ACTIVE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| subnets &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| updated_at &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | <span class="cm-number">2017</span><span class="cm-attribute">-08-23T17</span>:14:21Z &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">+</span><span class="cm-attribute">---------------------------</span><span class="cm-operator">+</span><span class="cm-attribute">--------------------------------------</span><span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">root@controller:~<span class="cm-comment"># neutron net-list</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">neutron CLI is deprecated and will be removed <span class="cm-keyword">in</span> the future. Use openstack CLI instead.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">+</span><span class="cm-attribute">--------------------------------------</span><span class="cm-operator">+</span><span class="cm-attribute">----------</span><span class="cm-operator">+</span><span class="cm-attribute">----------------------------------</span><span class="cm-operator">+</span><span class="cm-attribute">---------</span><span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | name &nbsp; &nbsp; | tenant_id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | subnets |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">+</span><span class="cm-attribute">--------------------------------------</span><span class="cm-operator">+</span><span class="cm-attribute">----------</span><span class="cm-operator">+</span><span class="cm-attribute">----------------------------------</span><span class="cm-operator">+</span><span class="cm-attribute">---------</span><span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| 2a33434f-ba29-4645-9b5d-24f1509066f1 | provider | 78c9c849237649a3a8c4526167427589 | &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">+</span><span class="cm-attribute">--------------------------------------</span><span class="cm-operator">+</span><span class="cm-attribute">----------</span><span class="cm-operator">+</span><span class="cm-attribute">----------------------------------</span><span class="cm-operator">+</span><span class="cm-attribute">---------</span><span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">root@controller:~<span class="cm-comment"># openstack network list</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">+</span><span class="cm-attribute">--------------------------------------</span><span class="cm-operator">+</span><span class="cm-attribute">----------</span><span class="cm-operator">+</span><span class="cm-attribute">---------</span><span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Name &nbsp; &nbsp; | Subnets |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">+</span><span class="cm-attribute">--------------------------------------</span><span class="cm-operator">+</span><span class="cm-attribute">----------</span><span class="cm-operator">+</span><span class="cm-attribute">---------</span><span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| 2a33434f-ba29-4645-9b5d-24f1509066f1 | provider | &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">+</span><span class="cm-attribute">--------------------------------------</span><span class="cm-operator">+</span><span class="cm-attribute">----------</span><span class="cm-operator">+</span><span class="cm-attribute">---------</span><span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">root@controller:~<span class="cm-comment"># openstack subnet create --network provider \</span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; &nbsp; <span class="cm-attribute">--allocation-pool</span> <span class="cm-def">start</span><span class="cm-operator">=</span><span class="cm-number">172</span>.16.0.100<span class="cm-def">,end</span><span class="cm-operator">=</span><span class="cm-number">172</span>.16.0.200 \</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; &nbsp; <span class="cm-attribute">--gateway</span> <span class="cm-number">172</span>.16.0.1 \</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; &nbsp; <span class="cm-attribute">--subnet-range</span> <span class="cm-number">172</span>.16.0.1/24 provider</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">+</span><span class="cm-attribute">-------------------</span><span class="cm-operator">+</span><span class="cm-attribute">--------------------------------------</span><span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Field &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Value &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">+</span><span class="cm-attribute">-------------------</span><span class="cm-operator">+</span><span class="cm-attribute">--------------------------------------</span><span class="cm-operator">+</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| allocation_pools  | <span class="cm-number">172</span>.16.0.100-172.16.0.200 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| cidr &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | <span class="cm-number">172</span>.16.0.1/24 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| created_at &nbsp; &nbsp; &nbsp;  | <span class="cm-number">2017</span><span class="cm-attribute">-08-23T17</span>:17:54Z &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| description &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| enable_dhcp &nbsp; &nbsp; &nbsp; | True &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| gateway_ip &nbsp; &nbsp; &nbsp;  | <span class="cm-number">172</span>.16.0.1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| host_routes &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | 9b118521-59b5-40ee-a439-9d59c3b392ea |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| ip_version &nbsp; &nbsp; &nbsp;  | <span class="cm-number">4</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| ipv6_address_mode | None &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| ipv6_ra_mode &nbsp; &nbsp;  | None &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | provider &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| network_id &nbsp; &nbsp; &nbsp;  | 2a33434f-ba29-4645-9b5d-24f1509066f1 |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| project_id &nbsp; &nbsp; &nbsp;  | 78c9c849237649a3a8c4526167427589 &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| revision_number &nbsp; | <span class="cm-number">2</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| segment_id &nbsp; &nbsp; &nbsp;  | None &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| service_types &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| subnetpool_id &nbsp; &nbsp; | None &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| updated_at &nbsp; &nbsp; &nbsp;  | <span class="cm-number">2017</span><span class="cm-attribute">-08-23T17</span>:17:54Z &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">+</span><span class="cm-attribute">-------------------</span><span class="cm-operator">+</span><span class="cm-attribute">--------------------------------------</span><span class="cm-operator">+</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 1702px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1732px;"></div></div></div></pre><p></p><h3><a name='header-n1160' class='md-header-anchor '></a>Create flavor</h3><p>The smallest default flavor consumes 512 MB memory per instance. For environments with compute nodes containing less than 4 GB memory, we recommend creating the <code>m1.nano</code> flavor that only requires 64 MB per instance. Only use this flavor with the CirrOS image for testing purposes.</p><pre class="md-fences md-end-block" lang="bash"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 368px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ openstack</span> flavor create <span class="cm-attribute">--id</span> <span class="cm-number">0</span> <span class="cm-attribute">--vcpus</span> <span class="cm-number">1</span> <span class="cm-attribute">--ram</span> <span class="cm-number">64</span> <span class="cm-attribute">--disk</span> <span class="cm-number">1</span> m1.nano</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">+</span><span class="cm-attribute">----------------------------</span><span class="cm-operator">+</span><span class="cm-attribute">---------</span><span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Field &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | Value &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">+</span><span class="cm-attribute">----------------------------</span><span class="cm-operator">+</span><span class="cm-attribute">---------</span><span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| OS-FLV-DISABLED:disabled &nbsp; | False &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| OS-FLV-EXT-DATA:ephemeral  | <span class="cm-number">0</span> &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| disk &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | <span class="cm-number">1</span> &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | <span class="cm-number">0</span> &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | m1.nano |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| os-flavor-access:is_public | True &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| ram &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | <span class="cm-number">64</span> &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| rxtx_factor &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | <span class="cm-number">1</span>.0 &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| swap &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| vcpus &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | <span class="cm-number">1</span> &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">+</span><span class="cm-attribute">----------------------------</span><span class="cm-operator">+</span><span class="cm-attribute">---------</span><span class="cm-operator">+</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 368px;"></div><div class="CodeMirror-gutters" style="display: none; height: 398px;"></div></div></div></pre><h3><a name='header-n1164' class='md-header-anchor '></a>Add security group rules</h3><p>By default, the <code>default</code> security group applies to all instances and includes firewall rules that deny remote access to instances. For Linux images such as CirrOS, we recommend allowing at least ICMP (ping) and secure shell (SSH).</p><ul><li><p>Add rules to the <code>default</code> security group:</p><ul><li><p>Permit <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-internet-control-message-protocol-icmp'>ICMP</a> (ping):</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack security group rule create --proto icmp default

+-------------------+--------------------------------------+
| Field             | Value                                |
+-------------------+--------------------------------------+
| created_at        | 2016-10-05T09:52:31Z                 |
| description       |                                      |
| direction         | ingress                              |
| ethertype         | IPv4                                 |
| headers           |                                      |
| id                | 6ee8d630-9803-4d3d-9aea-8c795abbedc2 |
| port_range_max    | None                                 |
| port_range_min    | None                                 |
| project_id        | 77ae8d7104024123af342ffb0a6f1d88     |
| project_id        | 77ae8d7104024123af342ffb0a6f1d88     |
| protocol          | icmp                                 |
| remote_group_id   | None                                 |
| remote_ip_prefix  | 0.0.0.0/0                            |
| revision_number   | 1                                    |
| security_group_id | 4ceee3d4-d2fe-46c1-895c-382033e87b0d |
| updated_at        | 2016-10-05T09:52:31Z                 |
+-------------------+--------------------------------------+</pre></li><li><p>Permit secure shell (SSH) access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack security group rule create --proto tcp --dst-port 22 default

+-------------------+--------------------------------------+
| Field             | Value                                |
+-------------------+--------------------------------------+
| created_at        | 2016-10-05T09:54:50Z                 |
| description       |                                      |
| direction         | ingress                              |
| ethertype         | IPv4                                 |
| headers           |                                      |
| id                | 3cd0a406-43df-4741-ab29-b5e7dcb7469d |
| port_range_max    | 22                                   |
| port_range_min    | 22                                   |
| project_id        | 77ae8d7104024123af342ffb0a6f1d88     |
| project_id        | 77ae8d7104024123af342ffb0a6f1d88     |
| protocol          | tcp                                  |
| remote_group_id   | None                                 |
| remote_ip_prefix  | 0.0.0.0/0                            |
| revision_number   | 1                                    |
| security_group_id | 4ceee3d4-d2fe-46c1-895c-382033e87b0d |
| updated_at        | 2016-10-05T09:54:50Z                 |
+-------------------+--------------------------------------+</pre></li></ul></li></ul><h3><a name='header-n1180' class='md-header-anchor '></a>Launch an instance</h3><p>ref: <a href='https://docs.openstack.org/newton/install-guide-ubuntu/launch-instance-provider.html'>Launch an instance on the provider network</a></p><h3><a name='header-n1183' class='md-header-anchor '></a>Determine instance options</h3><p>To launch an instance, you must at least specify the flavor, image name, network, security group, key, and instance name.</p><ol start='' ><li><p>On the controller node, source the <code>demo</code> credentials to gain access to user-only CLI commands:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ . demo-openrc</pre></li><li><p>A flavor specifies a virtual resource allocation profile which includes processor, memory, and storage.</p><p>List available flavors:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack flavor list

+----+---------+-----+------+-----------+-------+-----------+
| ID | Name    | RAM | Disk | Ephemeral | VCPUs | Is Public |
+----+---------+-----+------+-----------+-------+-----------+
| 0  | m1.nano |  64 |    1 |         0 |     1 | True      |
+----+---------+-----+------+-----------+-------+-----------+</pre><p>You can also reference a flavor by ID.</p></li><li><p>List available images:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack image list

+--------------------------------------+--------+--------+
| ID                                   | Name   | Status |
+--------------------------------------+--------+--------+
| 390eb5f7-8d49-41ec-95b7-68c0d5d54b34 | cirros | active |
+--------------------------------------+--------+--------+</pre><p>This instance uses the <code>cirros</code> image.</p></li><li><p>List available networks:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack network list

+--------------------------------------+--------------+--------------------------------------+
| ID                                   | Name         | Subnets                              |
+--------------------------------------+--------------+--------------------------------------+
| 4716ddfe-6e60-40e7-b2a8-42e57bf3c31c | selfservice  | 2112d5eb-f9d6-45fd-906e-7cabd38b7c7c |
| b5b6993c-ddf9-40e7-91d0-86806a42edb8 | provider     | 310911f6-acf0-4a47-824e-3032916582ff |
+--------------------------------------+--------------+--------------------------------------+</pre><p>This instance uses the <code>provider</code> provider network. However, you must reference this network using the ID instead of the name.</p><p>​</p></li><li><p>List available security groups:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack security group list

+--------------------------------------+---------+------------------------+----------------------------------+
| ID                                   | Name    | Description            | Project                          |
+--------------------------------------+---------+------------------------+----------------------------------+
| dd2b614c-3dad-48ed-958b-b155a3b38515 | default | Default security group | a516b957032844328896baa01e0f906c |
+--------------------------------------+---------+------------------------+----------------------------------+</pre><p>This instance uses the <code>default</code> security group.</p></li></ol><h3><a name='header-n1219' class='md-header-anchor '></a>Launch the instance</h3><ol start='' ><li><p>Launch the instance:</p><p>Replace <code>PROVIDER_NET_ID</code> with the ID of the <code>provider</code> provider network.</p><p>If you chose option 1 and your environment contains only one network, you can omit the <code>--nic</code> option because OpenStack automatically chooses the only network available.</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# openstack server create --flavor m1.nano --image cirros \
&gt;   --nic net-id=2a33434f-ba29-4645-9b5d-24f1509066f1 --security-group default provider-instance
+-----------------------------+-----------------------------------------------+
| Field                       | Value                                         |
+-----------------------------+-----------------------------------------------+
| OS-DCF:diskConfig           | MANUAL                                        |
| OS-EXT-AZ:availability_zone |                                               |
| OS-EXT-STS:power_state      | NOSTATE                                       |
| OS-EXT-STS:task_state       | scheduling                                    |
| OS-EXT-STS:vm_state         | building                                      |
| OS-SRV-USG:launched_at      | None                                          |
| OS-SRV-USG:terminated_at    | None                                          |
| accessIPv4                  |                                               |
| accessIPv6                  |                                               |
| addresses                   |                                               |
| adminPass                   | MnjXdXf3qHia                                  |
| config_drive                |                                               |
| created                     | 2017-08-23T17:29:04Z                          |
| flavor                      | m1.nano (0)                                   |
| hostId                      |                                               |
| id                          | 02f54ef9-e867-4c1a-88f9-8eddd144da6f          |
| image                       | cirros (c17e391e-93e1-4480-9cf3-bf8623063e61) |
| key_name                    | None                                          |
| name                        | provider-instance                             |
| progress                    | 0                                             |
| project_id                  | cb015df53fb34d90b077e4c36ce35826              |
| properties                  |                                               |
| security_groups             | name=&#39;default&#39;                                |
| status                      | BUILD                                         |
| updated                     | 2017-08-23T17:29:05Z                          |
| user_id                     | cb98fad69e84459bb48f42130d5c0ce5              |
| volumes_attached            |                                               |
+-----------------------------+-----------------------------------------------+</pre></li><li><p>Check the status of your instance:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# nova list
+--------------------------------------+-------------------+--------+------------+-------------+----------+
| ID                                   | Name              | Status | Task State | Power State | Networks |
+--------------------------------------+-------------------+--------+------------+-------------+----------+
| 02f54ef9-e867-4c1a-88f9-8eddd144da6f | provider-instance | BUILD  | scheduling | NOSTATE     |          |
+--------------------------------------+-------------------+--------+------------+-------------+----------+

root@controller:~# openstack server list
+--------------------------------------+-------------------+--------+----------+------------+
| ID                                   | Name              | Status | Networks | Image Name |
+--------------------------------------+-------------------+--------+----------+------------+
| 02f54ef9-e867-4c1a-88f9-8eddd144da6f | provider-instance | BUILD  |          | cirros     |
+--------------------------------------+-------------------+--------+----------+------------+
</pre><p>The status changes from <code>BUILD</code> to <code>ACTIVE</code> when the build process successfully completes.</p></li></ol><h3><a name='header-n1235' class='md-header-anchor '></a>Access the instance using the virtual console</h3><ol start='' ><li><p>Obtain a <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/glossary.html#term-virtual-network-computing-vnc'>Virtual Network Computing (VNC)</a> session URL for your instance and access it from a web browser:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack console url show provider-instance

+-------+---------------------------------------------------------------------------------+
| Field | Value                                                                           |
+-------+---------------------------------------------------------------------------------+
| type  | novnc                                                                           |
| url   | http://controller:6080/vnc_auto.html?token=5eeccb47-525c-4918-ac2a-3ad1e9f1f493 |
+-------+---------------------------------------------------------------------------------+</pre><p>If your web browser runs on a host that cannot resolve the <code>controller</code> host name, you can replace <code>controller</code> with the IP address of the management interface on your controller node.</p><p>The CirrOS image includes conventional user name/password authentication and provides these credentials at the login prompt. After logging into CirrOS, we recommend that you verify network connectivity using <code>ping</code>.</p></li><li><p>Verify access to the provider physical network gateway:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ ping -c 4 172.16.0.1

PING 203.0.113.1 (172.16.0.1) 56(84) bytes of data.
64 bytes from 172.16.0.1: icmp_req=1 ttl=64 time=0.357 ms
64 bytes from 172.16.0.1: icmp_req=2 ttl=64 time=0.473 ms
64 bytes from 172.16.0.1: icmp_req=3 ttl=64 time=0.504 ms
64 bytes from 172.16.0.1: icmp_req=4 ttl=64 time=0.470 ms

--- 172.16.0.1 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 2998ms
rtt min/avg/max/mdev = 0.357/0.451/0.504/0.055 ms</pre></li><li><p>Verify access to the internet:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ ping -c 4 openstack.org

PING openstack.org (174.143.194.225) 56(84) bytes of data.
64 bytes from 174.143.194.225: icmp_req=1 ttl=53 time=17.4 ms
64 bytes from 174.143.194.225: icmp_req=2 ttl=53 time=17.5 ms
64 bytes from 174.143.194.225: icmp_req=3 ttl=53 time=17.7 ms
64 bytes from 174.143.194.225: icmp_req=4 ttl=53 time=17.5 ms

--- openstack.org ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3003ms
rtt min/avg/max/mdev = 17.431/17.575/17.734/0.143 ms</pre></li></ol><h3><a name='header-n1253' class='md-header-anchor '></a>Access the instance remotely</h3><ol start='' ><li><p>Verify connectivity to the instance from the controller node or any host on the provider physical network:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ ping -c 4 172.16.0.103

PING 203.0.113.103 (203.0.113.103) 56(84) bytes of data.
64 bytes from 203.0.113.103: icmp_req=1 ttl=63 time=3.18 ms
64 bytes from 203.0.113.103: icmp_req=2 ttl=63 time=0.981 ms
64 bytes from 203.0.113.103: icmp_req=3 ttl=63 time=1.06 ms
64 bytes from 203.0.113.103: icmp_req=4 ttl=63 time=0.929 ms

--- 203.0.113.103 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3002ms
rtt min/avg/max/mdev = 0.929/1.539/3.183/0.951 ms</pre></li><li><p>Access your instance using SSH from the controller node or any host on the provider physical network:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ ssh cirros@203.0.113.103

The authenticity of host &#39;203.0.113.102 (203.0.113.102)&#39; can&#39;t be established.
RSA key fingerprint is ed:05:e9:e7:52:a0:ff:83:68:94:c7:d1:f2:f8:e2:e9.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &#39;203.0.113.102&#39; (RSA) to the list of known hosts.
</pre></li></ol><p>If your instance does not launch or seem to work as you expect, see the <a href='http://docs.openstack.org/ops-guide/ops-maintenance-compute.html#instances'>Instance Boot Failures</a> section in OpenStack Operations Guide for more information or use one of the <a href='https://docs.openstack.org/newton/install-guide-ubuntu/common/app-support.html'><em>many other options</em></a> to seek assistance. We want your first installation to work!</p><p>Return to <a href='https://docs.openstack.org/newton/install-guide-ubuntu/launch-instance.html#launch-instance-complete'>Launch an instance</a>.</p><h2><a name='header-n1267' class='md-header-anchor '></a>[ISSUE] DHCP failure in VM troubleshooting</h2><blockquote><p>ref: <a href='https://docs.openstack.org/neutron/pike/admin/intro-basic-networking.html' target='_blank' >https://docs.openstack.org/neutron/pike/admin/intro-basic-networking.html</a></p></blockquote><h3><a name='header-n1271' class='md-header-anchor '></a>what it is like</h3><p>in VM console ( initial dhcp discover)</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ ifup eth0
udhcpc (v1.20.1) started
Sending discover...
Sending discover...
Sending discover...
Usage: /sbin/cirros-dhcpc &lt;up|down&gt;
No lease, failing</pre><p>in controller console (monitor log)</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# tail -f /var/log/syslog
Aug 24 03:06:30 controller dhclient[1166]: DHCPREQUEST of 146.11.41.129 on enp0s10 to 147.128.5.12 port 67 (xid=0x5d38ef7e)
Aug 24 03:06:30 controller dhclient[1166]: DHCPACK of 146.11.41.129 from 147.128.5.12
Aug 24 03:06:30 controller dhclient[1166]: Invalid domain list.
Aug 24 03:06:30 controller dhclient[1166]: suspect value in domain_search option - discarded
Aug 24 03:06:30 controller dhclient[1166]: Invalid domain list.
Aug 24 03:06:30 controller dhclient[1166]: suspect value in domain_search option - discarded
Aug 24 03:06:30 controller dhclient[1166]: Invalid domain list.
Aug 24 03:06:30 controller dhclient[1166]: bound to 146.11.41.129 -- renewal in 12824 seconds.
Aug 24 03:12:18 controller dnsmasq-dhcp[18894]: DHCPDISCOVER(ns-a6e0220e-ec) fa:16:3e:bb:c6:13
Aug 24 03:12:18 controller dnsmasq-dhcp[18894]: DHCPOFFER(ns-a6e0220e-ec) 146.11.41.232 fa:16:3e:bb:c6:13
Aug 24 03:13:19 controller dnsmasq-dhcp[18894]: DHCPDISCOVER(ns-a6e0220e-ec) fa:16:3e:bb:c6:13
Aug 24 03:13:19 controller dnsmasq-dhcp[18894]: DHCPOFFER(ns-a6e0220e-ec) 146.11.41.232 fa:16:3e:bb:c6:13
Aug 24 03:14:19 controller dnsmasq-dhcp[18894]: DHCPDISCOVER(ns-a6e0220e-ec) fa:16:3e:bb:c6:13
Aug 24 03:14:19 controller dnsmasq-dhcp[18894]: DHCPOFFER(ns-a6e0220e-ec) 146.11.41.232 fa:16:3e:bb:c6:13</pre><p>By tcpdump from controllor bridge, it&#39;s found the DHCPOFFER was sent to VM:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# tcpdump -i  brq2a33434f-ba -vv port 67 or port 68 -e -n
tcpdump: listening on brq2a33434f-ba, link-type EN10MB (Ethernet), capture size 262144 bytes
04:04:22.830138 fa:16:3e:bb:c6:13 &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 332: (tos 0x0, ttl 64, id 0, offset 0, flags [none], proto UDP (17), length 318)
    0.0.0.0.68 &gt; 255.255.255.255.67: [udp sum ok] BOOTP/DHCP, Request from fa:16:3e:bb:c6:13, length 290, xid 0x1fac2751, Flags [none] (0x0000)
          Client-Ethernet-Address fa:16:3e:bb:c6:13
          Vendor-rfc1048 Extensions
            Magic Cookie 0x63825363
            DHCP-Message Option 53, length 1: Discover
            Client-ID Option 61, length 7: ether fa:16:3e:bb:c6:13
            MSZ Option 57, length 2: 576
            Parameter-Request Option 55, length 9:
              Subnet-Mask, Default-Gateway, Domain-Name-Server, Hostname
              Domain-Name, MTU, BR, NTP
              Classless-Static-Route
            Vendor-Class Option 60, length 12: &quot;udhcp 1.20.1&quot;
            Hostname Option 12, length 6: &quot;cirros&quot;
04:04:22.831801 fa:16:3e:8b:53:5e &gt; fa:16:3e:bb:c6:13, ethertype IPv4 (0x0800), length 370: (tos 0xc0, ttl 64, id 3044, offset 0, flags [none], proto UDP (17), length 356)
    146.11.41.230.67 &gt; 146.11.41.232.68: [udp sum ok] BOOTP/DHCP, Reply, length 328, xid 0x1fac2751, Flags [none] (0x0000)
          Your-IP 146.11.41.232
          Server-IP 146.11.41.230
          Client-Ethernet-Address fa:16:3e:bb:c6:13
          Vendor-rfc1048 Extensions
            Magic Cookie 0x63825363
            DHCP-Message Option 53, length 1: Offer
            Server-ID Option 54, length 4: 146.11.41.230
            Lease-Time Option 51, length 4: 86400
            RN Option 58, length 4: 43200
            RB Option 59, length 4: 75600
            Subnet-Mask Option 1, length 4: 255.255.254.0
            BR Option 28, length 4: 146.11.41.255
            Domain-Name Option 15, length 14: &quot;openstacklocal&quot;
            Default-Gateway Option 3, length 4: 146.11.40.1
            Classless-Static-Route Option 121, length 14: (169.254.169.254/32:146.11.41.230),(default:146.11.40.1)
            Domain-Name-Server Option 6, length 4: 147.128.5.12
            MTU Option 26, length 2: 1500
04:04:52.504181 08:2e:5f:5d:63:00 &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 358: (tos 0x0, ttl 120, id 5320, offset 0, flags [DF], proto UDP (17), length 344)</pre><p>While from compute , tcpdump the br-int bridge shows it&#39;s not received </p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@compute:~# tcpdump -i brq2a33434f-ba -vv port 67 or port 68 -e -n
tcpdump: listening on brq2a33434f-ba, link-type EN10MB (Ethernet), capture size 262144 bytes
03:51:04.456668 fa:16:3e:bb:c6:13 &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 332: (tos 0x0, ttl 64, id 0, offset 0, flags [none], proto UDP (17), length 318)
    0.0.0.0.68 &gt; 255.255.255.255.67: [udp sum ok] BOOTP/DHCP, Request from fa:16:3e:bb:c6:13, length 290, xid 0xe5e8f024, Flags [none] (0x0000)
          Client-Ethernet-Address fa:16:3e:bb:c6:13
          Vendor-rfc1048 Extensions
            Magic Cookie 0x63825363
            DHCP-Message Option 53, length 1: Discover
            Client-ID Option 61, length 7: ether fa:16:3e:bb:c6:13
            MSZ Option 57, length 2: 576
            Parameter-Request Option 55, length 9:
              Subnet-Mask, Default-Gateway, Domain-Name-Server, Hostname
              Domain-Name, MTU, BR, NTP
              Classless-Static-Route
            Vendor-Class Option 60, length 12: &quot;udhcp 1.20.1&quot;
            Hostname Option 12, length 6: &quot;cirros&quot;
03:51:30.022360 08:2e:5f:5d:63:00 &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 358: (tos 0x0, ttl 120, id 29901, offset 0, flags [DF], proto UDP (17), length 344)
    147.128.5.12.67 &gt; 255.255.255.255.68: [udp sum ok] BOOTP/DHCP, Reply, length 316, xid 0x4a42e788, Flags [Broadcast] (0x8000)
          Client-IP 146.11.40.250
          Gateway-IP 146.11.40.1
          Client-Ethernet-Address d0:bf:9c:df:7a:a5
          Vendor-rfc1048 Extensions
            Magic Cookie 0x63825363
            DHCP-Message Option 53, length 1: ACK
            Server-ID Option 54, length 4: 147.128.5.12
            Subnet-Mask Option 1, length 4: 255.255.254.0
            Vendor-Option Option 43, length 5: 220.3.78.65.80
            Domain-Name Option 15, length 18: &quot;cn.ao.ericsson.se^@&quot;
            Default-Gateway Option 3, length 4: 146.11.40.1
            Domain-Name-Server Option 6, length 12: 147.128.5.12,193.181.14.11,193.181.14.10
            Netbios-Name-Server Option 44, length 8: 146.11.115.50,146.11.116.30
            Netbios-Node Option 46, length 1: h-node
03:51:30.023490 2c:76:8a:1f:47:00 &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 358: (tos 0x0, ttl 119, id 2187, offset 0, flags [DF], proto UDP (17), length 344)
</pre><h3><a name='header-n1284' class='md-header-anchor '></a>Conclusion:</h3><p>the DHCP offer was sent out from DHCP agent dnsmasq, but the package cannot be captured from host bridge connecting to vm eth0. the issue is located in the provider network router, the ECN router 146.11.40.1 in our office.</p><p>By searching online, there is a tech called DHCP snooping to prevent multiple dhcp server in one LAN from router, which makes sense. </p><p></p><h2><a name='header-n1291' class='md-header-anchor '></a>Cinder</h2><h2><a name='header-n1292' class='md-header-anchor '></a>Cinder on controller</h2><p>Here we provide a iSCSI driver backend cinder practice </p><blockquote><p>ref: <a href='https://docs.openstack.org/ocata/install-guide-ubuntu/cinder.html' target='_blank' >https://docs.openstack.org/ocata/install-guide-ubuntu/cinder.html</a></p></blockquote><p>The OpenStack Block Storage service (cinder) adds persistent storage to a virtual machine. Block Storage provides an infrastructure for managing volumes, and interacts with OpenStack Compute to provide volumes for instances. The service also enables management of volume snapshots, and volume types.</p><p>The Block Storage service consists of the following components:</p><ul><li><p>cinder-api</p><p>Accepts API requests, and routes them to the <code>cinder-volume</code> for action.</p></li><li><p>cinder-volume</p><p>Interacts directly with the Block Storage service, and processes such as the <code>cinder-scheduler</code>. It also interacts with these processes through a message queue. The <code>cinder-volume</code> service responds to read and write requests sent to the Block Storage service to maintain state. It can interact with a variety of storage providers through a driver architecture.</p></li><li><p>cinder-scheduler daemon</p><p>Selects the optimal storage provider node on which to create the volume. A similar component to the <code>nova-scheduler</code>.</p></li><li><p>cinder-backup daemon</p><p>The <code>cinder-backup</code> service provides backing up volumes of any type to a backup storage provider. Like the <code>cinder-volume</code> service, it can interact with a variety of storage providers through a driver architecture.</p></li><li><p>Messaging queue</p><p>Routes information between the Block Storage processes.</p></li></ul><h3><a name='header-n1328' class='md-header-anchor '></a>Install and configure controller node</h3><p>This section describes how to install and configure the Block Storage service, code-named cinder, on the controller node. This service requires at least one additional storage node that provides volumes to instances.</p><h3><a name='header-n1331' class='md-header-anchor '></a>Prerequisites</h3><p>Before you install and configure the Block Storage service, you must create a database, service credentials, and API endpoints.</p><ol start='' ><li><p>To create the database, complete these steps:</p><ul><li><p>Use the database access client to connect to the database server as the <code>root</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># mysql</pre></li></ul></li></ol><ul><li><p>Create the <code>cinder</code> database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>MariaDB [(none)]&gt; CREATE DATABASE cinder;</pre></li><li><p>Grant proper access to the <code>cinder</code> database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'> ​```
 MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON cinder.* TO &#39;cinder&#39;@&#39;localhost&#39; \
   IDENTIFIED BY &#39;CINDER_DBPASS&#39;;
 MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON cinder.* TO &#39;cinder&#39;@&#39;%&#39; \
   IDENTIFIED BY &#39;CINDER_DBPASS&#39;;
 ​```
 
 Replace `CINDER_DBPASS` with a suitable password.</pre><ul><li>Exit the database access client.</li></ul></li></ul><ol start='' ><li><p>Source the <code>admin</code> credentials to gain access to admin-only CLI commands:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ . admin-openrc
</pre></li><li><p>To create the service credentials, complete these steps:</p><ul><li><p>Create a <code>cinder</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack user create --domain default --password-prompt cinder

User Password:
Repeat User Password:
+---------------------+----------------------------------+
| Field               | Value                            |
+---------------------+----------------------------------+
| domain_id           | default                          |
| enabled             | True                             |
| id                  | 9d7e33de3e1a498390353819bc7d245d |
| name                | cinder                           |
| options             | {}                               |
| password_expires_at | None                             |
+---------------------+----------------------------------+</pre></li><li><p>Add the <code>admin</code> role to the <code>cinder</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack role add --project service --user cinder admin</pre><p>This command provides no output.</p></li><li><p>Create the <code>cinderv2</code> and <code>cinderv3</code> service entities:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack service create --name cinderv2 \
  --description &quot;OpenStack Block Storage&quot; volumev2

+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | OpenStack Block Storage          |
| enabled     | True                             |
| id          | eb9fd245bdbc414695952e93f29fe3ac |
| name        | cinderv2                         |
| type        | volumev2                         |
+-------------+----------------------------------+</pre><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack service create --name cinderv3 \
  --description &quot;OpenStack Block Storage&quot; volumev3

+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | OpenStack Block Storage          |
| enabled     | True                             |
| id          | ab3bbbef780845a1a283490d281e7fda |
| name        | cinderv3                         |
| type        | volumev3                         |
+-------------+----------------------------------+</pre></li></ul><p>The Block Storage services require two service entities.</p></li><li><p>Create the Block Storage service API endpoints:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack endpoint create --region RegionOne \
  volumev2 public http://controller:8776/v2/%\(project_id\)s

+--------------+------------------------------------------+
| Field        | Value                                    |
+--------------+------------------------------------------+
| enabled      | True                                     |
| id           | 513e73819e14460fb904163f41ef3759         |
| interface    | public                                   |
| region       | RegionOne                                |
| region_id    | RegionOne                                |
| service_id   | eb9fd245bdbc414695952e93f29fe3ac         |
| service_name | cinderv2                                 |
| service_type | volumev2                                 |
| url          | http://controller:8776/v2/%(project_id)s |
+--------------+------------------------------------------+

$ openstack endpoint create --region RegionOne \
  volumev2 internal http://controller:8776/v2/%\(project_id\)s

+--------------+------------------------------------------+
| Field        | Value                                    |
+--------------+------------------------------------------+
| enabled      | True                                     |
| id           | 6436a8a23d014cfdb69c586eff146a32         |
| interface    | internal                                 |
| region       | RegionOne                                |
| region_id    | RegionOne                                |
| service_id   | eb9fd245bdbc414695952e93f29fe3ac         |
| service_name | cinderv2                                 |
| service_type | volumev2                                 |
| url          | http://controller:8776/v2/%(project_id)s |
+--------------+------------------------------------------+

$ openstack endpoint create --region RegionOne \
  volumev2 admin http://controller:8776/v2/%\(project_id\)s

+--------------+------------------------------------------+
| Field        | Value                                    |
+--------------+------------------------------------------+
| enabled      | True                                     |
| id           | e652cf84dd334f359ae9b045a2c91d96         |
| interface    | admin                                    |
| region       | RegionOne                                |
| region_id    | RegionOne                                |
| service_id   | eb9fd245bdbc414695952e93f29fe3ac         |
| service_name | cinderv2                                 |
| service_type | volumev2                                 |
| url          | http://controller:8776/v2/%(project_id)s |
+--------------+------------------------------------------+</pre><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack endpoint create --region RegionOne \
  volumev3 public http://controller:8776/v3/%\(project_id\)s

+--------------+------------------------------------------+
| Field        | Value                                    |
+--------------+------------------------------------------+
| enabled      | True                                     |
| id           | 03fa2c90153546c295bf30ca86b1344b         |
| interface    | public                                   |
| region       | RegionOne                                |
| region_id    | RegionOne                                |
| service_id   | ab3bbbef780845a1a283490d281e7fda         |
| service_name | cinderv3                                 |
| service_type | volumev3                                 |
| url          | http://controller:8776/v3/%(project_id)s |
+--------------+------------------------------------------+

$ openstack endpoint create --region RegionOne \
  volumev3 internal http://controller:8776/v3/%\(project_id\)s

+--------------+------------------------------------------+
| Field        | Value                                    |
+--------------+------------------------------------------+
| enabled      | True                                     |
| id           | 94f684395d1b41068c70e4ecb11364b2         |
| interface    | internal                                 |
| region       | RegionOne                                |
| region_id    | RegionOne                                |
| service_id   | ab3bbbef780845a1a283490d281e7fda         |
| service_name | cinderv3                                 |
| service_type | volumev3                                 |
| url          | http://controller:8776/v3/%(project_id)s |
+--------------+------------------------------------------+

$ openstack endpoint create --region RegionOne \
  volumev3 admin http://controller:8776/v3/%\(project_id\)s

+--------------+------------------------------------------+
| Field        | Value                                    |
+--------------+------------------------------------------+
| enabled      | True                                     |
| id           | 4511c28a0f9840c78bacb25f10f62c98         |
| interface    | admin                                    |
| region       | RegionOne                                |
| region_id    | RegionOne                                |
| service_id   | ab3bbbef780845a1a283490d281e7fda         |
| service_name | cinderv3                                 |
| service_type | volumev3                                 |
| url          | http://controller:8776/v3/%(project_id)s |
+--------------+------------------------------------------+</pre><p>The Block Storage services require endpoints for each service entity.</p></li></ol><h3><a name='header-n1389' class='md-header-anchor '></a>Install and configure components</h3><p>Install the packages:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># apt install cinder-api cinder-scheduler</pre><p>Edit the <code>/etc/cinder/cinder.conf</code> file and complete the following actions:</p><ul><li><p>In the <code>[database]</code> section, configure database access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[database]
# ...
connection = mysql+pymysql://cinder:CINDER_DBPASS@controller/cinder</pre><p>Replace <code>CINDER_DBPASS</code> with the password you chose for the Block Storage database.</p></li><li><p>In the <code>[DEFAULT]</code> section, configure <code>RabbitMQ</code> message queue access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
# ...
transport_url = rabbit://openstack:RABBIT_PASS@controller</pre><p>Replace <code>RABBIT_PASS</code> with the password you chose for the <code>openstack</code> account in <code>RabbitMQ</code>.</p></li><li><p>In the <code>[DEFAULT]</code> and <code>[keystone_authtoken]</code> sections, configure Identity service access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
# ...
auth_strategy = keystone

[keystone_authtoken]
# ...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = cinder
password = cinder</pre><p>Replace <code>password</code> with the password you chose for the <code>cinder</code> user in the Identity service.</p><p>Comment out or remove any other options in the <code>[keystone_authtoken]</code> section.</p></li><li><p>In the <code>[DEFAULT]</code> section, configure the <code>my_ip</code> option to use the management interface IP address of the controller node:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
# ...
my_ip = 10.20.0.10</pre></li></ul><ul><li><p>In the <code>[oslo_concurrency]</code> section, configure the lock path:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[oslo_concurrency]
# ...
lock_path = /var/lib/cinder/tmp</pre></li></ul><p>Populate the Block Storage database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># su -s /bin/sh -c &quot;cinder-manage db sync&quot; cinder</pre><p>Ignore any deprecation messages in this output.</p><h3><a name='header-n1430' class='md-header-anchor '></a>Configure Compute to use Block Storage</h3><ul><li><p>Edit the <code>/etc/nova/nova.conf</code> file and add the following to it:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[cinder]
os_region_name = RegionOne
</pre></li></ul><h3><a name='header-n1436' class='md-header-anchor '></a>Finalize installation</h3><ol start='' ><li><p>Restart the Compute API service:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service nova-api restart</pre></li><li><p>Restart the Block Storage services:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service cinder-scheduler restart
# service apache2 restart</pre></li></ol><h2><a name='header-n1446' class='md-header-anchor '></a>Cinder on block storage node</h2><h3><a name='header-n1447' class='md-header-anchor '></a>configure storage network for compute</h3><p>Check nic name</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@compute:~# dmesg | grep renamed
[    2.730898] e1000 0000:00:09.0 enp0s9: renamed from eth2
[    2.731826] e1000 0000:00:08.0 enp0s8: renamed from eth1
[    2.732819] e1000 0000:00:0a.0 enp0s10: renamed from eth3
[    2.735645] e1000 0000:00:03.0 enp0s3: renamed from eth0</pre><p><code>eth2</code> was named as <code>enp0s9</code></p><p>Edit <code>/etc/network/interfaces</code></p><pre class='md-fences mock-cm' style='display:block;position:relative'># storage network eth2
auto enp0s9
iface enp0s9 inet static
address 192.168.99.20
netmask 255.255.255.0</pre><pre class='md-fences mock-cm' style='display:block;position:relative'># ifup enp0s9</pre><h3><a name='header-n1457' class='md-header-anchor '></a>Create cinder machine: storage</h3><h2><a name='header-n1458' class='md-header-anchor '></a>Storage node actions</h2><blockquote><p>Clone it from base VM and add a virtual disk for storage vm</p></blockquote><h3><a name='header-n1462' class='md-header-anchor '></a>Management net eth0 (enp0s3) and storage net eth2 (enp0s9)</h3><p>Edit <code>/etc/network/interfaces</code></p><pre class='md-fences mock-cm' style='display:block;position:relative'># management network eth0

auto enp0s3
iface enp0s3 inet static
address 10.20.0.30
netmask 255.255.255.0</pre><pre class='md-fences mock-cm' style='display:block;position:relative'># storage network eth2
auto enp0s9
iface enp0s9 inet static
address 192.168.99.30
netmask 255.255.255.0</pre><pre class='md-fences mock-cm' style='display:block;position:relative'>//start the two nics
# ifup enp0s3
# ifup enp0s9</pre><h3><a name='header-n1468' class='md-header-anchor '></a>configure NTP by editing <code>/etc/chrony/chrony.conf</code></h3><pre class='md-fences mock-cm' style='display:block;position:relative'>server 10.20.0.10 iburst</pre><p>change hostname and hosts</p><pre class='md-fences mock-cm' style='display:block;position:relative'># echo storage &gt; /etc/hostname
# echo 10.20.0.10    controller &gt;&gt; /etc/hosts
# echo 10.20.0.20    compute &gt;&gt; /etc/hosts
# hostname storage</pre><h3><a name='header-n1473' class='md-header-anchor '></a>Check new disk was there already</h3><p>check by <code>fdisk -l</code> , /dev/sdb is there :-) .</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@storage:~# fdisk -l
Disk /dev/sda: 50 GiB, 53687091200 bytes, 104857600 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x3ce50a75

Device     Boot   Start       End   Sectors  Size Id Type
/dev/sda1  *       2048    999423    997376  487M 83 Linux
/dev/sda2       1001470 104855551 103854082 49.5G  5 Extended
/dev/sda5       1001472 104855551 103854080 49.5G 8e Linux LVM


Disk /dev/sdb: 50 GiB, 53687091200 bytes, 104857600 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes


Disk /dev/mapper/ubuntu--vg-root: 45.5 GiB, 48876224512 bytes, 95461376 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes


Disk /dev/mapper/ubuntu--vg-swap_1: 4 GiB, 4294967296 bytes, 8388608 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes</pre><p></p><h2><a name='header-n1479' class='md-header-anchor '></a>Cinder on storage node</h2><h3><a name='header-n1480' class='md-header-anchor '></a>Install and configure a storage node</h3><p>This section describes how to install and configure storage nodes for the Block Storage service. For simplicity, this configuration references one storage node with an empty local block storage device. The instructions use <code>/dev/sdb</code>, but you can substitute a different value for your particular node.</p><p>The service provisions logical volumes on this device using the <a href='https://docs.openstack.org/ocata/install-guide-ubuntu/common/glossary.html#term-logical-volume-manager-lvm'>LVM</a> driver and provides them to instances via <a href='https://docs.openstack.org/ocata/install-guide-ubuntu/common/glossary.html#term-iscsi-qualified-name-iqn'>iSCSI</a> transport. You can follow these instructions with minor modifications to horizontally scale your environment with additional storage nodes.</p><h3><a name='header-n1485' class='md-header-anchor '></a>Prerequisites</h3><p>Before you install and configure the Block Storage service on the storage node, you must prepare the storage device.</p><p> </p><p>Perform these steps on the storage node.</p><ol start='' ><li><p>Install the supporting utility packages:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># apt install lvm2</pre><p> Some distributions include LVM by default.</p></li><li><p>Create the LVM physical volume <code>/dev/sdb</code>:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># pvcreate /dev/sdb

Physical volume &quot;/dev/sdb&quot; successfully created</pre></li><li><p>Create the LVM volume group <code>cinder-volumes</code>:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># vgcreate cinder-volumes /dev/sdb

Volume group &quot;cinder-volumes&quot; successfully created</pre><p>The Block Storage service creates logical volumes in this volume group.</p></li><li><p>Only instances can access Block Storage volumes. However, the underlying operating system manages the devices associated with the volumes. By default, the LVM volume scanning tool scans the <code>/dev</code> directory for block storage devices that contain volumes. If projects use LVM on their volumes, the scanning tool detects these volumes and attempts to cache them which can cause a variety of problems with both the underlying operating system and project volumes. You must reconfigure LVM to scan only the devices that contain the <code>cinder-volumes</code> volume group. Edit the <code>/etc/lvm/lvm.conf</code> file and complete the following actions:</p><ul><li><p>In the <code>devices</code> section, add a filter that accepts the <code>/dev/sdb</code> device and rejects all other devices:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>devices {
...
filter = [ &quot;a/sdb/&quot;, &quot;r/.*/&quot;]</pre><p>Each item in the filter array begins with <code>a</code> for <strong>accept</strong> or <code>r</code> for <strong>reject</strong> and includes a regular expression for the device name. The array must end with <code>r/.*/</code> to reject any remaining devices. You can use the <strong>vgs -vvvv</strong> command to test filters.</p><p>If your storage nodes use LVM on the operating system disk, you must also add the associated device to the filter. For example, if the <code>/dev/sda</code> device contains the operating system:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>filter = [ &quot;a/sda/&quot;, &quot;a/sdb/&quot;, &quot;r/.*/&quot;]
</pre><p>Similarly, if your compute nodes use LVM on the operating system disk, you must also modify the filter in the<code>/etc/lvm/lvm.conf</code> file on those nodes to include only the operating system disk. For example, if the <code>/dev/sda</code>device contains the operating system:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>filter = [ &quot;a/sda/&quot;, &quot;r/.*/&quot;]</pre></li></ul></li></ol><h3><a name='header-n1525' class='md-header-anchor '></a>Install and configure components</h3><p>Install the packages:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># apt install cinder-volume -y</pre><ol start='' ><li><p>Edit the <code>/etc/cinder/cinder.conf</code> file and complete the following actions:</p><ul><li><p>In the <code>[database]</code> section, configure database access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[database]
# ...
connection = mysql+pymysql://cinder:CINDER_DBPASS@controller/cinder</pre><p>Replace <code>CINDER_DBPASS</code> with the password you chose for the Block Storage database.</p></li><li><p>In the <code>[DEFAULT]</code> section, configure <code>RabbitMQ</code> message queue access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
# ...
transport_url = rabbit://openstack:RABBIT_PASS@controller</pre><p>Replace <code>RABBIT_PASS</code> with the password you chose for the <code>openstack</code> account in <code>RabbitMQ</code>.</p></li><li><p>In the <code>[DEFAULT]</code> and <code>[keystone_authtoken]</code> sections, configure Identity service access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
# ...
auth_strategy = keystone

[keystone_authtoken]
# ...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = cinder
password = cinder</pre><p>Replace <code>password</code> with the password you chose for the <code>cinder</code> user in the Identity service.</p><p>Comment out or remove any other options in the <code>[keystone_authtoken]</code> section.</p></li><li><p>In the <code>[DEFAULT]</code> section, configure the <code>my_ip</code> option:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
# ...
my_ip = STORAGE_INTERFACE_IP_ADDRESS</pre><p>Replace <code>STORAGE_INTERFACE_IP_ADDRESS</code> with the IP address of the storage network (eth2).</p></li></ul></li></ol><ul><li><p>In the <code>[lvm]</code> section, configure the LVM back end with the LVM driver, <code>cinder-volumes</code> volume group, iSCSI protocol, and appropriate iSCSI service:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[lvm]
# ...
volume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver
volume_group = cinder-volumes
iscsi_protocol = iscsi
iscsi_helper = tgtadm</pre></li></ul><ul><li><p>In the <code>[DEFAULT]</code> section, enable the LVM back end:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
# ...
enabled_backends = lvm</pre><p>Back-end names are arbitrary. As an example, this guide uses the name of the driver as the name of the back end.</p></li><li><p>In the <code>[DEFAULT]</code> section, configure the location of the Image service API:</p><pre class='md-fences mock-cm' style='display:block;position:relative'> ​```
 [DEFAULT]
 # ...
 glance_api_servers = http://controller:9292
 ​```</pre><ul><li><p>In the <code>[oslo_concurrency]</code> section, configure the lock path:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[oslo_concurrency]
# ...
lock_path = /var/lib/cinder/tmp</pre></li></ul></li></ul><h3><a name='header-n1581' class='md-header-anchor '></a>Finalize installation</h3><ol start='' ><li><p>Restart the Block Storage volume service including its dependencies:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service tgt restart
# service cinder-volume restart</pre></li></ol><h3><a name='header-n1588' class='md-header-anchor '></a>Verify operation</h3><p>Verify operation of the Block Storage service. </p><p>Perform these commands on the controller node.</p><ol start='' ><li><p>Source the <code>admin</code> credentials to gain access to admin-only CLI commands:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ . admin-openrc</pre></li><li><p>List service components to verify successful launch of each process:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# openstack volume service list
+------------------+-------------+------+---------+-------+----------------------------+
| Binary           | Host        | Zone | Status  | State | Updated At                 |
+------------------+-------------+------+---------+-------+----------------------------+
| cinder-scheduler | controller  | nova | enabled | up    | 2017-08-24T14:35:44.000000 |
| cinder-volume    | storage@lvm | nova | enabled | up    | 2017-08-24T14:35:39.000000 |
+------------------+-------------+------+---------+-------+----------------------------+</pre></li></ol><h2><a name='header-n1603' class='md-header-anchor '></a>Let&#39;s try something on block storage!</h2><h3><a name='header-n1604' class='md-header-anchor '></a>Create a volume</h3><ol start='' ><li><p>Source the <code>demo</code> credentials to perform the following steps as a non-administrative project:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ . demo-openrc</pre></li><li><p>Create a 1 GB volume:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack volume create --size 1 volume1

+---------------------+--------------------------------------+
| Field               | Value                                |
+---------------------+--------------------------------------+
| attachments         | []                                   |
| availability_zone   | nova                                 |
| bootable            | false                                |
| consistencygroup_id | None                                 |
| created_at          | 2016-03-08T14:30:48.391027           |
| description         | None                                 |
| encrypted           | False                                |
| id                  | a1e8be72-a395-4a6f-8e07-856a57c39524 |
| multiattach         | False                                |
| name                | volume1                              |
| properties          |                                      |
| replication_status  | disabled                             |
| size                | 1                                    |
| snapshot_id         | None                                 |
| source_volid        | None                                 |
| status              | creating                             |
| type                | None                                 |
| updated_at          | None                                 |
| user_id             | 684286a9079845359882afc3aa5011fb     |
+---------------------+--------------------------------------+</pre></li><li><p>After a short time, the volume status should change from <code>creating</code> to <code>available</code>:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# openstack volume list
+--------------------------------------+--------------+-----------+------+-------------+
| ID                                   | Display Name | Status    | Size | Attached to |
+--------------------------------------+--------------+-----------+------+-------------+
| 81ffed40-ed71-495d-bfa9-8fb8c72cf222 | volume1      | available |    1 |             |
+--------------------------------------+--------------+-----------+------+-------------+</pre></li><li><p>check where it is?</p></li></ol><pre class='md-fences mock-cm' style='display:block;position:relative'>root@storage:~# lvdisplay
  --- Logical volume ---
  LV Path                /dev/ubuntu-vg/root
  LV Name                root
  VG Name                ubuntu-vg
  LV UUID                NA7DgH-V0Sv-cH8E-wvej-aJmP-6EBO-joXO0C
  LV Write Access        read/write
  LV Creation host, time ubuntu, 2017-08-23 16:30:36 +0800
  LV Status              available
  # open                 1
  LV Size                45.52 GiB
  Current LE             11653
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           252:0

  --- Logical volume ---
  LV Path                /dev/ubuntu-vg/swap_1
  LV Name                swap_1
  VG Name                ubuntu-vg
  LV UUID                Vtixi8-qKcP-f1LH-bHqM-E73h-NN7z-eSD2zk
  LV Write Access        read/write
  LV Creation host, time ubuntu, 2017-08-23 16:30:36 +0800
  LV Status              available
  # open                 2
  LV Size                4.00 GiB
  Current LE             1024
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           252:1

  --- Logical volume ---
  LV Path                /dev/cinder-volumes/volume-81ffed40-ed71-495d-bfa9-8fb8c72cf222
  LV Name                volume-81ffed40-ed71-495d-bfa9-8fb8c72cf222
  VG Name                cinder-volumes
  LV UUID                6jbPGA-i3Eo-O4ng-8Mf3-IoeF-9WF7-g1DGEA
  LV Write Access        read/write
  LV Creation host, time storage, 2017-08-24 22:38:28 +0800
  LV Status              available
  # open                 0
  LV Size                1.00 GiB
  Current LE             256
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           252:2
</pre><p></p><h3><a name='header-n1624' class='md-header-anchor '></a>Attach the volume to an instance</h3><ol start='' ><li><p>Attach a volume to an instance:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack server add volume INSTANCE_NAME VOLUME_NAME</pre><p>Replace <code>INSTANCE_NAME</code> with the name of the instance and <code>VOLUME_NAME</code> with the name of the volume you want to attach to it.</p><p><strong>Example</strong></p><p>Attach the <code>volume1</code> volume to the <code>provider-instance</code> instance:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack server add volume provider-instance volume1</pre><p>​</p><p>This command provides no output.</p></li><li><p>List volumes:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# openstack volume list
+--------------------------------------+--------------+--------+------+--------------------------------------------+
| ID                                   | Display Name | Status | Size | Attached to                                |
+--------------------------------------+--------------+--------+------+--------------------------------------------+
| 81ffed40-ed71-495d-bfa9-8fb8c72cf222 | volume1      | in-use |    1 | Attached to provider-instance on /dev/vdb  |
+--------------------------------------+--------------+--------+------+--------------------------------------------+

root@storage:~# lvdisplay
  --- Logical volume ---
  LV Path                /dev/ubuntu-vg/root
  LV Name                root
  VG Name                ubuntu-vg
  LV UUID                NA7DgH-V0Sv-cH8E-wvej-aJmP-6EBO-joXO0C
  LV Write Access        read/write
  LV Creation host, time ubuntu, 2017-08-23 16:30:36 +0800
  LV Status              available
  # open                 1
  LV Size                45.52 GiB
  Current LE             11653
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto</pre></li></ol><pre class='md-fences mock-cm' style='display:block;position:relative'> - currently set to     256
 Block device           252:0

 --- Logical volume ---
 LV Path                /dev/ubuntu-vg/swap_1
 LV Name                swap_1
 VG Name                ubuntu-vg
 LV UUID                Vtixi8-qKcP-f1LH-bHqM-E73h-NN7z-eSD2zk
 LV Write Access        read/write
 LV Creation host, time ubuntu, 2017-08-23 16:30:36 +0800
 LV Status              available
 # open                 2
 LV Size                4.00 GiB
 Current LE             1024
 Segments               1
 Allocation             inherit
 Read ahead sectors     auto
 - currently set to     256
 Block device           252:1

 --- Logical volume ---
 LV Path                /dev/cinder-volumes/volume-81ffed40-ed71-495d-bfa9-8fb8c72cf222
 LV Name                volume-81ffed40-ed71-495d-bfa9-8fb8c72cf222
 VG Name                cinder-volumes
 LV UUID                6jbPGA-i3Eo-O4ng-8Mf3-IoeF-9WF7-g1DGEA
 LV Write Access        read/write
 LV Creation host, time storage, 2017-08-24 22:38:28 +0800
 LV Status              available
 # open                 1
 LV Size                1.00 GiB
 Current LE             256
 Segments               1
 Allocation             inherit
 Read ahead sectors     auto
 - currently set to     256
 Block device           252:2
   ```</pre><pre class='md-fences mock-cm' style='display:block;position:relative'>
3. Access your instance using SSH or `virsh console` and use the `fdisk` command to verify presence of the volume as the `/dev/vdb` block storage device:
</pre><p>   $ sudo fdisk -l</p><p>   Disk /dev/vda: 1073 MB, 1073741824 bytes
   255 heads, 63 sectors/track, 130 cylinders, total 2097152 sectors
   Units = sectors of 1 * 512 = 512 bytes
   Sector size (logical/physical): 512 bytes / 512 bytes
   I/O size (minimum/optimal): 512 bytes / 512 bytes
   Disk identifier: 0x00000000</p><pre class='md-fences mock-cm' style='display:block;position:relative'>  Device Boot      Start         End      Blocks   Id  System</pre><p>   /dev/vda1   *       16065     2088449     1036192+  83  Linux</p><p>   Disk /dev/vdb: 1073 MB, 1073741824 bytes
   16 heads, 63 sectors/track, 2080 cylinders, total 2097152 sectors
   Units = sectors of 1 * 512 = 512 bytes
   Sector size (logical/physical): 512 bytes / 512 bytes
   I/O size (minimum/optimal): 512 bytes / 512 bytes
   Disk identifier: 0x00000000</p><p>   Disk /dev/vdb doesn&#39;t contain a valid partition table</p><pre class='md-fences mock-cm' style='display:block;position:relative'>
4. Check from storage node on iSCSI target point of view, it&#39;s found 

   - Initiator: `iqn.1993-08.org.debian:01:e7b693dedcab alias: compute`
   - LUN 1: `Backing store path: /dev/cinder-volumes/volume-81ffed40-ed71-495d-bfa9-8fb8c72cf222`
</pre><p>   root@storage:~# tgtadm --lld iscsi --op show --mode target
   Target 1: iqn.2010-10.org.openstack:volume-81ffed40-ed71-495d-bfa9-8fb8c72cf222</p><pre class='md-fences mock-cm' style='display:block;position:relative'>   System information:
       Driver: iscsi
       State: ready
   I_T nexus information:
       I_T nexus: 1
           Initiator: iqn.1993-08.org.debian:01:e7b693dedcab alias: compute
           Connection: 0
               IP Address: 192.168.199.20
   LUN information:
       LUN: 0
           Type: controller
           SCSI ID: IET     00010000
           SCSI SN: beaf10
           Size: 0 MB, Block size: 1
           Online: Yes
           Removable media: No
           Prevent removal: No
           Readonly: No
           SWP: No
           Thin-provisioning: No
           Backing store type: null
           Backing store path: None
           Backing store flags:
       LUN: 1
           Type: disk
           SCSI ID: IET     00010001
           SCSI SN: beaf11
           Size: 1074 MB, Block size: 512
           Online: Yes
           Removable media: No
           Prevent removal: No
           Readonly: No
           SWP: No
           Thin-provisioning: No
           Backing store type: rdwr
           Backing store path: /dev/cinder-volumes/volume-81ffed40-ed71-495d-bfa9-8fb8c72cf222
           Backing store flags:
   Account information:
       7jTnhhxXsVM4BwqxG979
   ACL information:
       ALL</pre><pre class='md-fences mock-cm' style='display:block;position:relative'>
   ​

5. Checking from compute via `virsh dumpxml &lt;instance-id&gt;`

   It&#39;s shown the device from initiator point of view:
</pre><pre class='md-fences mock-cm' style='display:block;position:relative'>   &lt;disk type=&#39;block&#39; device=&#39;disk&#39;&gt;
     &lt;driver name=&#39;qemu&#39; type=&#39;raw&#39; cache=&#39;none&#39; io=&#39;native&#39;/&gt;
     &lt;source dev=&#39;/dev/disk/by-path/ip-192.168.199.30:3260-iscsi-iqn.2010-10.org.openstack:volume-81ffed40-ed71-495d-bfa9-8fb8c72cf222-lun-1&#39;/&gt;
     &lt;backingStore/&gt;
     &lt;target dev=&#39;vdb&#39; bus=&#39;virtio&#39;/&gt;
     &lt;serial&gt;81ffed40-ed71-495d-bfa9-8fb8c72cf222&lt;/serial&gt;
     &lt;alias name=&#39;virtio-disk1&#39;/&gt;
     &lt;address type=&#39;pci&#39; domain=&#39;0x0000&#39; bus=&#39;0x00&#39; slot=&#39;0x05&#39; function=&#39;0x0&#39;/&gt;
   &lt;/disk&gt;</pre><pre class='md-fences mock-cm' style='display:block;position:relative'>
   ​

## Heat

### Install and configure 

This section describes how to install and configure the Orchestration service for Ubuntu 14.04 (LTS).

While our Ubuntu 16.04.3 LTS will be ok as well. 

### Prerequisites

Before you install and configure Orchestration, you must create a database, service credentials, and API endpoints. Orchestration also requires additional information in the Identity service.

1. To create the database, complete these steps:

   - Use the database access client to connect to the database server as the `root` user:
</pre><pre class='md-fences mock-cm' style='display:block;position:relative'> $ mysql
 ```</pre><ul><li><p>Create the <code>heat</code> database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>CREATE DATABASE heat;</pre></li><li><p>Grant proper access to the <code>heat</code> database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'> ​```
 GRANT ALL PRIVILEGES ON heat.* TO &#39;heat&#39;@&#39;localhost&#39; \
   IDENTIFIED BY &#39;HEAT_DBPASS&#39;;
 GRANT ALL PRIVILEGES ON heat.* TO &#39;heat&#39;@&#39;%&#39; \
   IDENTIFIED BY &#39;HEAT_DBPASS&#39;;
 ​```
 
 Replace `HEAT_DBPASS` with a suitable password.</pre><ul><li>Exit the database access client.</li></ul></li></ul><ol start='' ><li><p>Source the <code>admin</code> credentials to gain access to admin-only CLI commands:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ . admin-openrc
</pre></li><li><p>To create the service credentials, complete these steps:</p><ul><li><p>Create the <code>heat</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack user create --domain default --password-prompt heat
User Password:
Repeat User Password:
+-----------+----------------------------------+
| Field     | Value                            |
+-----------+----------------------------------+
| domain_id | e0353a670a9e496da891347c589539e9 |
| enabled   | True                             |
| id        | ca2e175b851943349be29a328cc5e360 |
| name      | heat                             |
+-----------+----------------------------------+</pre></li><li><p>Add the <code>admin</code> role to the <code>heat</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack role add --project service --user heat admin</pre><p>This command provides no output.</p></li><li><p>Create the <code>heat</code> and <code>heat-cfn</code> service entities:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack service create --name heat \
  --description &quot;Orchestration&quot; orchestration
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Orchestration                    |
| enabled     | True                             |
| id          | 727841c6f5df4773baa4e8a5ae7d72eb |
| name        | heat                             |
| type        | orchestration                    |
+-------------+----------------------------------+

$ openstack service create --name heat-cfn \
  --description &quot;Orchestration&quot;  cloudformation
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Orchestration                    |
| enabled     | True                             |
| id          | c42cede91a4e47c3b10c8aedc8d890c6 |
| name        | heat-cfn                         |
| type        | cloudformation                   |
+-------------+----------------------------------+</pre></li></ul></li><li><p>Create the Orchestration service API endpoints:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack endpoint create --region RegionOne \
  orchestration public http://controller:8004/v1/%\(tenant_id\)s
+--------------+-----------------------------------------+
| Field        | Value                                   |
+--------------+-----------------------------------------+
| enabled      | True                                    |
| id           | 3f4dab34624e4be7b000265f25049609        |
| interface    | public                                  |
| region       | RegionOne                               |
| region_id    | RegionOne                               |
| service_id   | 727841c6f5df4773baa4e8a5ae7d72eb        |
| service_name | heat                                    |
| service_type | orchestration                           |
| url          | http://controller:8004/v1/%(tenant_id)s |
+--------------+-----------------------------------------+

$ openstack endpoint create --region RegionOne \
  orchestration internal http://controller:8004/v1/%\(tenant_id\)s
+--------------+-----------------------------------------+
| Field        | Value                                   |
+--------------+-----------------------------------------+
| enabled      | True                                    |
| id           | 9489f78e958e45cc85570fec7e836d98        |
| interface    | internal                                |
| region       | RegionOne                               |
| region_id    | RegionOne                               |
| service_id   | 727841c6f5df4773baa4e8a5ae7d72eb        |
| service_name | heat                                    |
| service_type | orchestration                           |
| url          | http://controller:8004/v1/%(tenant_id)s |
+--------------+-----------------------------------------+

$ openstack endpoint create --region RegionOne \
  orchestration admin http://controller:8004/v1/%\(tenant_id\)s
+--------------+-----------------------------------------+
| Field        | Value                                   |
+--------------+-----------------------------------------+
| enabled      | True                                    |
| id           | 76091559514b40c6b7b38dde790efe99        |
| interface    | admin                                   |
| region       | RegionOne                               |
| region_id    | RegionOne                               |
| service_id   | 727841c6f5df4773baa4e8a5ae7d72eb        |
| service_name | heat                                    |
| service_type | orchestration                           |
| url          | http://controller:8004/v1/%(tenant_id)s |
+--------------+-----------------------------------------+</pre><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack endpoint create --region RegionOne \
  cloudformation public http://controller:8000/v1
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | b3ea082e019c4024842bf0a80555052c |
| interface    | public                           |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | c42cede91a4e47c3b10c8aedc8d890c6 |
| service_name | heat-cfn                         |
| service_type | cloudformation                   |
| url          | http://controller:8000/v1        |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne \
  cloudformation internal http://controller:8000/v1
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 169df4368cdc435b8b115a9cb084044e |
| interface    | internal                         |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | c42cede91a4e47c3b10c8aedc8d890c6 |
| service_name | heat-cfn                         |
| service_type | cloudformation                   |
| url          | http://controller:8000/v1        |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne \
  cloudformation admin http://controller:8000/v1
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 3d3edcd61eb343c1bbd629aa041ff88b |
| interface    | internal                         |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | c42cede91a4e47c3b10c8aedc8d890c6 |
| service_name | heat-cfn                         |
| service_type | cloudformation                   |
| url          | http://controller:8000/v1        |
+--------------+----------------------------------+</pre></li><li><p>Orchestration requires additional information in the Identity service to manage stacks. To add this information, complete these steps:</p><ul><li><p>Create the <code>heat</code> domain that contains projects and users for stacks:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack domain create --description &quot;Stack projects and users&quot; heat
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Stack projects and users         |
| enabled     | True                             |
| id          | 0f4d1bd326f2454dacc72157ba328a47 |
| name        | heat                             |
+-------------+----------------------------------+</pre></li><li><p>Create the <code>heat_domain_admin</code> user to manage projects and users in the <code>heat</code> domain:</p><blockquote><p>here i gave password: heat_domain_admin</p></blockquote><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack user create --domain heat --password-prompt heat_domain_admin
User Password:
Repeat User Password:
+-----------+----------------------------------+
| Field     | Value                            |
+-----------+----------------------------------+
| domain_id | 0f4d1bd326f2454dacc72157ba328a47 |
| enabled   | True                             |
| id        | b7bd1abfbcf64478b47a0f13cd4d970a |
| name      | heat_domain_admin                |
+-----------+----------------------------------+</pre></li><li><p>Add the <code>admin</code> role to the <code>heat_domain_admin</code> user in the <code>heat</code> domain to enable administrative stack management privileges by the <code>heat_domain_admin</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack role add --domain heat --user-domain heat --user heat_domain_admin admin</pre><p>This command provides no output.</p></li><li><p>Create the <code>heat_stack_owner</code> role:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack role create heat_stack_owner
+-----------+----------------------------------+
| Field     | Value                            |
+-----------+----------------------------------+
| domain_id | None                             |
| id        | 15e34f0c4fed4e68b3246275883c8630 |
| name      | heat_stack_owner                 |
+-----------+----------------------------------+</pre></li><li><p>Add the <code>heat_stack_owner</code> role to the <code>demo</code> project and user to enable stack management by the <code>demo</code> user:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack role add --project demo --user demo heat_stack_owner</pre><p>This command provides no output.</p><blockquote><p>You must add the <code>heat_stack_owner</code> role to each user that manages stacks.</p></blockquote></li><li><p>Create the <code>heat_stack_user</code> role:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack role create heat_stack_user
+-----------+----------------------------------+
| Field     | Value                            |
+-----------+----------------------------------+
| domain_id | None                             |
| id        | 88849d41a55d4d1d91e4f11bffd8fc5c |
| name      | heat_stack_user                  |
+-----------+----------------------------------+</pre><p>The Orchestration service automatically assigns the <code>heat_stack_user</code> role to users that it creates during stack deployment. By default, this role restricts API <Application Programming Interface (API)> operations. To avoid conflicts, do not add this role to users with the <code>heat_stack_owner</code> role.</p></li></ul></li></ol><h3><a name='header-n1758' class='md-header-anchor '></a>Install and configure components</h3><p>Install the packages:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># apt-get install heat-api heat-api-cfn heat-engine</pre><ol start='' ><li><p>Edit the <code>/etc/heat/heat.conf</code> file and complete the following actions:</p><ul><li><p>In the <code>[database]</code> section, configure database access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[database]
...
connection = mysql+pymysql://heat:HEAT_DBPASS@controller/heat</pre><p>Replace <code>HEAT_DBPASS</code> with the password you chose for the Orchestration database.</p></li><li><p>In the <code>[DEFAULT]</code> section, configure <code>RabbitMQ</code> message queue access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
...
transport_url = rabbit://openstack:RABBIT_PASS@controller</pre><p>Replace <code>RABBIT_PASS</code> with the password you chose for the <code>openstack</code> account in <code>RabbitMQ</code>.</p></li><li><p>In the <code>[keystone_authtoken]</code>, <code>[trustee]</code> and <code>[clients_keystone]</code> sections, configure Identity service access:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[keystone_authtoken]
...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = heat
password = HEAT_PASS

[trustee]
...
auth_type = password
auth_url = http://controller:35357
username = heat
password = heat
user_domain_name = default

[clients_keystone]
...
auth_uri = http://controller:5000</pre><p>Replace <code>password</code> with the password you chose for the <code>heat</code> user in the Identity service.</p></li><li><p>In the <code>[DEFAULT]</code> section, configure the metadata and wait condition URLs:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
...
heat_metadata_server_url = http://controller:8000
heat_waitcondition_server_url = http://controller:8000/v1/waitcondition</pre></li><li><p>In the <code>[DEFAULT]</code> section, configure the stack domain and administrative credentials:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[DEFAULT]
...
stack_domain_admin = heat_domain_admin
stack_domain_admin_password = heat_domain_admin
stack_user_domain_name = heat</pre><p>Replace <code>heat_domain_admin</code> with the password you chose for the <code>heat_domain_admin</code> user in the Identity service.</p></li></ul></li><li><p>Populate the Orchestration database:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># su -s /bin/sh -c &quot;heat-manage db_sync&quot; heat</pre><p>Ignore any deprecation messages in this output.</p></li></ol><h3><a name='header-n1801' class='md-header-anchor '></a>Finalize installation</h3><ol start='' ><li><p>Restart the Orchestration services:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service heat-api restart
# service heat-api-cfn restart
# service heat-engine restart</pre></li></ol><h3><a name='header-n1807' class='md-header-anchor '></a>Verify operation</h3><p>Verify operation of the Orchestration service. </p><p>Perform these commands on the controller node.</p><ol start='' ><li><p>Source the <code>admin</code> tenant credentials:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ . admin-openrc</pre></li><li><p>List service components to verify successful launch and registration of each process:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack orchestration service list
+------------+-------------+--------------------------------------+------------+--------+----------------------------+--------+
| hostname   | binary      | engine_id                            | host       | topic  | updated_at                 | status |
+------------+-------------+--------------------------------------+------------+--------+----------------------------+--------+
| controller | heat-engine | 3e85d1ab-a543-41aa-aa97-378c381fb958 | controller | engine | 2015-10-13T14:16:06.000000 | up     |
| controller | heat-engine | 45dbdcf6-5660-4d5f-973a-c4fc819da678 | controller | engine | 2015-10-13T14:16:06.000000 | up     |
| controller | heat-engine | 51162b63-ecb8-4c6c-98c6-993af899c4f7 | controller | engine | 2015-10-13T14:16:06.000000 | up     |
| controller | heat-engine | 8d7edc6d-77a6-460d-bd2a-984d76954646 | controller | engine | 2015-10-13T14:16:06.000000 | up     |
+------------+-------------+--------------------------------------+------------+--------+----------------------------+--------+</pre><p>This output should indicate four <code>heat-engine</code> components (default to 4 or number of CPUs on the host, whichever is greater) on the controller node.</p></li></ol><h2><a name='header-n1823' class='md-header-anchor '></a>[ISSUE] list heat service failure</h2><h3><a name='header-n1824' class='md-header-anchor '></a>error occurred during <code>openstack orchestration service list</code></h3><p>the initial output is very nonsense as below:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># openstack orchestration service list
ERROR: None</pre><p> give <code>--debug</code> to have detailed information</p><pre class='md-fences mock-cm' style='display:block;position:relative'>REQ: curl -g -i -X GET http://controller:8004/v1/78c9c849237649a3a8c4526167427589/services -H &quot;User-Agent: python-heatclient&quot; -H &quot;Accept: application/json&quot; -H &quot;X-Auth-Token: {SHA1}d4b406278269babd78368ed572cbe50382938cb6&quot;
Starting new HTTP connection (1): controller
http://controller:8004 &quot;GET /v1/78c9c849237649a3a8c4526167427589/services HTTP/1.1&quot; 503 170
RESP: [503] Content-Length: 170 Content-Type: application/json; charset=UTF-8 X-Openstack-Request-Id: req-e38d405a-776d-44fa-bb31-e180d62c42e0 Date: Fri, 25 Aug 2017 06:05:45 GMT Connection: keep-alive
RESP BODY: {&quot;message&quot;: &quot;The server is currently unavailable. Please try again at a later time.&lt;br /&gt;&lt;br /&gt;\n\n\n&quot;, &quot;code&quot;: &quot;503 Service Unavailable&quot;, &quot;title&quot;: &quot;Service Unavailable&quot;}

GET call to orchestration for http://controller:8004/v1/78c9c849237649a3a8c4526167427589/services used request id req-e38d405a-776d-44fa-bb31-e180d62c42e0
ERROR: None
Traceback (most recent call last):
  File &quot;/usr/lib/python2.7/dist-packages/cliff/app.py&quot;, line 400, in run_subcommand
    result = cmd.run(parsed_args)
  File &quot;/usr/lib/python2.7/dist-packages/osc_lib/command/command.py&quot;, line 41, in run
    return super(Command, self).run(parsed_args)
  File &quot;/usr/lib/python2.7/dist-packages/cliff/display.py&quot;, line 112, in run
    column_names, data = self.take_action(parsed_args)
  File &quot;/usr/lib/python2.7/dist-packages/heatclient/osc/v1/service.py&quot;, line 37, in take_action

  File &quot;/usr/lib/python2.7/dist-packages/heatclient/v1/services.py&quot;, line 33, in list
    return self._list(url, &quot;services&quot;)
  File &quot;/usr/lib/python2.7/dist-packages/heatclient/common/base.py&quot;, line 114, in _list

  File &quot;/usr/lib/python2.7/dist-packages/keystoneauth1/adapter.py&quot;, line 217, in get
    return self.request(url, &#39;GET&#39;, **kwargs)
  File &quot;/usr/lib/python2.7/dist-packages/heatclient/common/http.py&quot;, line 318, in request
    raise exc.from_response(resp)
HTTPServiceUnavailable: ERROR: None
clean_up ListService: ERROR: None
Traceback (most recent call last):
  File &quot;/usr/lib/python2.7/dist-packages/osc_lib/shell.py&quot;, line 135, in run
    ret_val = super(OpenStackShell, self).run(argv)
  File &quot;/usr/lib/python2.7/dist-packages/cliff/app.py&quot;, line 279, in run
    result = self.run_subcommand(remainder)
  File &quot;/usr/lib/python2.7/dist-packages/osc_lib/shell.py&quot;, line 180, in run_subcommand
    ret_value = super(OpenStackShell, self).run_subcommand(argv)
  File &quot;/usr/lib/python2.7/dist-packages/cliff/app.py&quot;, line 400, in run_subcommand
    result = cmd.run(parsed_args)
  File &quot;/usr/lib/python2.7/dist-packages/osc_lib/command/command.py&quot;, line 41, in run
    return super(Command, self).run(parsed_args)
  File &quot;/usr/lib/python2.7/dist-packages/cliff/display.py&quot;, line 112, in run
    column_names, data = self.take_action(parsed_args)
  File &quot;/usr/lib/python2.7/dist-packages/heatclient/osc/v1/service.py&quot;, line 37, in take_action
    services = heat_client.services.list()
  File &quot;/usr/lib/python2.7/dist-packages/heatclient/v1/services.py&quot;, line 33, in list
    return self._list(url, &quot;services&quot;)
  File &quot;/usr/lib/python2.7/dist-packages/heatclient/common/base.py&quot;, line 114, in _list
    body = self.client.get(url).json()
  File &quot;/usr/lib/python2.7/dist-packages/keystoneauth1/adapter.py&quot;, line 217, in get
    return self.request(url, &#39;GET&#39;, **kwargs)
  File &quot;/usr/lib/python2.7/dist-packages/heatclient/common/http.py&quot;, line 318, in request
    raise exc.from_response(resp)
HTTPServiceUnavailable: ERROR: None

END return value: 1</pre><p>We could see it got <code>503</code> when performing api call in <code>8004</code> port</p><pre class='md-fences mock-cm' style='display:block;position:relative'>REQ: curl -g -i -X GET http://controller:8004/v1/78c9c849237649a3a8c4526167427589/services -H &quot;User-Agent: python-heatclient&quot; -H &quot;Accept: application/json&quot; -H &quot;X-Auth-Token: {SHA1}d4b406278269babd78368ed572cbe50382938cb6&quot;
Starting new HTTP connection (1): controller
http://controller:8004 &quot;GET /v1/78c9c849237649a3a8c4526167427589/services HTTP/1.1&quot; 503 170
RESP: [503] Content-Length: 170 Content-Type: application/json; charset=UTF-8 X-Openstack-Request-Id: req-e38d405a-776d-44fa-bb31-e180d62c42e0 Date: Fri, 25 Aug 2017 06:05:45 GMT Connection: keep-alive
RESP BODY: {&quot;message&quot;: &quot;The server is currently unavailable. Please try again at a later time.&lt;br /&gt;&lt;br /&gt;\n\n\n&quot;, &quot;code&quot;: &quot;503 Service Unavailable&quot;, &quot;title&quot;: &quot;Service Unavailable&quot;}</pre><p>it&#39;s checked to be heat wsgi service</p><pre class='md-fences mock-cm' style='display:block;position:relative'># openstack endpoint list | grep 8004
| 1d6153de2a7a4bfc8f5277b360d5b695 | RegionOne | heat         | orchestration  | True    | internal  | http://controller:8004/v1/%(tenant_id)s   |
| 38dd2f686f5840e6ae9381b6df1076d8 | RegionOne | heat         | orchestration  | True    | admin     | http://controller:8004/v1/%(tenant_id)s   |
| 88b0e0667eb149efa337e6e0428c98ad | RegionOne | heat         | orchestration  | True    | public    | http://controller:8004/v1/%(tenant_id)s   |</pre><p>Then let&#39;s check <code>503</code> in <code>/var/log/heat/heat-api.log</code></p><pre class='md-fences mock-cm' style='display:block;position:relative'>2017-08-25 14:24:48.962 2778 WARNING keystonemiddleware.auth_token [-] Identity response: {&quot;error&quot;: {&quot;message&quot;: &quot;The request you have made requires authentication.&quot;, &quot;code&quot;: 401, &quot;title&quot;: &quot;Unauthorized&quot;}}</pre><p>it&#39;s keystone <code>401</code> meaning the credential is with issues when requesting token from keystone, let us check keystone logs:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># grep &quot;Authorization failed&quot; /var/log/apache2/keyston*.log

/var/log/apache2/keystone.log:2017-08-25 14:24:48.954127 2017-08-25 14:24:48.953 3388 WARNING keystone.common.wsgi [req-fc1e6351-ab7a-40e3-967d-4e7376ced9d9 - - - - -] Authorization failed. The request you have made requires authentication. from 10.20.0.10</pre><h3><a name='header-n1843' class='md-header-anchor '></a>Solution</h3><p>Where the credential for heat keystone call was configured? <code>/etc/heat/heat.conf</code> , it turned out we set wrong password for keystone, the one we set was <code>heat</code> while HEAT_PASS was configured, changed it as below and restart services will solve the issue.</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[keystone_authtoken]
...
password = heat

[trustee]
...
password = heat</pre><p>restart services to make it work</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service heat-api restart
# service heat-api-cfn restart
# service heat-engine restart</pre><p>and verify it:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:/var/log# openstack orchestration service list --max-width 85 
+------------+------------+------------+------------+--------+-------------+--------+
| Hostname   | Binary     | Engine ID  | Host       | Topic  | Updated At  | Status |
+------------+------------+------------+------------+--------+-------------+--------+
| controller | heat-      | 07ff1da7   | controller | engine | 2017-08-25T | up     |
|            | engine     | -a77b-4d52 |            |        | 06:49:36.00 |        |
|            |            | -95e6-cb53 |            |        | 0000        |        |
|            |            | 89a106dc   |            |        |             |        |
|            | engine     | de8-45eb-9 |            |        | 06:24:52.00 |        |
|            |            | 839-4d038d |            |        | 0000        |        |
|            |            | a4a330     |            |        |             |        |
| controller | heat-      | 279303d6-2 | controller | engine | 2017-08-25T | up     |
|            | engine     | d06-4e55-b |            |        | 06:49:36.00 |        |
|            |            | 931-2c8ad0 |            |        | 0000        |        |
|            |            | eadca7     |            |        |             |        |
| controller | heat-      | 2cd3a832-d | controller | engine | 2017-08-25T | up     |
|            | engine     | c21-4cfa-  |            |        | 06:49:36.00 |        |
|            |            | 8a4b-bddd8 |            |        | 0000        |        |
|            |            | dadba12    |            |        |             |        |
| controller | heat-      | e1b05787   | controller | engine | 2017-08-25T | up     |
|            | engine     | -9eda-46c3 |            |        | 06:49:36.00 |        |
|            |            | -acca-b1f9 |            |        | 0000        |        |
|            |            | bcf7b653   |            |        |             |        |
|            | engine     | 1fa-4844-9 |            |        | 06:24:52.00 |        |
|            |            | f68-688486 |            |        | 0000        |        |
|            |            | f4ccfb     |            |        |             |        |
|            | engine     | 023-4d10   |            |        | 06:24:52.00 |        |
|            |            | -89ea-30af |            |        | 0000        |        |
|            |            | f5430d25   |            |        |             |        |
|            | engine     | b86-41af-  |            |        | 06:24:52.00 |        |
|            |            | 895a-0c43a |            |        | 0000        |        |
|            |            | f016950    |            |        |             |        |
+------------+------------+------------+------------+--------+-------------+--------+</pre><p></p><h2><a name='header-n1855' class='md-header-anchor '></a>Start Orchestration! let&#39;s start from a single instance HOT</h2><blockquote><p>ref: <a href='https://docs.openstack.org/heat/latest/install/launch-instance.html' target='_blank' >https://docs.openstack.org/heat/latest/install/launch-instance.html</a></p></blockquote><p></p><p>In environments that include the Orchestration service, you can create a stack that launches an instance.</p><h3><a name='header-n1863' class='md-header-anchor '></a>Create a template</h3><p>The Orchestration service uses templates to describe stacks. To learn about the template language, see <a href='http://docs.openstack.org/developer/heat/template_guide/index.html'>the Template Guide</a> in the <a href='http://docs.openstack.org/developer/heat/index.html'>Heat developer documentation</a>.</p><ul><li>Create the <code>HOT-demo.yml</code> file with the following content:</li></ul><pre class='md-fences mock-cm' style='display:block;position:relative'>heat_template_version: 2015-10-15
description: Launch a basic instance with CirrOS image using the
             ``m1.nano`` flavor,  and one network.

parameters:
  NetID:
    type: string
    description: Network ID to use for the instance.

resources:
  server:
    type: OS::Nova::Server
    properties:
      image: cirros
      flavor: m1.nano
      networks:
- network: { get_param: NetID }       
outputs:
  instance_name:
    description: Name of the instance.
    value: { get_attr: [ server, name ] }
  instance_ip:
    description: IP address of the instance.
    value: { get_attr: [ server, first_address ] }</pre><h3><a name='header-n1871' class='md-header-anchor '></a>Create a stack</h3><p>Create a stack using the <code>demo-template.yml</code> template.</p><ol start='' ><li><p>Source the <code>demo</code> credentials to perform the following steps as a non-administrative project:</p><pre class='md-fences mock-cm' style='display:block;position:relative'> $ . demo-openrc</pre></li><li><p>Determine available networks.</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# openstack network list
+--------------------------------------+----------+--------------------------------------+
| ID                                   | Name     | Subnets                              |
+--------------------------------------+----------+--------------------------------------+
| 2a33434f-ba29-4645-9b5d-24f1509066f1 | provider | 9b118521-59b5-40ee-a439-9d59c3b392ea |
+--------------------------------------+----------+--------------------------------------+</pre><p>This output may differ from your environment.</p></li><li><p>Set the <code>NET_ID</code> environment variable to reflect the ID of a network. For example, using the provider network:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ export NET_ID=$(openstack network list | awk &#39;/ provider / { print $2 }&#39;)</pre></li><li><p>Create a stack of one CirrOS instance on the provider network:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack stack create -t HOT-demo.yml --parameter &quot;NetID=$NET_ID&quot; stack
+--------------------------------------+------------+--------------------+---------------------+--------------+
| ID                                   | Stack Name | Stack Status       | Creation Time       | Updated Time |
+--------------------------------------+------------+--------------------+---------------------+--------------+
| dbf46d1b-0b97-4d45-a0b3-9662a1eb6cf3 | stack      | CREATE_IN_PROGRESS | 2015-10-13T15:27:20 | None         |
+--------------------------------------+------------+--------------------+---------------------+--------------+</pre></li><li><p>After a short time, verify successful creation of the stack:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack stack list
+--------------------------------------+------------+-----------------+---------------------+--------------+
| ID                                   | Stack Name | Stack Status    | Creation Time       | Updated Time |
+--------------------------------------+------------+-----------------+---------------------+--------------+
| dbf46d1b-0b97-4d45-a0b3-9662a1eb6cf3 | stack      | CREATE_COMPLETE | 2015-10-13T15:27:20 | None         |
+--------------------------------------+------------+-----------------+---------------------+--------------+</pre></li><li><p>Show the name and IP address of the instance and compare with the output of the OpenStack client:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# openstack stack output show --all stack
+---------------+-------------------------------------------------+
| Field         | Value                                           |
+---------------+-------------------------------------------------+
| instance_name | {                                               |
|               |   &quot;output_value&quot;: &quot;stack-server-bigm7yoguexa&quot;,  |
|               |   &quot;output_key&quot;: &quot;instance_name&quot;,                |
|               |   &quot;description&quot;: &quot;Name of the instance.&quot;        |
|               | }                                               |
| instance_ip   | {                                               |
|               |   &quot;output_value&quot;: &quot;146.11.41.233&quot;,              |
|               |   &quot;output_key&quot;: &quot;instance_ip&quot;,                  |
|               |   &quot;description&quot;: &quot;IP address of the instance.&quot;  |
|               | }                                               |
+---------------+-------------------------------------------------+</pre><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# openstack server list
+--------------------------------------+---------------------------+---------+------------------------+------------+
| ID                                   | Name                      | Status  | Networks               | Image Name |
+--------------------------------------+---------------------------+---------+------------------------+------------+
| a81fc7b9-b5c0-4a0f-85d3-3ff739f8e5ce | stack-server-bigm7yoguexa | ACTIVE  | provider=146.11.41.233 | cirros     |
| e73c64ac-3af3-47fd-abfe-e138e40f0a40 | provider-instance         | SHUTOFF | provider=146.11.41.232 | cirros     |
+--------------------------------------+---------------------------+---------+------------------------+------------+</pre></li><li><p>Delete the stack.</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ openstack stack delete --yes stack</pre></li></ol><h2><a name='header-n1906' class='md-header-anchor '></a>How about Design a fake vAPG VNF and instantiate it?</h2><blockquote><p>ref: <a href='https://docs.openstack.org/heat/latest/template_guide/index.html' target='_blank' >https://docs.openstack.org/heat/latest/template_guide/index.html</a></p></blockquote><h3><a name='header-n1910' class='md-header-anchor '></a>HOT</h3><pre class='md-fences mock-cm' style='display:block;position:relative'>heat_template_version: 2015-10-15
description: Fake vAPG with CirrOS image using the
             ``m1.nano`` flavor,  and one network.

parameters:
  NetID:
    type: string
    description: Network ID to use for the instance.

resources:
  nodeA:
    type: OS::Nova::Server
    properties:
      image: cirros
      flavor: m1.nano
      networks:
      - network: { get_param: NetID }
  nodeB:
    type: OS::Nova::Server
    properties:
      image: cirros
      flavor: m1.nano
      networks:
      - network: { get_param: NetID }
  diskA:
    type: OS::Cinder::Volume
    properties:
      size: 1
  diskB:
    type: OS::Cinder::Volume
    properties:
      size: 1
  NodeAvolume_attachment:
    type: OS::Cinder::VolumeAttachment
    properties:
      volume_id: { get_resource: diskA }
      instance_uuid: { get_resource: nodeA }
  NodeBvolume_attachment:
    type: OS::Cinder::VolumeAttachment
    properties:
      volume_id: { get_resource: diskB }
      instance_uuid: { get_resource: nodeB }
outputs:
  nodeA:
    description: Name of the instance.
    value: { get_attr: [ nodeA, name ] }
  nodeA_ip:
    description: IP address of the instance.
    value: { get_attr: [ nodeA, first_address ] }
  nodeB:
    description: Name of the instance.
    value: { get_attr: [ nodeB, name ] }
  nodeB_ip:
    description: IP address of the instance.
    value: { get_attr: [ nodeB, first_address ] }</pre><p></p><h3><a name='header-n1914' class='md-header-anchor '></a>Instantiation vAPG</h3><p>For simplicity we reused the existed network</p><pre class='md-fences mock-cm' style='display:block;position:relative'># . demo-openrc
# openstack stack create -t HOT-vAPG.yml --parameter &quot;NetID=$NET_ID&quot; vAPG

// monitoring 

# openstack stack output show --all vAPG</pre><p>Print outs during/after instantiation</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# openstack stack list
+--------------------------------------+------------+--------------------+----------------------+--------------+
| ID                                   | Stack Name | Stack Status       | Creation Time        | Updated Time |
+--------------------------------------+------------+--------------------+----------------------+--------------+
| 7c4f5cda-a943-4d64-be23-72402829c62f | vAPG       | CREATE_IN_PROGRESS | 2017-08-25T07:38:55Z | None         |
+--------------------------------------+------------+--------------------+----------------------+--------------+
root@controller:~#
root@controller:~#
root@controller:~# openstack stack list
+--------------------------------------+------------+-----------------+----------------------+--------------+
| ID                                   | Stack Name | Stack Status    | Creation Time        | Updated Time |
+--------------------------------------+------------+-----------------+----------------------+--------------+
| 7c4f5cda-a943-4d64-be23-72402829c62f | vAPG       | CREATE_COMPLETE | 2017-08-25T07:38:55Z | None         |
+--------------------------------------+------------+-----------------+----------------------+--------------+
root@controller:~# openstack stack output show --all vAPG
+----------+------------------------------------------------+
| Field    | Value                                          |
+----------+------------------------------------------------+
| nodeA    | {                                              |
|          |   &quot;output_value&quot;: &quot;vAPG-nodeA-slvg7ccfel4j&quot;,   |
|          |   &quot;output_key&quot;: &quot;nodeA&quot;,                       |
|          |   &quot;description&quot;: &quot;Name of the instance.&quot;       |
|          | }                                              |
| nodeB_ip | {                                              |
|          |   &quot;output_value&quot;: &quot;146.11.41.231&quot;,             |
|          |   &quot;output_key&quot;: &quot;nodeB_ip&quot;,                    |
|          |   &quot;description&quot;: &quot;IP address of the instance.&quot; |
|          | }                                              |
| nodeA_ip | {                                              |
|          |   &quot;output_value&quot;: &quot;146.11.41.233&quot;,             |
|          |   &quot;output_key&quot;: &quot;nodeA_ip&quot;,                    |
|          |   &quot;description&quot;: &quot;IP address of the instance.&quot; |
|          | }                                              |
| nodeB    | {                                              |
|          |   &quot;output_value&quot;: &quot;vAPG-nodeB-rjame5ftjcrf&quot;,   |
|          |   &quot;output_key&quot;: &quot;nodeB&quot;,                       |
|          |   &quot;description&quot;: &quot;Name of the instance.&quot;       |
|          | }                                              |
+----------+------------------------------------------------+
root@controller:~# openstack server list
+--------------------------------------+-------------------------+---------+------------------------+------------+
| ID                                   | Name                    | Status  | Networks               | Image Name |
+--------------------------------------+-------------------------+---------+------------------------+------------+
| 3eef32d9-f885-48ca-a038-365233ed300f | vAPG-nodeB-rjame5ftjcrf | ACTIVE  | provider=146.11.41.231 | cirros     |
| 2a2709f2-9d77-42e1-be36-fd51c33b30de | vAPG-nodeA-slvg7ccfel4j | ACTIVE  | provider=146.11.41.233 | cirros     |
| e73c64ac-3af3-47fd-abfe-e138e40f0a40 | provider-instance       | SHUTOFF | provider=146.11.41.232 | cirros     |
+--------------------------------------+-------------------------+---------+------------------------+------------+</pre><p>Check resources afterwards</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# openstack volume list
+--------------------------------+-------------------------+-----------+------+--------------------------------+
| ID                             | Display Name            | Status    | Size | Attached to                    |
+--------------------------------+-------------------------+-----------+------+--------------------------------+
| 9a93c5aa-56ed-                 | vAPG-diskA-ff253tzmwhuv | in-use    |    1 | Attached to vAPG-nodeA-        |
| 42e0-b0a0-e0e617b533e1         |                         |           |      | slvg7ccfel4j on /dev/vdb       |
| 988f5003-2a3f-                 | vAPG-diskB-xpzh5o7pw5po | in-use    |    1 | Attached to vAPG-nodeB-        |
| 4eeb-b836-6be6f64b0b32         |                         |           |      | rjame5ftjcrf on /dev/vdb       |
+--------------------------------+-------------------------+-----------+------+--------------------------------+
root@controller:~# openstack server list
+--------------------------------------+-------------------------+---------+------------------------+------------+
| ID                                   | Name                    | Status  | Networks               | Image Name |
+--------------------------------------+-------------------------+---------+------------------------+------------+
| 3eef32d9-f885-48ca-a038-365233ed300f | vAPG-nodeB-rjame5ftjcrf | ACTIVE  | provider=146.11.41.231 | cirros     |
| 2a2709f2-9d77-42e1-be36-fd51c33b30de | vAPG-nodeA-slvg7ccfel4j | ACTIVE  | provider=146.11.41.233 | cirros     |
+--------------------------------------+-------------------------+---------+------------------------+------------+

root@controller:~# openstack port list
+--------------------------------------+------+-------------------+----------------------------------------+--------+
| ID                                   | Name | MAC Address       | Fixed IP Addresses                     | Status |
+--------------------------------------+------+-------------------+----------------------------------------+--------+
| 0e54bc09-29d2-4774-bd71-413739b7bffe |      | fa:16:3e:0c:8a:66 | ip_address=&#39;146.11.41.233&#39;, subnet_id= | ACTIVE |
|                                      |      |                   | &#39;9b118521-59b5-40ee-a439-9d59c3b392ea&#39; |        |
| 2aa35c9c-2b50-40cd-8971-2056fb4cf04d |      | fa:16:3e:bb:c6:13 | ip_address=&#39;146.11.41.232&#39;, subnet_id= | ACTIVE |
|                                      |      |                   | &#39;9b118521-59b5-40ee-a439-9d59c3b392ea&#39; |        |
+--------------------------------------+------+-------------------+----------------------------------------+--------+</pre><p></p><h2><a name='header-n1926' class='md-header-anchor '></a>Horizon dashboard</h2><p>The Dashboard (horizon) is a web interface that enables cloud administrators and users to manage various OpenStack resources and services.</p><p>This example deployment uses an Apache web server.</p><blockquote><p>it&#39;s actually a Django based openstack client front-end</p></blockquote><h3><a name='header-n1934' class='md-header-anchor '></a>Install and configure</h3><p>Install the packages:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># apt install openstack-dashboard
</pre><ol start='' ><li><p>Edit the <code>/etc/openstack-dashboard/local_settings.py</code> file and complete the following actions:</p><ul><li>Configure the dashboard to use OpenStack services on the <code>controller</code> node:</li></ul></li></ol><pre class='md-fences mock-cm' style='display:block;position:relative'>     OPENSTACK_HOST = &quot;controller&quot;
</pre><ul><li><p>In the Dashboard configuration section, allow your hosts to access Dashboard:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>ALLOWED_HOSTS = [&#39;*&quot;]</pre></li><li><p>Do not edit the <code>ALLOWED_HOSTS</code> parameter under the Ubuntu configuration section.</p></li><li><p><code>ALLOWED_HOSTS</code> can also be <code>[&#39;*&#39;]</code> to accept all hosts. This may be useful for development work, but is potentially insecure and should not be used in production. See the <a href='https://docs.djangoproject.com/en/dev/ref/settings/#allowed-hosts'>Django documentation</a> for further information.</p></li><li><p>Configure the <code>memcached</code> session storage service:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>   ```
   SESSION_ENGINE = &#39;django.contrib.sessions.backends.cache&#39;
 
   CACHES = {
       &#39;default&#39;: {
            &#39;BACKEND&#39;: &#39;django.core.cache.backends.memcached.MemcachedCache&#39;,
            &#39;LOCATION&#39;: &#39;controller:11211&#39;,
       }
   }
 
   ```
 
   ​</pre></li></ul><pre class='md-fences mock-cm' style='display:block;position:relative'> ​</pre><pre class='md-fences mock-cm' style='display:block;position:relative'> Comment out any other session storage configuration.</pre><ul><li><p>Enable the Identity API version 3:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>OPENSTACK_KEYSTONE_URL = &quot;http://%s:5000/v3&quot; % OPENSTACK_HOST
</pre></li><li><p>Enable support for domains:</p><pre class='md-fences mock-cm' style='display:block;position:relative'> ​```
 OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True
 
 ​```</pre><ul><li><p>Configure API versions:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>OPENSTACK_API_VERSIONS = {
    &quot;identity&quot;: 3,
    &quot;image&quot;: 2,
    &quot;volume&quot;: 2,
}
</pre></li><li><p>Configure <code>Default</code> as the default domain for users that you create via the dashboard:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = &quot;Default&quot;
</pre></li><li><p>Configure <code>user</code> as the default role for users that you create via the dashboard:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>OPENSTACK_KEYSTONE_DEFAULT_ROLE = &quot;user&quot;
</pre></li><li><p>If you chose networking option 1, disable support for layer-3 networking services:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>OPENSTACK_NEUTRON_NETWORK = {
    ...
    &#39;enable_router&#39;: False,
    &#39;enable_quotas&#39;: False,
    &#39;enable_ipv6&#39;: False,
    &#39;enable_distributed_router&#39;: False,
    &#39;enable_ha_router&#39;: False,
    &#39;enable_lb&#39;: False,
    &#39;enable_firewall&#39;: False,
    &#39;enable_vpn&#39;: False,
    &#39;enable_fip_topology_check&#39;: False,
}
</pre></li><li><p>Optionally, configure the time zone:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>TIME_ZONE = &quot;CN&quot;</pre><p>Replace <code>TIME_ZONE</code> with an appropriate time zone identifier. For more information, see the <a href='https://en.wikipedia.org/wiki/List_of_tz_database_time_zones'>list of time zones</a>.</p></li></ul></li></ul><h3><a name='header-n1998' class='md-header-anchor '></a>Finalize installation</h3><ul><li><p>Reload the web server configuration:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service apache2 reloadetc</pre></li></ul><h3><a name='header-n2004' class='md-header-anchor '></a>Verify operation</h3><p>Verify operation of the dashboard.</p><p>Access the dashboard using a web browser at <code>http://controller/horizon</code>.</p><p>Authenticate using <code>admin</code> or <code>demo</code> user and <code>default</code> domain credentials.</p><blockquote><p>Monitoring the how process by <code>tail -f /var/log/apache2/*.log</code></p></blockquote><p></p><h2><a name='header-n2016' class='md-header-anchor '></a>[ISSUE] Horizon <code>500</code> internal error</h2><h3><a name='header-n2017' class='md-header-anchor '></a>Fault reproduce in cli</h3><pre class='md-fences mock-cm' style='display:block;position:relative'># curl http://10.20.0.10/horizon
&lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;
&lt;html&gt;&lt;head&gt;
&lt;title&gt;500 Internal Server Error&lt;/title&gt;
&lt;/head&gt;&lt;body&gt;
&lt;h1&gt;Internal Server Error&lt;/h1&gt;
&lt;p&gt;The server encountered an internal error or
misconfiguration and was unable to complete
your request.&lt;/p&gt;
&lt;p&gt;Please contact the server administrator at
 webmaster@localhost to inform them of the time this error occurred,
 and the actions you performed just before this error.&lt;/p&gt;
&lt;p&gt;More information about this error may be available
in the server error log.&lt;/p&gt;
&lt;hr&gt;
&lt;address&gt;Apache/2.4.18 (Ubuntu) Server at 10.20.0.10 Port 80&lt;/address&gt;
&lt;/body&gt;&lt;/html&gt;</pre><p>It&#39;s apache2 based web service, error could be fond in <code>/var/log/apache2/error.log</code></p><p></p><pre class='md-fences mock-cm' style='display:block;position:relative'>[Fri Aug 25 16:22:13.681394 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248] mod_wsgi (pid=9401): Target WSGI script &#39;/usr/share/openstack-dashboard/openstack_dashboard/wsgi/django.wsgi&#39; cannot be loaded as Python module.
[Fri Aug 25 16:22:13.681453 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248] mod_wsgi (pid=9401): Exception occurred processing WSGI script &#39;/usr/share/openstack-dashboard/openstack_dashboard/wsgi/django.wsgi&#39;.
[Fri Aug 25 16:22:13.681498 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248] Traceback (most recent call last):
[Fri Aug 25 16:22:13.681531 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File &quot;/usr/share/openstack-dashboard/openstack_dashboard/wsgi/django.wsgi&quot;, line 16, in &lt;module&gt;[Fri Aug 25 16:22:13.681621 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     application = get_wsgi_application()
[Fri Aug 25 16:22:13.681635 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File &quot;/usr/lib/python2.7/dist-packages/django/core/wsgi.py&quot;, line 14, in get_wsgi_application
[Fri Aug 25 16:22:13.681672 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     django.setup()
[Fri Aug 25 16:22:13.681682 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File &quot;/usr/lib/python2.7/dist-packages/django/__init__.py&quot;, line 17, in setup
[Fri Aug 25 16:22:13.681713 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     configure_logging(settings.LOGGING_CONFIG, settings.LOGGING)
[Fri Aug 25 16:22:13.681726 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File &quot;/usr/lib/python2.7/dist-packages/django/conf/__init__.py&quot;, line 48, in __getattr__
[Fri Aug 25 16:22:13.681806 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     self._setup(name)
[Fri Aug 25 16:22:13.681886 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File &quot;/usr/lib/python2.7/dist-packages/django/conf/__init__.py&quot;, line 44, in _setup
[Fri Aug 25 16:22:13.681909 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     self._wrapped = Settings(settings_module)
[Fri Aug 25 16:22:13.681916 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File &quot;/usr/lib/python2.7/dist-packages/django/conf/__init__.py&quot;, line 92, in __init__
[Fri Aug 25 16:22:13.681927 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     mod = importlib.import_module(self.SETTINGS_MODULE)
[Fri Aug 25 16:22:13.681934 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File &quot;/usr/lib/python2.7/importlib/__init__.py&quot;, line 37, in import_module
[Fri Aug 25 16:22:13.681974 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     __import__(name)
[Fri Aug 25 16:22:13.681984 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File &quot;/usr/share/openstack-dashboard/openstack_dashboard/settings.py&quot;, line 335, in &lt;module&gt;
[Fri Aug 25 16:22:13.682112 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     from local.local_settings import *  # noqa
[Fri Aug 25 16:22:13.682123 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File &quot;/usr/share/openstack-dashboard/openstack_dashboard/local/local_settings.py&quot;, line 131, in &lt;module&gt;
[Fri Aug 25 16:22:13.682586 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     SECRET_KEY = secret_key.generate_or_read_from_file(&#39;/var/lib/openstack-dashboard/secret_key&#39;) [Fri Aug 25 16:22:13.682611 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File &quot;/usr/share/openstack-dashboard/horizon/utils/secret_key.py&quot;, line 70, in generate_or_read_from_file
[Fri Aug 25 16:22:13.682688 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     key = read_from_file(key_file)
[Fri Aug 25 16:22:13.682699 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]   File &quot;/usr/share/openstack-dashboard/horizon/utils/secret_key.py&quot;, line 52, in read_from_file
[Fri Aug 25 16:22:13.682714 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248]     with open(key_file, &#39;r&#39;) as f:
[Fri Aug 25 16:22:13.682746 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote 10.20.0.10:18248] IOError: [Errno 13] Permission denied: &#39;/var/lib/openstack-dashboard/secret_key&#39;</pre><p>beautify it as below</p><pre class='md-fences mock-cm' style='display:block;position:relative'> mod_wsgi (pid=9401): Target WSGI script &#39;/usr/share/openstack-dashboard/openstack_dashboard/wsgi/django.wsgi&#39; cannot be loaded as Python module.
 mod_wsgi (pid=9401): Exception occurred processing WSGI script &#39;/usr/share/openstack-dashboard/openstack_dashboard/wsgi/django.wsgi&#39;.
 Traceback (most recent call last):
   File &quot;/usr/share/openstack-dashboard/openstack_dashboard/wsgi/django.wsgi&quot;, line 16, in &lt;module&gt;[Fri Aug 25 16:22:13.681621 2017] [wsgi:error] [pid 9401:tid 140055623386880] [remote      application = get_wsgi_application()
   File &quot;/usr/lib/python2.7/dist-packages/django/core/wsgi.py&quot;, line 14, in get_wsgi_application
     django.setup()
   File &quot;/usr/lib/python2.7/dist-packages/django/__init__.py&quot;, line 17, in setup
     configure_logging(settings.LOGGING_CONFIG, settings.LOGGING)
   File &quot;/usr/lib/python2.7/dist-packages/django/conf/__init__.py&quot;, line 48, in __getattr__
     self._setup(name)
   File &quot;/usr/lib/python2.7/dist-packages/django/conf/__init__.py&quot;, line 44, in _setup
     self._wrapped = Settings(settings_module)
   File &quot;/usr/lib/python2.7/dist-packages/django/conf/__init__.py&quot;, line 92, in __init__
     mod = importlib.import_module(self.SETTINGS_MODULE)
   File &quot;/usr/lib/python2.7/importlib/__init__.py&quot;, line 37, in import_module
     __import__(name)
   File &quot;/usr/share/openstack-dashboard/openstack_dashboard/settings.py&quot;, line 335, in &lt;module&gt;
     from local.local_settings import *  # noqa
   File &quot;/usr/share/openstack-dashboard/openstack_dashboard/local/local_settings.py&quot;, line 131, in &lt;module&gt;
     SECRET_KEY = secret_key.generate_or_read_from_file(&#39;/var/lib/openstack-dashboard/secret_key&#39;) [Fri Aug 25 16:22:13.682611 2017] [wsgi:error] [pid 9401:tid    File &quot;/usr/share/openstack-dashboard/horizon/utils/secret_key.py&quot;, line 70, in generate_or_read_from_file
     key = read_from_file(key_file)
   File &quot;/usr/share/openstack-dashboard/horizon/utils/secret_key.py&quot;, line 52, in read_from_file
     with open(key_file, &#39;r&#39;) as f:
 IOError: [Errno 13] Permission denied: &#39;/var/lib/openstack-dashboard/secret_key&#39;</pre><p>The log shows that the file cannot be accessed by horizon. Check its ownership and permission</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# ll /var/lib/openstack-dashboard/secret_key
-rw------- 1 root root 64 Aug 25 15:49 /var/lib/openstack-dashboard/secret_key</pre><p>try chown to <code>horizon:horizon</code>:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># chown -R horizon:horizon /var/lib/openstack-dashboard/secret_key
# ll /var/lib/openstack-dashboard/secret_key
-rw------- 1 horizon:horizon 64 Aug 25 15:49 /var/lib/openstack-dashboard/secret_key
# service apache2 reload</pre><p>retry with <code>curl</code>, still got <code>500</code>,and with same error on apache error log</p><pre class='md-fences mock-cm' style='display:block;position:relative'># curl http://10.20.0.10/horizon
&lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;
&lt;html&gt;&lt;head&gt;
&lt;title&gt;500 Internal Server Error&lt;/title&gt;
&lt;/head&gt;&lt;body&gt;
&lt;h1&gt;Internal Server Error&lt;/h1&gt;
&lt;p&gt;The server encountered an internal error or
misconfiguration and was unable to complete
your request.&lt;/p&gt;
&lt;p&gt;Please contact the server administrator at
 webmaster@localhost to inform them of the time this error occurred,
 and the actions you performed just before this error.&lt;/p&gt;
&lt;p&gt;More information about this error may be available
in the server error log.&lt;/p&gt;
&lt;hr&gt;
&lt;address&gt;Apache/2.4.18 (Ubuntu) Server at 10.20.0.10 Port 80&lt;/address&gt;
&lt;/body&gt;&lt;/html&gt;</pre><p>try change as <code>777</code> while it cannot pass horizon permission policy with error as below:</p><pre class='md-fences mock-cm' style='display:block;position:relative'># chmod 777 /var/lib/openstack-dashboard/secret_key
# service apache2 reload
# curl http://10.20.0.10/horizon

# less /var/log/apache2/error.log
...
[Fri Aug 25 16:20:38.336541 2017] [wsgi:error] [pid 9110:tid 140055698921216] [remote 10.20.0.10:18504]     SECRET_KEY = secret_key.generate_or_read_from_file(&#39;/var/lib/openstack-dashboard/secret_key&#39;) [Fri Aug 25 16:20:38.336553 2017] [wsgi:error] [pid 9110:tid 140055698921216] [remote 10.20.0.10:18504]   File &quot;/usr/share/openstack-dashboard/horizon/utils/secret_key.py&quot;, line 70, in generate_or_read_from_file
[Fri Aug 25 16:20:38.336595 2017] [wsgi:error] [pid 9110:tid 140055698921216] [remote 10.20.0.10:18504]     key = read_from_file(key_file)
[Fri Aug 25 16:20:38.336603 2017] [wsgi:error] [pid 9110:tid 140055698921216] [remote 10.20.0.10:18504]   File &quot;/usr/share/openstack-dashboard/horizon/utils/secret_key.py&quot;, line 51, in read_from_file
[Fri Aug 25 16:20:38.336612 2017] [wsgi:error] [pid 9110:tid 140055698921216] [remote 10.20.0.10:18504]     os.path.abspath(key_file))
[Fri Aug 25 16:20:38.336628 2017] [wsgi:error] [pid 9110:tid 140055698921216] [remote 10.20.0.10:18504] FilePermissionError: Insecure permissions on key file /var/lib/openstack-dashboard/secret_key, should be 0600.
...</pre><p>We should identify the process owner and change to it accordingly.</p><p>By checking horizon wsgi process it&#39;s found the user is www-data (the one for apache2 ):</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# ps -aux | grep horizon
www-data 10299  0.0  0.2 251032  8292 ?        Sl   16:26   0:00 (wsgi:horizon)    -k start
www-data 10300  0.0  0.2 251024  8292 ?        Sl   16:26   0:00 (wsgi:horizon)    -k start
www-data 10301  0.3  4.1 550344 169144 ?       Sl   16:26   0:02 (wsgi:horizon)    -k start</pre><h3><a name='header-n2044' class='md-header-anchor '></a>Solution</h3><p>Change owner to <code>www-data</code></p><pre class='md-fences mock-cm' style='display:block;position:relative'># chown www-data /var/lib/openstack-dashboard/secret_key
# service apache2 reload</pre><p>Retry with <code>curl http://10.20.0.10/horizon</code> no error came out :-).</p><h2><a name='header-n2050' class='md-header-anchor '></a>Enable RabbitMQ web admin for studying</h2><blockquote><p>ref: <a href='https://www.rabbitmq.com/management.html' target='_blank' >https://www.rabbitmq.com/management.html</a></p></blockquote><p>Enable the plugins for this feature:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# netstat -plunt | grep 15672

root@controller:~# rabbitmq-plugins enable rabbitmq_management
The following plugins have been enabled:
  mochiweb
  webmachine
  rabbitmq_web_dispatch
  amqp_client
  rabbitmq_management_agent
  rabbitmq_management
  
root@controller:~# netstat -plunt | grep 15672
tcp        0      0 0.0.0.0:15672           0.0.0.0:*               LISTEN      1927/beam</pre><p>Browse from web browser with URL: <code>http://controller:15672/</code>with:</p><ul><li>user: openstack</li><li>password: RABBIT_PASS</li></ul><p>Got failure Login failed, check logs</p><pre class='md-fences mock-cm' style='display:block;position:relative'># less /var/log/rabbitmq/rabbit@controller.log

...
=WARNING REPORT==== 26-Aug-2017::22:34:05 ===
HTTP access denied: user &#39;openstack&#39; - Not management user
...</pre><p>Add new user ad admin grants:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>rabbitmqctl add_user admin admin
rabbitmqctl set_user_tags admin administrator
rabbitmqctl set_permissions -p / admin &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</pre><blockquote><p>Accessed !</p></blockquote><p></p><p></p><h2><a name='header-n2079' class='md-header-anchor '></a>Neutron reconfigure as Linux bridge with vlan</h2><blockquote><p>ref: <a href='https://docs.openstack.org/kilo/networking-guide/deploy_scenario4b.html' target='_blank' >https://docs.openstack.org/kilo/networking-guide/deploy_scenario4b.html</a></p></blockquote><h3><a name='header-n2083' class='md-header-anchor '></a>Controller configuration</h3><ol start='' ><li><p>Configure the kernel to disable reverse path filtering. Edit the <code>/etc/sysctl.conf</code> file:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>net.ipv4.conf.default.rp_filter=0
net.ipv4.conf.all.rp_filter=0
</pre></li><li><p>Load the new kernel configuration:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ sysctl -p</pre></li><li><p>Configure the ML2 plug-in and Linux bridge agent. Edit the <code>/etc/neutron/plugins/ml2/ml2_conf.ini</code> file:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[ml2]
type_drivers = flat,vlan
tenant_network_types =
mechanism_drivers = linuxbridge

[ml2_type_flat]
flat_networks = ecn,provider

[ml2_type_vlan]
network_vlan_ranges = provider:100:200</pre></li><li><p>Edit the<code>/etc/neutron/plugins/ml2/ml2_conf.ini</code> file:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[linux_bridge]
physical_interface_mappings = ecn:enp0s10,provider:enp0s8

[securitygroup]
firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
enable_security_group = True
enable_ipset = True</pre></li><li><p>Restart the Networking services.</p><pre class='md-fences mock-cm' style='display:block;position:relative'># service neutron-server restart
# service neutron-linuxbridge-agent restart
# service neutron-dhcp-agent restart
# service neutron-metadata-agent restart</pre></li></ol><h3><a name='header-n2105' class='md-header-anchor '></a>Compute node configuration</h3><ol start='' ><li><p>Configure the kernel to disable reverse path filtering. Edit the <code>/etc/sysctl.conf</code> file:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>net.ipv4.conf.default.rp_filter=0
net.ipv4.conf.all.rp_filter=0</pre></li><li><p>Load the new kernel configuration:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ sysctl -p</pre></li><li><p>Configure the Linux bridge agent. Edit the <code>/etc/neutron/plugins/ml2/ml2_conf.ini</code> file:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>[linux_bridge]
physical_interface_mappings = ecn:enp0s10,provider:enp0s8

[securitygroup]
firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
enable_security_group = True
enable_ipset = True</pre><p>​</p></li></ol><h3><a name='header-n2121' class='md-header-anchor '></a>Verify operation</h3><ol start='' ><li><p>Source the administrative project credentials.</p><pre class='md-fences mock-cm' style='display:block;position:relative'>. admin-openrc</pre><p>​</p></li><li><p>Verify presence and operation of the agents:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# neutron agent-list
neutron CLI is deprecated and will be removed in the future. Use openstack CLI instead.
+--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+
| id                                   | agent_type         | host       | availability_zone | alive | admin_state_up | binary                    |
+--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+
| 143d7731-9227-4baf-9052-292d7aea6992 | Linux bridge agent | compute    |                   | :-)   | True           | neutron-linuxbridge-agent |
| 1d661145-0941-411d-9b18-b3371fe57c4b | Linux bridge agent | controller |                   | :-)   | True           | neutron-linuxbridge-agent |
| 7502e1a3-998d-4aca-91e4-ca17e1b10c82 | DHCP agent         | controller | nova              | :-)   | True           | neutron-dhcp-agent        |
| 7c47ac70-5de2-4442-8fc1-91fe97ae120f | Metadata agent     | controller |                   | :-)   | True           | neutron-metadata-agent    |
+--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+</pre></li></ol><pre class='md-fences mock-cm' style='display:block;position:relative'>   root@controller:~# openstack network agent list
   +--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+
   | ID                                   | Agent Type         | Host       | Availability Zone | Alive | State | Binary                    |
   +--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+
   | 143d7731-9227-4baf-9052-292d7aea6992 | Linux bridge agent | compute    | None              | True  | UP    | neutron-linuxbridge-agent |
   | 1d661145-0941-411d-9b18-b3371fe57c4b | Linux bridge agent | controller | None              | True  | UP    | neutron-linuxbridge-agent |
   | 7502e1a3-998d-4aca-91e4-ca17e1b10c82 | DHCP agent         | controller | nova              | True  | UP    | neutron-dhcp-agent        |
   | 7c47ac70-5de2-4442-8fc1-91fe97ae120f | Metadata agent     | controller | None              | True  | UP    | neutron-metadata-agent    |
   +--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</pre><h3><a name='header-n2134' class='md-header-anchor '></a>Create initial networks</h3><p>This example creates a VLAN provider network. Change the VLAN ID and IP address range to values suitable for your environment.</p><ol start='' ><li><p>Source the administrative project credentials.</p><pre class='md-fences mock-cm' style='display:block;position:relative'>. demo-openrc</pre><p>​</p></li><li><p>Create a provider network:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# openstack network create  --share --external   --provider-physical-network provider --provider-network-type vlan --provider-segment 101 provider-vlan-101
+---------------------------+--------------------------------------+
| Field                     | Value                                |
+---------------------------+--------------------------------------+
| admin_state_up            | UP                                   |
| availability_zone_hints   |                                      |
| availability_zones        |                                      |
| created_at                | 2017-08-28T03:25:26Z                 |
| description               |                                      |
| dns_domain                | None                                 |
| id                        | 152a4a85-dc52-4c62-9bbd-742eb4f7b8fa |
| ipv4_address_scope        | None                                 |
| ipv6_address_scope        | None                                 |
| is_default                | None                                 |
| mtu                       | 1500                                 |
| name                      | provider-vlan-101                    |
| port_security_enabled     | True                                 |
| project_id                | 78c9c849237649a3a8c4526167427589     |
| provider:network_type     | vlan                                 |
| provider:physical_network | provider                             |
| provider:segmentation_id  | 101                                  |
| qos_policy_id             | None                                 |
| revision_number           | 4                                    |
| router:external           | External                             |
| segments                  | None                                 |
| shared                    | True                                 |
| status                    | ACTIVE                               |
| subnets                   |                                      |
| updated_at                | 2017-08-28T03:25:26Z                 |
+---------------------------+--------------------------------------+

// or neutron cli

$ neutron net-create provider-101 --shared  --external\
  --provider:physical_network provider --provider:network_type vlan \
  --provider:segmentation_id 101
Created a new network:
+---------------------------+--------------------------------------+
| Field                     | Value                                |
+---------------------------+--------------------------------------+
| admin_state_up            | True                                 |
| id                        | 572a3fc9-ad1f-4e54-a63a-4bf5047c1a4a |
| name                      | provider-101                         |
| provider:network_type     | vlan                                 |
| provider:physical_network | provider                             |
| provider:segmentation_id  | 101                                  |
| router:external           | True                                |
| shared                    | True                                 |
| status                    | ACTIVE                               |
| subnets                   |                                      |
| tenant_id                 | e0bddbc9210d409795887175341b7098     |
+---------------------------+--------------------------------------+</pre><blockquote><p>Note: The <code>shared</code> option allows any project to use this network.</p></blockquote></li><li><p>Create a subnet on the provider network:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# openstack subnet create --network provider-vlan-101 --allocation-pool start=172.16.0.100,end=172.16.0.200  --gateway 172.16.0.1   --subnet-range 172.16.0.0/24 provider-vlan-101
+-------------------+--------------------------------------+
| Field             | Value                                |
+-------------------+--------------------------------------+
| allocation_pools  | 172.16.0.100-172.16.0.200            |
| cidr              | 172.16.0.0/24                        |
| created_at        | 2017-08-28T03:32:06Z                 |
| description       |                                      |
| dns_nameservers   |                                      |
| enable_dhcp       | True                                 |
| gateway_ip        | 172.16.0.1                           |
| host_routes       |                                      |
| id                | 61693a58-a984-4f7b-9097-dd5e489a88bd |
| ip_version        | 4                                    |
| ipv6_address_mode | None                                 |
| ipv6_ra_mode      | None                                 |
| name              | provider-vlan-101                    |
| network_id        | 2a33434f-ba29-4645-9b5d-24f1509066f1 |
| project_id        | 78c9c849237649a3a8c4526167427589     |
| revision_number   | 2                                    |
| segment_id        | None                                 |
| service_types     |                                      |
| subnetpool_id     | None                                 |
| updated_at        | 2017-08-28T03:32:06Z                 |
+-------------------+--------------------------------------+

// or via neutron cli
$ neutron subnet-create provider-vlan-101 172.16.0.0/24  \
  --name provider-101-subnet --gateway 172.16.0.1
</pre></li></ol><h3><a name='header-n2155' class='md-header-anchor '></a>Verify network operation</h3><ol start='' ><li><p>On the controller node, verify creation of the <code>qdhcp</code> namespace:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ ip netns
qdhcp-8b868082-e312-4110-8627-298109d4401c</pre><p>Note: The <code>qdhcp</code> namespace might not exist until launching an instance.</p></li><li><p>Source the regular project credentials. The following steps use the <code>demo</code> project.</p></li><li><p>Create the appropriate security group rules to allow ping and SSH access to the instance. </p><blockquote><p>for OSC command referring to above chapters below is command for nova cli</p></blockquote><pre class='md-fences mock-cm' style='display:block;position:relative'>root@controller:~# openstack network list
+--------------------------------------+-------------------+--------------------------------------+
| ID                                   | Name              | Subnets                              |
+--------------------------------------+-------------------+--------------------------------------+
| 152a4a85-dc52-4c62-9bbd-742eb4f7b8fa | provider-vlan-101 | 91d305ac-762a-4062-b1da-8a55d7ebd735 |
+--------------------------------------+-------------------+--------------------------------------+
root@controller:~# openstack server create --flavor m1.nano --image cirros   --nic net-id=152a4a85-dc52-4c62-9bbd-742eb4f7b8fa --security-group default provider-vlan-instance
+-------------------------------------+-----------------------------------------------+
| Field                               | Value                                         |
+-------------------------------------+-----------------------------------------------+
| OS-DCF:diskConfig                   | MANUAL                                        |
| OS-EXT-AZ:availability_zone         |                                               |
| OS-EXT-SRV-ATTR:host                | None                                          |
| OS-EXT-SRV-ATTR:hypervisor_hostname | None                                          |
| OS-EXT-SRV-ATTR:instance_name       |                                               |
| OS-EXT-STS:power_state              | NOSTATE                                       |
| OS-EXT-STS:task_state               | scheduling                                    |
| OS-EXT-STS:vm_state                 | building                                      |
| OS-SRV-USG:launched_at              | None                                          |
| OS-SRV-USG:terminated_at            | None                                          |
| accessIPv4                          |                                               |
| accessIPv6                          |                                               |
| addresses                           |                                               |
| adminPass                           | e9YKhRWy7XmN                                  |
| config_drive                        |                                               |
| created                             | 2017-08-28T03:44:10Z                          |
| flavor                              | m1.nano (0)                                   |
| hostId                              |                                               |
| id                                  | 2b78d9ee-3476-4e6b-9c4e-09ad2b7f115e          |
| image                               | cirros (c17e391e-93e1-4480-9cf3-bf8623063e61) |
| key_name                            | None                                          |
| name                                | provider-vlan-instance                        |
| progress                            | 0                                             |
| project_id                          | 78c9c849237649a3a8c4526167427589              |
| properties                          |                                               |
| security_groups                     | name=&#39;default&#39;                                |
| status                              | BUILD                                         |
| updated                             | 2017-08-28T03:44:10Z                          |
| user_id                             | d8efd16c30904a7992010abe4bdb9a2b              |
| volumes_attached                    |                                               |
+-------------------------------------+-----------------------------------------------+</pre></li><li><p>Launch an instance with an interface on the provider network.</p><p>Note</p><p>This example uses a CirrOS image that was manually uploaded into the Image Service</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ nova boot --flavor m1.tiny --image cirros-0.3.3-x86_64-disk test_server
+--------------------------------------+-----------------------------------------------------------------+
| Property                             | Value                                                           |
+--------------------------------------+-----------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                          |
| OS-EXT-AZ:availability_zone          | nova                                                            |
| OS-EXT-SRV-ATTR:host                 | -                                                               |
| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                               |
| OS-EXT-SRV-ATTR:instance_name        | instance-00000001                                               |
| OS-EXT-STS:power_state               | 0                                                               |
| OS-EXT-STS:task_state                | scheduling                                                      |
| OS-EXT-STS:vm_state                  | building                                                        |
| OS-SRV-USG:launched_at               | -                                                               |
| OS-SRV-USG:terminated_at             | -                                                               |
| accessIPv4                           |                                                                 |
| accessIPv6                           |                                                                 |
| adminPass                            | h7CkMdkRXuuh                                                    |
| config_drive                         |                                                                 |
| created                              | 2015-07-22T20:40:16Z                                            |
| flavor                               | m1.tiny (1)                                                     |
| hostId                               |                                                                 |
| id                                   | dee2a9f4-e24c-444d-8c94-386f11f74af5                            |
| image                                | cirros-0.3.3-x86_64-disk (2b6bb38f-f69f-493c-a1c0-264dfd4188d8) |
| key_name                             | -                                                               |
| metadata                             | {}                                                              |
| name                                 | test_server                                                     |
| os-extended-volumes:volumes_attached | []                                                              |
| progress                             | 0                                                               |
| security_groups                      | default                                                         |
| status                               | BUILD                                                           |
| tenant_id                            | 5f2db133e98e4bc2999ac2850ce2acd1                                |
| updated                              | 2015-07-22T20:40:16Z                                            |
| user_id                              | ea417ebfa86741af86f84a5dbcc97cd2                                |
+--------------------------------------+-----------------------------------------------------------------+
</pre></li><li><p>Determine the IP address of the instance. The following step uses 203.0.113.3.</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ nova list
+--------------------------------------+-------------+--------+------------+-------------+--------------------------+
| ID                                   | Name        | Status | Task State | Power State | Networks                 |
+--------------------------------------+-------------+--------+------------+-------------+--------------------------+
| dee2a9f4-e24c-444d-8c94-386f11f74af5 | test_server | ACTIVE | -          | Running     | provider-101=203.0.113.3 |
+--------------------------------------+-------------+--------+------------+-------------+--------------------------+
</pre></li><li><p>On the controller node or any host with access to the provider network, ping the IP address of the instance:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ ping -c 4 203.0.113.3
PING 203.0.113.3 (203.0.113.3) 56(84) bytes of data.
64 bytes from 203.0.113.3: icmp_req=1 ttl=63 time=3.18 ms
64 bytes from 203.0.113.3: icmp_req=2 ttl=63 time=0.981 ms
64 bytes from 203.0.113.3: icmp_req=3 ttl=63 time=1.06 ms
64 bytes from 203.0.113.3: icmp_req=4 ttl=63 time=0.929 ms

--- 203.0.113.3 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3002ms
rtt min/avg/max/mdev = 0.929/1.539/3.183/0.951 ms
</pre></li><li><p>Obtain access to the instance.</p></li><li><p>Test connectivity to the Internet:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>$ ping -c 4 openstack.org
PING openstack.org (174.143.194.225) 56(84) bytes of data.
64 bytes from 174.143.194.225: icmp_req=1 ttl=53 time=17.4 ms
64 bytes from 174.143.194.225: icmp_req=2 ttl=53 time=17.5 ms
64 bytes from 174.143.194.225: icmp_req=3 ttl=53 time=17.7 ms
64 bytes from 174.143.194.225: icmp_req=4 ttl=53 time=17.5 ms

--- openstack.org ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3003ms
rtt min/avg/max/mdev = 17.431/17.575/17.734/0.143 ms
</pre></li></ol><h2><a name='header-n2196' class='md-header-anchor '></a>[ISSUE] Troubleshooting vlan dhcp</h2><p>console to vm, it&#39;s blocked on dhcp discover, after dhcp failure, metadata network is not ok as well...</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@compute:~# virsh console 1
Connected to domain instance-00000008
Escape character is ^]


Sending discover...
Usage: /sbin/cirros-dhcpc &lt;up|down&gt;
No lease, failing
WARN: /etc/rc3.d/S40-network failed
cirros-ds &#39;net&#39; up at 187.22
checking http://169.254.169.254/2009-04-04/instance-id
failed 1/20: up 187.48. request failed
failed 2/20: up 189.90. request failed
failed 3/20: up 192.04. request failed
failed 4/20: up 194.30. request failed
failed 5/20: up 196.44. request failed
failed 6/20: up 198.55. request failed
failed 7/20: up 200.80. request failed
failed 8/20: up 202.97. request failed
failed 9/20: up 205.13. request failed
failed 10/20: up 207.37. request failed
failed 11/20: up 209.54. request failed
failed 12/20: up 211.67. request failed
failed 13/20: up 213.91. request failed
failed 14/20: up 216.05. request failed
failed 15/20: up 218.21. request failed
failed 16/20: up 220.49. request failed
failed 17/20: up 222.61. request failed
failed 18/20: up 224.75. request failed
failed 19/20: up 227.00. request failed
failed 20/20: up 229.12. request failed
failed to read iid from metadata. tried 20</pre><p>from compute nothing received after discover sent out</p><pre class='md-fences mock-cm' style='display:block;position:relative'>root@compute:~# tcpdump -i  brq152a4a85-dc -vv port 67 or port 68 -e -n
tcpdump: listening on brq152a4a85-dc, link-type EN10MB (Ethernet), capture size 262144 bytes
11:56:52.659297 fa:16:3e:66:84:cc &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 332: (tos 0x0, ttl 64, id 0, offset 0, flags [none], proto UDP (17), length 318)
    0.0.0.0.68 &gt; 255.255.255.255.67: [udp sum ok] BOOTP/DHCP, Request from fa:16:3e:66:84:cc, length 290, xid 0xd0ed70a, Flags [none] (0x0000)
          Client-Ethernet-Address fa:16:3e:66:84:cc
          Vendor-rfc1048 Extensions
            Magic Cookie 0x63825363
            DHCP-Message Option 53, length 1: Discover
            Client-ID Option 61, length 7: ether fa:16:3e:66:84:cc
            MSZ Option 57, length 2: 576
            Parameter-Request Option 55, length 9:
              Subnet-Mask, Default-Gateway, Domain-Name-Server, Hostname
              Domain-Name, MTU, BR, NTP
              Classless-Static-Route
            Vendor-Class Option 60, length 12: &quot;udhcp 1.20.1&quot;
            Hostname Option 12, length 6: &quot;cirros&quot;
11:57:52.726797 fa:16:3e:66:84:cc &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 332: (tos 0x0, ttl 64, id 0, offset 0, flags [none], proto UDP (17), length 318)
    0.0.0.0.68 &gt; 255.255.255.255.67: [udp sum ok] BOOTP/DHCP, Request from fa:16:3e:66:84:cc, length 290, xid 0xd0ed70a, secs 60, Flags [none] (0x0000)
          Client-Ethernet-Address fa:16:3e:66:84:cc
          Vendor-rfc1048 Extensions
            Magic Cookie 0x63825363
            DHCP-Message Option 53, length 1: Discover
            Client-ID Option 61, length 7: ether fa:16:3e:66:84:cc
            MSZ Option 57, length 2: 576
            Parameter-Request Option 55, length 9:
              Subnet-Mask, Default-Gateway, Domain-Name-Server, Hostname
              Domain-Name, MTU, BR, NTP
              Classless-Static-Route
            Vendor-Class Option 60, length 12: &quot;udhcp 1.20.1&quot;
            Hostname Option 12, length 6: &quot;cirros&quot;</pre><p>While it had been sent out from dhcp agent &quot;DHCP OFFER&quot;</p><pre class='md-fences mock-cm' style='display:block;position:relative'>tcpdump: listening on brq152a4a85-dc, link-type EN10MB (Ethernet), capture size 262144 bytes
11:56:52.259801 fa:16:3e:66:84:cc &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 332: (tos 0x0, ttl 64, id 0, offset 0, flags [none], proto UDP (17), length 318)
    0.0.0.0.68 &gt; 255.255.255.255.67: [udp sum ok] BOOTP/DHCP, Request from fa:16:3e:66:84:cc, length 290, xid 0xd0ed70a, Flags [none] (0x0000)
          Client-Ethernet-Address fa:16:3e:66:84:cc
          Vendor-rfc1048 Extensions
            Magic Cookie 0x63825363
            DHCP-Message Option 53, length 1: Discover
            Client-ID Option 61, length 7: ether fa:16:3e:66:84:cc
            MSZ Option 57, length 2: 576
            Parameter-Request Option 55, length 9:
              Subnet-Mask, Default-Gateway, Domain-Name-Server, Hostname
              Domain-Name, MTU, BR, NTP
              Classless-Static-Route
            Vendor-Class Option 60, length 12: &quot;udhcp 1.20.1&quot;
            Hostname Option 12, length 6: &quot;cirros&quot;
11:56:52.261241 fa:16:3e:56:9f:61 &gt; fa:16:3e:66:84:cc, ethertype IPv4 (0x0800), length 370: (tos 0xc0, ttl 64, id 11060, offset 0, flags [none], proto UDP (17), length 356)
    172.16.0.100.67 &gt; 172.16.0.105.68: [udp sum ok] BOOTP/DHCP, Reply, length 328, xid 0xd0ed70a, Flags [none] (0x0000)
          Your-IP 172.16.0.105
          Server-IP 172.16.0.100
          Client-Ethernet-Address fa:16:3e:66:84:cc
          Vendor-rfc1048 Extensions
            Magic Cookie 0x63825363
            DHCP-Message Option 53, length 1: Offer
            Server-ID Option 54, length 4: 172.16.0.100
            Lease-Time Option 51, length 4: 86400
            RN Option 58, length 4: 43200
            RB Option 59, length 4: 75600
            Subnet-Mask Option 1, length 4: 255.255.255.0
            BR Option 28, length 4: 172.16.0.255
            Domain-Name-Server Option 6, length 4: 172.16.0.100
            Domain-Name Option 15, length 14: &quot;openstacklocal&quot;
            Default-Gateway Option 3, length 4: 172.16.0.1
            Classless-Static-Route Option 121, length 14: (169.254.169.254/32:172.16.0.100),(default:172.16.0.1)
            MTU Option 26, length 2: 1500</pre><p>The network configured in virtualbox was not in promiscuous mode caus</p><p>succeeded:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>udhcpc (v1.20.1) started
Sending discover...
Sending discover...
Sending select for 172.16.0.105...
Lease of 172.16.0.105 obtained, lease time 86400
route: SIOCADDRT: File exists
WARN: failed: route add -net &quot;0.0.0.0/0&quot; gw &quot;172.16.0.1&quot;
cirros-ds &#39;net&#39; up at 74.67
checking http://169.254.169.254/2009-04-04/instance-id
successful after 1/20 tries: up 75.02. iid=i-00000009</pre><pre class='md-fences mock-cm' style='display:block;position:relative'></pre></div>
</body>
</html>